<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.6.0"/>
    <title>SliceLine API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SliceFinder">SliceFinder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SliceFinder.__init__">SliceFinder</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.X0">X0</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.k">k</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.errors">errors</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.sigma">sigma</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.alpha">alpha</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.L_max">L_max</a>
                        </li>
                        <li>
                                <a class="variable" href="#SliceFinder.avgError">avgError</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.mainLoop">mainLoop</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.decode_top_k">decode_top_k</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.eval_slice">eval_slice</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.data_prep">data_prep</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.getCounts">getCounts</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.expand">expand</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.find_score_basic_slices">find_score_basic_slices</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.get_pair_candidates">get_pair_candidates</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.analyze_topK">analyze_topK</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.score">score</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.upperbound_score">upperbound_score</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.maintainTopK">maintainTopK</a>
                        </li>
                        <li>
                                <a class="function" href="#SliceFinder.pretty_print_results">pretty_print_results</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#testBed">testBed</a>
            </li>
            <li>
                    <a class="function" href="#testAdult">testAdult</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
SliceLine    </h1>

                
                        <input id="mod-SliceLine-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-SliceLine-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">prepAdult</span><span class="p">,</span> <span class="n">getLogger</span><span class="p">,</span> <span class="n">unpickleDataset</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1">#------------------------------</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1">#TODO X0 has integer encoded featrues (categorical) 1-|fi| our dataset does not !!!!</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1">#------------------------------  </span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">SliceFinder</span><span class="p">:</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="w">    </span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">        An implementation of SliceLine Fast Linear Alebra Based Slice Finding</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        </span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        Algorithm Credit: https://dl.acm.org/doi/10.1145/3448016.3457323</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        Parameters:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">            K (int)</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">            X (matrix of size of size n x m)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">            e  (vector of size containing error for each point) </span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">            σ (int, size threshold)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">            ∝ (score function parameter)</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">            L (how many level of the lattice to prune)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        </span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        Returns: </span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">            TS (a K x m matrix)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">                Each row is a slice that was picked as topk</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">                Each feature is in {0, 1} where a 0 means a feature is not considered in the slice (free)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">            TR (a K x 3 matrix of statistics for each slice)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">                Score</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">                Error</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">                Size</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="c1">#e: list of errors for each datapoint</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="c1">#sigma: size threshold for smallest allowable slice</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="c1">#alpha: score function balancing parameter</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="c1">#L : how many levels of the lattice to prune</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="c1">#Initilize variables</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="k">if</span> <span class="n">logger</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;dummyLog.log&quot;</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>            
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X0</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">L_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avgError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;samples: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;features: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;avg error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avgError</span><span class="p">))</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="c1">#one hot encode dataset and get new feature begginings (fb) and ends (fe)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">fdom</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_prep</span><span class="p">()</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="c1">#new number of features</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="c1">#get 1-predicate slices, stats, pruning indicator</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_score_basic_slices</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="c1">#Top slices (TS), top statistics (TR)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="n">TS</span><span class="p">,</span> <span class="n">TR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintainTopK</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="c1">#Run recursive step</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainLoop</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">TS</span><span class="p">,</span> <span class="n">TR</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">mainLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">            Executes the recursive part of sliceLine</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">            </span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">            :param X: </span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">                a one hot encoded dataset matrix</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">                </span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">            :param S: </span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">                a set of 1-predicate slices</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">                </span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            :param R: </span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">                Statistics for the 1-predicate slices. (R[0] = ...)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">            </span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">            :param CI: </span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">                Pruning indicator for basic slices.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">            </span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">            :param TK: </span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">                Top-k slice representations.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">            </span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">            :param TKC: </span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">                Top-k slice statistics.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">            </span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">            :param fb: </span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">                Feature beginnings.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">            </span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            :param fe: </span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">                Feature endings.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            :return: </span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">                Top slices (TK) and statistics (TKC) in a dict</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">            :rtype: dict</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">                </span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entering the main loop&quot;</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pruning current slices&quot;</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">CI</span><span class="p">]</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="c1">#while there are still valid slices left and </span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">while</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_max</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Forming new slices for level &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pair_candidates</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Evaluating new slices&quot;</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">L</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Maintaing topk&quot;</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintainTopK</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;finished in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span> <span class="p">))</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;decoding top-k slices&quot;</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="n">TK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_top_k</span><span class="p">(</span><span class="n">TK</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;TK&quot;</span> <span class="p">:</span> <span class="n">TK</span><span class="p">,</span> <span class="s2">&quot;TKC&quot;</span> <span class="p">:</span> <span class="n">TKC</span><span class="p">}</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">decode_top_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        Summary:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            Convert slice representations back to their original form </span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">            (before `X` was one-hot encoded).</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        </span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        :param TK: </span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">            Matrix of the top-k slices.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        </span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        :param fb: </span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">            List of feature beginnings.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        </span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        :param fe: </span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            List of feature endings.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        </span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        :return: </span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            Top-k slice representations from the original dataset `X`.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="n">TK_decoded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="c1">#for each feature beg-end</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fb</span><span class="p">)):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>                <span class="c1">#find the index in the expanded fature with a 1, that poisition is feature number</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>                <span class="n">sub_TK</span> <span class="o">=</span> <span class="n">TK</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>  
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> 
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                <span class="n">maxcol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                <span class="n">maxcol</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">maxcol</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                <span class="n">TK_decoded</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">TK_decoded</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="k">def</span> <span class="nf">eval_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        Summary:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">            Get statistics for slice `S`.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        </span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        :param X: </span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">            One-hot encoded dataset.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        </span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        :param e: </span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            Error vector for the entire dataset.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        </span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        :param S: </span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">            A slice that needs to be evaluated.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        </span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        :return: </span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            Vector where `stats[0]` is the score, `stats[1]` is the error, </span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">            `stats[2]` is the maximum error, and `stats[3]` is the size.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="c1">#indicator for which columns of error vector this slice needs</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="n">s_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">S</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="c1">#slice size, total error, max error, score</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">s_mask</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_mask</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">s_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="c1">#stack them to form a row in </span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">data_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Summary: </span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">            1. Find domains for each feature.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">            2. Compute start and end offsets of each feature.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            3. Get one-hot encoding of the entire dataset.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        </span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        :return: </span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">            - fdom: Domains sizes for each feature.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">            - fb: Feature beginnings in the one-hot matrix.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">            - fe: Feature endings in the one-hot matrix.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">            - X: One-hot encoded dataset.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="c1">#fdom (feature domain sizes) are the maximum value along ecah column of the dataset for continuous integer encoding</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">fdom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fdom: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="c1">#fb is where each feature in new matrix starts</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">fb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fdom</span><span class="p">)</span> <span class="o">-</span> <span class="n">fdom</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fb: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fb</span><span class="p">))</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="c1">#fe is where each feature in new matrix ends</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">fe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fdom</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fe: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fe</span><span class="p">))</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="c1">#one hot encode the entire dataset</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="k">return</span> <span class="n">fdom</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">X</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="nf">getCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        Summary:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">            - Count bins for an integer or vector.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            - For integers, it returns a set of bins with that integer&#39;s bin set to value 1.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">            - For vectors, it returns a set of bins where `bins[i]` is the number of occurrences of `i` in the vector.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        </span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        :param v: </span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">            Vector or integer to be counted.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        </span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        :param vmax: </span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">            The number of bins to include. Must be &gt;= the largest element in `v`.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">        </span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        :return: </span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">            Bins for the given input. For integers, it returns a set with the corresponding bin set to 1. For vectors, it returns a set where each bin contains the count of occurrences of the index in the vector.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        &quot;&quot;&quot;</span>            
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">bins</span><span class="p">))</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">vec</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="k">return</span> <span class="n">vec</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">bins</span><span class="p">))</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="k">for</span> <span class="n">vij</span> <span class="ow">in</span> <span class="n">vi</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>                <span class="n">vec</span><span class="p">[</span><span class="n">vij</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;unsupported use of getCounts&quot;</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="n">exit</span><span class="p">()</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            Summary:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">                gets a dense matrix representation of a sparse matrix v</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            </span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="c1">#count number of occourances for each value in each row</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCounts</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">m</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="n">R</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">find_score_basic_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        Summary:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            Find the 1-predicate slices and their statistics.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        </span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        :param X: </span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            One-hot encoded dataset.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        </span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        :return: </span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            - S: Basic slices.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">            - R: Basic slice statistics.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            - CI: Pruning indicator based on size and score.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="c1">#ss0 = sizes of each basic slice are column sums</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">ss0</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ss0: </span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ss0</span><span class="p">))</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="c1">#se0 = error of each basic slice</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="n">se0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="c1">#sm0 = the maximum error among elements in each slice</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="n">sm0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="c1">#pruning indicator</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="n">ss0</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">se0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="c1">#prune basic slice scores and errors</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">se0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">sm0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ss: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;se: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">se</span><span class="p">))</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sm: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sm</span><span class="p">))</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="c1">#a set of pruned slices (very sparse matrix representation)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)[</span><span class="n">CI</span><span class="p">],</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="c1">#slice scores</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="c1">#form statistics matrix</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">slices</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">get_pair_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        Summary:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">            Form a set of valid L-predicate slices using the given L-1 predicate slices `S`.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">            1. Form every combination of slices from level L-1.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">            2. Prune those without L-2 overlap.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">            3. Form row and column index pairs of valid combinations.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">            4. Get parents using row, column index pairs.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">            5. Form new slices.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">            6. Prune slices that assign more than one value to a feature.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">            7. Extract size and error for new slices as the minimum of their parents.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">            8. Perform deduplication using unique IDs.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">            9. Upper bound the scoring function and prune new slices.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        </span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        :param S: </span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">            Slices from level L-1.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">        </span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        :param R: </span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">            Statistics for those slices.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        </span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">        :param TKC: </span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">            Top-k slice statistics.</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        </span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        :param L: </span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">            Current level of slices.</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        </span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        :param fb: </span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">            Feature beginnings.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        </span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        :param fe: </span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">            Feature endings.</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        </span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        :return: </span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">            - P: A set of valid pair candidates.</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="c1">#prune invalid input slices using thresholds for size (sigma) and error (non-negative)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="c1">#(S ⊙ S.T) creates every possible combination of slices</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="n">SST</span> <span class="o">=</span> <span class="n">S</span> <span class="o">@</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="c1">#valid slices should have L-2 overlap</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="n">valid_SST</span> <span class="o">=</span> <span class="p">(</span><span class="n">SST</span> <span class="o">==</span> <span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="c1">#since the matrix is symetric we only need top half</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="c1">#I is a mask for new slices with L-2 overlap</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">valid_SST</span><span class="p">)</span> <span class="o">*</span> <span class="n">valid_SST</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="c1">#create combined slices parents by converting I to row, column index pairs (rix and cix)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="c1">#form row index matrix</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_cols</span><span class="p">))</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">rix</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="p">[</span> <span class="n">rix</span><span class="o">!=</span><span class="mi">0</span> <span class="p">]</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="c1">#column index matrix</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_cols</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">cix</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="p">[</span><span class="n">cix</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="c1">#if there are new slices</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rix</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="c1">#get parents</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="n">P1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">rix</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="n">P2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">cix</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="c1">#form new slices</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="n">newSlices</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">P2</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="p">(((</span><span class="n">P1</span> <span class="o">@</span> <span class="n">S</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">P2</span> <span class="o">@</span> <span class="n">S</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                 
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error, ran out of valid slices&quot;</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">exit</span><span class="p">()</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="c1">#extract new slice sizes and errors as minimum of parents (with parent handling)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="c1">#discard invalid slices with multiple assignments per feature using indicator I</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="c1">#with each expanded feature (from beg-end)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>            
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>            <span class="c1">#make sure it only has 1 domain value assigned to it</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">rowsums</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="c1">#update mask to exclude features with more than one value</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">&amp;</span> <span class="n">rowsums</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="c1">#prune slices with more than one assignment per feature</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="n">newSlices</span> <span class="o">=</span> <span class="n">newSlices</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">se</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">sm</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="c1">#deduplication </span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">dom</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-</span><span class="n">fb</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="c1">#unique ids for each slice are the sum of weighted feature contributions.  Makes it so slices map to same ID if they have same features</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="n">max_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">max_col</span> <span class="o">*</span> <span class="n">rowsums</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>            <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dom</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>            
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>            <span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span> <span class="o">+</span> <span class="n">I</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>    
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="c1">#map cotains deduplication pruning mask</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="nb">map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ID</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="c1">#size pruning by upper bounding sizes</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">ub_sizes</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ex</span> <span class="o">@</span> <span class="n">ss</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="n">ub_sizes</span><span class="p">[</span><span class="n">ub_sizes</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="n">f_sizes</span> <span class="o">=</span> <span class="n">ub_sizes</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="c1">#error pruning mask</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="n">ub_error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ex</span> <span class="o">@</span> <span class="n">se</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="n">ub_error</span><span class="p">[</span><span class="n">ub_error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="n">ub_max_error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="n">ex</span> <span class="o">@</span> <span class="n">sm</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="n">ub_max_error</span><span class="p">[</span><span class="n">ub_max_error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="c1">#score pruning mask</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">ub_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperbound_score</span><span class="p">(</span><span class="n">ub_sizes</span><span class="p">,</span> <span class="n">ub_error</span><span class="p">,</span> <span class="n">ub_max_error</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">TMP3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_topK</span><span class="p">(</span><span class="n">TKC</span><span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">minsc</span> <span class="o">=</span> <span class="n">TMP3</span><span class="p">[</span><span class="s2">&quot;minScore&quot;</span><span class="p">]</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="n">fScores</span> <span class="o">=</span> <span class="p">(</span><span class="n">ub_scores</span> <span class="o">&gt;</span> <span class="n">minsc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub_scores</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="c1">#missing parents pruning mask</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="n">sparse_map</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="n">sparse_slices</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">newSlices</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">result_sparse</span> <span class="o">=</span> <span class="n">sparse_map</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sparse_slices</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="n">num_parents</span> <span class="o">=</span> <span class="n">result_sparse</span><span class="o">.</span><span class="n">nnz</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="n">f_parents</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_parents</span> <span class="o">==</span> <span class="n">L</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="c1">#combine all pruning masks</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="nb">map</span> <span class="o">=</span> <span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_sizes</span> <span class="o">&amp;</span> <span class="n">fScores</span> <span class="o">&amp;</span> <span class="n">f_parents</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="c1">#apply masks</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="n">dedup</span> <span class="o">=</span> <span class="nb">map</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,:]</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">dedup</span> <span class="o">@</span> <span class="n">P</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="k">return</span> <span class="n">P</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>    
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>    
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>    <span class="k">def</span> <span class="nf">analyze_topK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TKC</span><span class="p">):</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        Summary:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">            Find the minimum and maximum score in the current top-k set `TKC`.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">        </span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">        :param TKC: </span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">            A k x 4 matrix of statistics for the current slices.</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">        </span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">        :return: </span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="sd">            A dictionary containing:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">            - `&quot;maxScore&quot;`: The maximum score (float).</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">            - `&quot;minScore&quot;`: The minimum score (float).</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="n">maxScore</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="n">minScore</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="k">if</span> <span class="n">TKC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>            <span class="n">maxScore</span> <span class="o">=</span> <span class="n">TKC</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>            <span class="n">minScore</span> <span class="o">=</span> <span class="n">TKC</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">TKC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>            
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;maxScore&quot;</span> <span class="p">:</span> <span class="n">maxScore</span><span class="p">,</span> <span class="s2">&quot;minScore&quot;</span> <span class="p">:</span> <span class="n">minScore</span><span class="p">}</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>    
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_sizes</span><span class="p">,</span> <span class="n">slice_errors</span><span class="p">,</span> <span class="n">total_samples</span><span class="p">):</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">        Summary:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">            Apply the SliceLines scoring function. If division by zero occurs, return `-inf`.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">        </span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">        :param sliceSizes: </span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">            Vector of sizes for each slice.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        </span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">        :param sliceErrors: </span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">            Vector of errors for each slice.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">        </span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">        :param nrows: </span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">            Number of samples in the entire dataset.</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">        </span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">        :return: </span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">            The computed scores for each slice, with `-inf` for cases where division by zero occurs.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">((</span><span class="n">slice_errors</span><span class="o">/</span><span class="n">slice_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgError</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_samples</span><span class="o">/</span><span class="n">slice_sizes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">nan</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>    
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>    
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">upperbound_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">):</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">        Summary:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">            Compute an upper bound for the SliceLines scoring function.</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">        </span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">        :param ss: </span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">            Vector containing the size of each slice.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a><span class="sd">        </span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        :param se: </span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">            Vector containing the error for each slice.</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a><span class="sd">        </span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">        :param sm: </span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">            Vector containing the maximum error for each slice.</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a><span class="sd">        </span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">        :return: </span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="sd">            The computed upper bound for the SliceLines scoring function.</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="c1"># probe interesting points of sc in the interval [minSup, ss],</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="c1"># and compute the maximum to serve as the upper bound </span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="c1">#s is the critical points we have to check</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">ss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">se</span><span class="o">/</span><span class="n">sm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span> <span class="n">ss</span><span class="p">))</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="n">smex</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sm</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">sm</span><span class="p">))</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="n">seex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">se</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">se</span><span class="p">))</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="n">pmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">smex</span><span class="p">,</span> <span class="n">seex</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">((</span><span class="n">pmin</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_error</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">s</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">nan</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>        
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>        
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="k">return</span> <span class="n">sc</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>            
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>    <span class="k">def</span> <span class="nf">maintainTopK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">):</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a><span class="sd">        Summary:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">            Update the top-k slices and their statistics given the new slices `S` and statistics `R`.</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">        </span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">        :param S: </span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">            New slices to be considered for updating the top-k.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">        </span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="sd">        :param R: </span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">            New statistics corresponding to the new slices `S`.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a><span class="sd">        </span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">        :param TK: </span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">            Current top-k slices that will be updated.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="sd">        </span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="sd">        :param TKC: </span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">            Current top-k statistics that will be updated.</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">        </span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a><span class="sd">        :return: </span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="sd">            - `TK`: Updated top-k slices.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="sd">            - `TKC`: Updated top-k statistics.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>        
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Maintain topk:&quot;</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>        <span class="n">top_k_indicies</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="c1">#prune on size and score</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>        
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="c1">#if there are still valid slices left</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>            <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>            
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>            <span class="c1">#???</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>            <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>                <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span> 
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>                
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; S </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; R </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>            
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>            <span class="n">slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TK</span><span class="p">,</span> <span class="n">S</span><span class="p">))</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TKC</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;slices </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slices</span><span class="p">))</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;scores </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>            
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>            
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>            <span class="c1">#find new top-k slice indicies</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>            <span class="n">sorted_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>            <span class="n">top_idxs</span> <span class="o">=</span> <span class="n">sorted_idxs</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_idxs</span><span class="p">))]</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sorted idxs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sorted_idxs</span><span class="p">))</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;topk idxs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_idxs</span><span class="p">))</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>            
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>            <span class="c1">#update top slices and top statistics with new topk values</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>            <span class="n">TK</span> <span class="o">=</span> <span class="n">slices</span><span class="p">[</span><span class="n">top_idxs</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>            <span class="n">TKC</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">top_idxs</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>            
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>        
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>    
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>    
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>    <span class="k">def</span> <span class="nf">pretty_print_results</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">featureNames</span><span class="p">,</span> <span class="n">domainValues</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">        Summary:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">            Print the top-k selected slices and their statistics. </span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">            Fill in the numeric column names and domain values with their actual values.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">        </span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">        :param result: </span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">            A dictionary containing:</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">            - `&quot;TK&quot;`: Top-k slices.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a><span class="sd">            - `&quot;TKC&quot;`: Top-k statistics.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a><span class="sd">        </span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a><span class="sd">        :param featureNames: </span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="sd">            A list of names for each feature, 1-indexed. </span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">            `featureNames[0]` should be an empty string.</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">        </span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a><span class="sd">        :param domainValues: </span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a><span class="sd">            A matrix where `domainValues[i][k]` is the name of the feature `i` taking on the `k`th domain value.</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a><span class="sd">        </span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a><span class="sd">        :return: </span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a><span class="sd">            None. Prints the output to the screen.</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        <span class="n">TK</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;TK&quot;</span><span class="p">]</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="n">TKC</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;TKC&quot;</span><span class="p">]</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>        
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>        <span class="c1">#print(&quot;TK&quot;)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>        <span class="c1">#print(TK)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>        
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>        <span class="c1">#print(&quot;TKC&quot;)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="c1">#print(TKC)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>        
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>        
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>        
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>        <span class="k">for</span> <span class="nb">slice</span> <span class="ow">in</span> <span class="n">TK</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slice &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>            
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------&quot;</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>            <span class="c1">#print features</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">slice</span><span class="p">)):</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>                <span class="k">if</span> <span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>                    
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>                    <span class="k">if</span> <span class="n">domainValues</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureNames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureNames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domainValues</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>                        
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>                    
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>            <span class="c1">#print scores</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------&quot;</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   score: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   avg. error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   max error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>            
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>            
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>        
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>        
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>      
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>       
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a><span class="k">def</span> <span class="nf">testBed</span><span class="p">():</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a><span class="sd">        Summary:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a><span class="sd">            Run sliceline on a toy example and print the results</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>    
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>    <span class="c1">#dummy data has 3 samples of 4 features where sample i has all features set to value i</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>    <span class="c1">#errors are 1,2,3</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>    
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;test.log&quot;</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>    <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>    
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>    <span class="n">sf</span> <span class="o">=</span> <span class="n">SliceFinder</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>    <span class="n">sf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>    
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>    <span class="n">SliceFinder</span><span class="o">.</span><span class="n">pretty_print_results</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;feature 1&quot;</span><span class="p">,</span> <span class="s2">&quot;feature 2&quot;</span><span class="p">,</span> <span class="s2">&quot;feature 3&quot;</span><span class="p">,</span> <span class="s2">&quot;feature 4&quot;</span><span class="p">])</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>    <span class="c1">#print(&quot;foo result&quot;)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>    <span class="c1">#print(foo.result)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>    
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="k">def</span> <span class="nf">testAdult</span><span class="p">():</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a><span class="sd">        Summary:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a><span class="sd">            Run sliceLine on adult dataset with dummy errors</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;test.log&quot;</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">unpickleDataset</span><span class="p">(</span><span class="s2">&quot;./Data/Adult/train.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;./Data/Adult/test.pkl&quot;</span><span class="p">)</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>    
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>    <span class="n">errors_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>    <span class="n">errors_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./Data/Adult/dummyErrors.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>    
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>    <span class="n">sf</span> <span class="o">=</span> <span class="n">SliceFinder</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>    <span class="n">sf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>    <span class="n">SliceFinder</span><span class="o">.</span><span class="n">pretty_print_results</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;feature&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">86</span><span class="p">)])</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>    
</span></pre></div>


            </section>
                <section id="SliceFinder">
                            <input id="SliceFinder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SliceFinder</span>:

                <label class="view-source-button" for="SliceFinder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder-20"><a href="#SliceFinder-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">SliceFinder</span><span class="p">:</span>
</span><span id="SliceFinder-21"><a href="#SliceFinder-21"><span class="linenos"> 21</span></a><span class="w">    </span>
</span><span id="SliceFinder-22"><a href="#SliceFinder-22"><span class="linenos"> 22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-23"><a href="#SliceFinder-23"><span class="linenos"> 23</span></a>
</span><span id="SliceFinder-24"><a href="#SliceFinder-24"><span class="linenos"> 24</span></a><span class="sd">        An implementation of SliceLine Fast Linear Alebra Based Slice Finding</span>
</span><span id="SliceFinder-25"><a href="#SliceFinder-25"><span class="linenos"> 25</span></a><span class="sd">        </span>
</span><span id="SliceFinder-26"><a href="#SliceFinder-26"><span class="linenos"> 26</span></a><span class="sd">        Algorithm Credit: https://dl.acm.org/doi/10.1145/3448016.3457323</span>
</span><span id="SliceFinder-27"><a href="#SliceFinder-27"><span class="linenos"> 27</span></a>
</span><span id="SliceFinder-28"><a href="#SliceFinder-28"><span class="linenos"> 28</span></a>
</span><span id="SliceFinder-29"><a href="#SliceFinder-29"><span class="linenos"> 29</span></a><span class="sd">        Parameters:</span>
</span><span id="SliceFinder-30"><a href="#SliceFinder-30"><span class="linenos"> 30</span></a><span class="sd">            K (int)</span>
</span><span id="SliceFinder-31"><a href="#SliceFinder-31"><span class="linenos"> 31</span></a><span class="sd">            X (matrix of size of size n x m)</span>
</span><span id="SliceFinder-32"><a href="#SliceFinder-32"><span class="linenos"> 32</span></a><span class="sd">            e  (vector of size containing error for each point) </span>
</span><span id="SliceFinder-33"><a href="#SliceFinder-33"><span class="linenos"> 33</span></a><span class="sd">            σ (int, size threshold)</span>
</span><span id="SliceFinder-34"><a href="#SliceFinder-34"><span class="linenos"> 34</span></a><span class="sd">            ∝ (score function parameter)</span>
</span><span id="SliceFinder-35"><a href="#SliceFinder-35"><span class="linenos"> 35</span></a><span class="sd">            L (how many level of the lattice to prune)</span>
</span><span id="SliceFinder-36"><a href="#SliceFinder-36"><span class="linenos"> 36</span></a><span class="sd">        </span>
</span><span id="SliceFinder-37"><a href="#SliceFinder-37"><span class="linenos"> 37</span></a>
</span><span id="SliceFinder-38"><a href="#SliceFinder-38"><span class="linenos"> 38</span></a><span class="sd">        Returns: </span>
</span><span id="SliceFinder-39"><a href="#SliceFinder-39"><span class="linenos"> 39</span></a><span class="sd">            TS (a K x m matrix)</span>
</span><span id="SliceFinder-40"><a href="#SliceFinder-40"><span class="linenos"> 40</span></a><span class="sd">                Each row is a slice that was picked as topk</span>
</span><span id="SliceFinder-41"><a href="#SliceFinder-41"><span class="linenos"> 41</span></a><span class="sd">                Each feature is in {0, 1} where a 0 means a feature is not considered in the slice (free)</span>
</span><span id="SliceFinder-42"><a href="#SliceFinder-42"><span class="linenos"> 42</span></a><span class="sd">            TR (a K x 3 matrix of statistics for each slice)</span>
</span><span id="SliceFinder-43"><a href="#SliceFinder-43"><span class="linenos"> 43</span></a><span class="sd">                Score</span>
</span><span id="SliceFinder-44"><a href="#SliceFinder-44"><span class="linenos"> 44</span></a><span class="sd">                Error</span>
</span><span id="SliceFinder-45"><a href="#SliceFinder-45"><span class="linenos"> 45</span></a><span class="sd">                Size</span>
</span><span id="SliceFinder-46"><a href="#SliceFinder-46"><span class="linenos"> 46</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SliceFinder-47"><a href="#SliceFinder-47"><span class="linenos"> 47</span></a>
</span><span id="SliceFinder-48"><a href="#SliceFinder-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SliceFinder-49"><a href="#SliceFinder-49"><span class="linenos"> 49</span></a>        <span class="c1">#e: list of errors for each datapoint</span>
</span><span id="SliceFinder-50"><a href="#SliceFinder-50"><span class="linenos"> 50</span></a>        <span class="c1">#sigma: size threshold for smallest allowable slice</span>
</span><span id="SliceFinder-51"><a href="#SliceFinder-51"><span class="linenos"> 51</span></a>        <span class="c1">#alpha: score function balancing parameter</span>
</span><span id="SliceFinder-52"><a href="#SliceFinder-52"><span class="linenos"> 52</span></a>        <span class="c1">#L : how many levels of the lattice to prune</span>
</span><span id="SliceFinder-53"><a href="#SliceFinder-53"><span class="linenos"> 53</span></a>        
</span><span id="SliceFinder-54"><a href="#SliceFinder-54"><span class="linenos"> 54</span></a>        
</span><span id="SliceFinder-55"><a href="#SliceFinder-55"><span class="linenos"> 55</span></a>        <span class="c1">#Initilize variables</span>
</span><span id="SliceFinder-56"><a href="#SliceFinder-56"><span class="linenos"> 56</span></a>        <span class="k">if</span> <span class="n">logger</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SliceFinder-57"><a href="#SliceFinder-57"><span class="linenos"> 57</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;dummyLog.log&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-58"><a href="#SliceFinder-58"><span class="linenos"> 58</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder-59"><a href="#SliceFinder-59"><span class="linenos"> 59</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="SliceFinder-60"><a href="#SliceFinder-60"><span class="linenos"> 60</span></a>            
</span><span id="SliceFinder-61"><a href="#SliceFinder-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X0</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="SliceFinder-62"><a href="#SliceFinder-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="SliceFinder-63"><a href="#SliceFinder-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="SliceFinder-64"><a href="#SliceFinder-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
</span><span id="SliceFinder-65"><a href="#SliceFinder-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="SliceFinder-66"><a href="#SliceFinder-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SliceFinder-67"><a href="#SliceFinder-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">L_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
</span><span id="SliceFinder-68"><a href="#SliceFinder-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avgError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
</span><span id="SliceFinder-69"><a href="#SliceFinder-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;samples: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
</span><span id="SliceFinder-70"><a href="#SliceFinder-70"><span class="linenos"> 70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;features: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
</span><span id="SliceFinder-71"><a href="#SliceFinder-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;avg error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avgError</span><span class="p">))</span>
</span><span id="SliceFinder-72"><a href="#SliceFinder-72"><span class="linenos"> 72</span></a>        
</span><span id="SliceFinder-73"><a href="#SliceFinder-73"><span class="linenos"> 73</span></a>        
</span><span id="SliceFinder-74"><a href="#SliceFinder-74"><span class="linenos"> 74</span></a>        
</span><span id="SliceFinder-75"><a href="#SliceFinder-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
</span><span id="SliceFinder-76"><a href="#SliceFinder-76"><span class="linenos"> 76</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="SliceFinder-77"><a href="#SliceFinder-77"><span class="linenos"> 77</span></a>
</span><span id="SliceFinder-78"><a href="#SliceFinder-78"><span class="linenos"> 78</span></a>    
</span><span id="SliceFinder-79"><a href="#SliceFinder-79"><span class="linenos"> 79</span></a>    
</span><span id="SliceFinder-80"><a href="#SliceFinder-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SliceFinder-81"><a href="#SliceFinder-81"><span class="linenos"> 81</span></a>        <span class="c1">#one hot encode dataset and get new feature begginings (fb) and ends (fe)</span>
</span><span id="SliceFinder-82"><a href="#SliceFinder-82"><span class="linenos"> 82</span></a>        <span class="n">fdom</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_prep</span><span class="p">()</span>
</span><span id="SliceFinder-83"><a href="#SliceFinder-83"><span class="linenos"> 83</span></a>        
</span><span id="SliceFinder-84"><a href="#SliceFinder-84"><span class="linenos"> 84</span></a>        <span class="c1">#new number of features</span>
</span><span id="SliceFinder-85"><a href="#SliceFinder-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SliceFinder-86"><a href="#SliceFinder-86"><span class="linenos"> 86</span></a>        
</span><span id="SliceFinder-87"><a href="#SliceFinder-87"><span class="linenos"> 87</span></a>        <span class="c1">#get 1-predicate slices, stats, pruning indicator</span>
</span><span id="SliceFinder-88"><a href="#SliceFinder-88"><span class="linenos"> 88</span></a>        <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_score_basic_slices</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="SliceFinder-89"><a href="#SliceFinder-89"><span class="linenos"> 89</span></a>        
</span><span id="SliceFinder-90"><a href="#SliceFinder-90"><span class="linenos"> 90</span></a>        <span class="c1">#Top slices (TS), top statistics (TR)</span>
</span><span id="SliceFinder-91"><a href="#SliceFinder-91"><span class="linenos"> 91</span></a>        <span class="n">TS</span><span class="p">,</span> <span class="n">TR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintainTopK</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
</span><span id="SliceFinder-92"><a href="#SliceFinder-92"><span class="linenos"> 92</span></a>        
</span><span id="SliceFinder-93"><a href="#SliceFinder-93"><span class="linenos"> 93</span></a>        <span class="c1">#Run recursive step</span>
</span><span id="SliceFinder-94"><a href="#SliceFinder-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainLoop</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">TS</span><span class="p">,</span> <span class="n">TR</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="SliceFinder-95"><a href="#SliceFinder-95"><span class="linenos"> 95</span></a>    
</span><span id="SliceFinder-96"><a href="#SliceFinder-96"><span class="linenos"> 96</span></a>    
</span><span id="SliceFinder-97"><a href="#SliceFinder-97"><span class="linenos"> 97</span></a>    
</span><span id="SliceFinder-98"><a href="#SliceFinder-98"><span class="linenos"> 98</span></a>    
</span><span id="SliceFinder-99"><a href="#SliceFinder-99"><span class="linenos"> 99</span></a>
</span><span id="SliceFinder-100"><a href="#SliceFinder-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">mainLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="SliceFinder-101"><a href="#SliceFinder-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-102"><a href="#SliceFinder-102"><span class="linenos">102</span></a>
</span><span id="SliceFinder-103"><a href="#SliceFinder-103"><span class="linenos">103</span></a><span class="sd">            Executes the recursive part of sliceLine</span>
</span><span id="SliceFinder-104"><a href="#SliceFinder-104"><span class="linenos">104</span></a><span class="sd">            </span>
</span><span id="SliceFinder-105"><a href="#SliceFinder-105"><span class="linenos">105</span></a><span class="sd">            :param X: </span>
</span><span id="SliceFinder-106"><a href="#SliceFinder-106"><span class="linenos">106</span></a><span class="sd">                a one hot encoded dataset matrix</span>
</span><span id="SliceFinder-107"><a href="#SliceFinder-107"><span class="linenos">107</span></a><span class="sd">                </span>
</span><span id="SliceFinder-108"><a href="#SliceFinder-108"><span class="linenos">108</span></a><span class="sd">            :param S: </span>
</span><span id="SliceFinder-109"><a href="#SliceFinder-109"><span class="linenos">109</span></a><span class="sd">                a set of 1-predicate slices</span>
</span><span id="SliceFinder-110"><a href="#SliceFinder-110"><span class="linenos">110</span></a><span class="sd">                </span>
</span><span id="SliceFinder-111"><a href="#SliceFinder-111"><span class="linenos">111</span></a><span class="sd">            :param R: </span>
</span><span id="SliceFinder-112"><a href="#SliceFinder-112"><span class="linenos">112</span></a><span class="sd">                Statistics for the 1-predicate slices. (R[0] = ...)</span>
</span><span id="SliceFinder-113"><a href="#SliceFinder-113"><span class="linenos">113</span></a><span class="sd">            </span>
</span><span id="SliceFinder-114"><a href="#SliceFinder-114"><span class="linenos">114</span></a><span class="sd">            :param CI: </span>
</span><span id="SliceFinder-115"><a href="#SliceFinder-115"><span class="linenos">115</span></a><span class="sd">                Pruning indicator for basic slices.</span>
</span><span id="SliceFinder-116"><a href="#SliceFinder-116"><span class="linenos">116</span></a><span class="sd">            </span>
</span><span id="SliceFinder-117"><a href="#SliceFinder-117"><span class="linenos">117</span></a><span class="sd">            :param TK: </span>
</span><span id="SliceFinder-118"><a href="#SliceFinder-118"><span class="linenos">118</span></a><span class="sd">                Top-k slice representations.</span>
</span><span id="SliceFinder-119"><a href="#SliceFinder-119"><span class="linenos">119</span></a><span class="sd">            </span>
</span><span id="SliceFinder-120"><a href="#SliceFinder-120"><span class="linenos">120</span></a><span class="sd">            :param TKC: </span>
</span><span id="SliceFinder-121"><a href="#SliceFinder-121"><span class="linenos">121</span></a><span class="sd">                Top-k slice statistics.</span>
</span><span id="SliceFinder-122"><a href="#SliceFinder-122"><span class="linenos">122</span></a><span class="sd">            </span>
</span><span id="SliceFinder-123"><a href="#SliceFinder-123"><span class="linenos">123</span></a><span class="sd">            :param fb: </span>
</span><span id="SliceFinder-124"><a href="#SliceFinder-124"><span class="linenos">124</span></a><span class="sd">                Feature beginnings.</span>
</span><span id="SliceFinder-125"><a href="#SliceFinder-125"><span class="linenos">125</span></a><span class="sd">            </span>
</span><span id="SliceFinder-126"><a href="#SliceFinder-126"><span class="linenos">126</span></a><span class="sd">            :param fe: </span>
</span><span id="SliceFinder-127"><a href="#SliceFinder-127"><span class="linenos">127</span></a><span class="sd">                Feature endings.</span>
</span><span id="SliceFinder-128"><a href="#SliceFinder-128"><span class="linenos">128</span></a>
</span><span id="SliceFinder-129"><a href="#SliceFinder-129"><span class="linenos">129</span></a><span class="sd">            :return: </span>
</span><span id="SliceFinder-130"><a href="#SliceFinder-130"><span class="linenos">130</span></a><span class="sd">                Top slices (TK) and statistics (TKC) in a dict</span>
</span><span id="SliceFinder-131"><a href="#SliceFinder-131"><span class="linenos">131</span></a><span class="sd">            :rtype: dict</span>
</span><span id="SliceFinder-132"><a href="#SliceFinder-132"><span class="linenos">132</span></a><span class="sd">                </span>
</span><span id="SliceFinder-133"><a href="#SliceFinder-133"><span class="linenos">133</span></a>
</span><span id="SliceFinder-134"><a href="#SliceFinder-134"><span class="linenos">134</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SliceFinder-135"><a href="#SliceFinder-135"><span class="linenos">135</span></a>        
</span><span id="SliceFinder-136"><a href="#SliceFinder-136"><span class="linenos">136</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="SliceFinder-137"><a href="#SliceFinder-137"><span class="linenos">137</span></a>        
</span><span id="SliceFinder-138"><a href="#SliceFinder-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entering the main loop&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-139"><a href="#SliceFinder-139"><span class="linenos">139</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SliceFinder-140"><a href="#SliceFinder-140"><span class="linenos">140</span></a>        
</span><span id="SliceFinder-141"><a href="#SliceFinder-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pruning current slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-142"><a href="#SliceFinder-142"><span class="linenos">142</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder-143"><a href="#SliceFinder-143"><span class="linenos">143</span></a>        
</span><span id="SliceFinder-144"><a href="#SliceFinder-144"><span class="linenos">144</span></a>        <span class="c1">#while there are still valid slices left and </span>
</span><span id="SliceFinder-145"><a href="#SliceFinder-145"><span class="linenos">145</span></a>        <span class="k">while</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_max</span><span class="p">):</span>
</span><span id="SliceFinder-146"><a href="#SliceFinder-146"><span class="linenos">146</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span>
</span><span id="SliceFinder-147"><a href="#SliceFinder-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Forming new slices for level &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
</span><span id="SliceFinder-148"><a href="#SliceFinder-148"><span class="linenos">148</span></a>            <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pair_candidates</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="SliceFinder-149"><a href="#SliceFinder-149"><span class="linenos">149</span></a>            
</span><span id="SliceFinder-150"><a href="#SliceFinder-150"><span class="linenos">150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Evaluating new slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-151"><a href="#SliceFinder-151"><span class="linenos">151</span></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="SliceFinder-152"><a href="#SliceFinder-152"><span class="linenos">152</span></a>
</span><span id="SliceFinder-153"><a href="#SliceFinder-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder-154"><a href="#SliceFinder-154"><span class="linenos">154</span></a>                <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">L</span><span class="p">)</span>
</span><span id="SliceFinder-155"><a href="#SliceFinder-155"><span class="linenos">155</span></a>            
</span><span id="SliceFinder-156"><a href="#SliceFinder-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Maintaing topk&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-157"><a href="#SliceFinder-157"><span class="linenos">157</span></a>            <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintainTopK</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">)</span>
</span><span id="SliceFinder-158"><a href="#SliceFinder-158"><span class="linenos">158</span></a>            
</span><span id="SliceFinder-159"><a href="#SliceFinder-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;finished in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span> <span class="p">))</span>
</span><span id="SliceFinder-160"><a href="#SliceFinder-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;decoding top-k slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-161"><a href="#SliceFinder-161"><span class="linenos">161</span></a>        <span class="n">TK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_top_k</span><span class="p">(</span><span class="n">TK</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="SliceFinder-162"><a href="#SliceFinder-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;TK&quot;</span> <span class="p">:</span> <span class="n">TK</span><span class="p">,</span> <span class="s2">&quot;TKC&quot;</span> <span class="p">:</span> <span class="n">TKC</span><span class="p">}</span>
</span><span id="SliceFinder-163"><a href="#SliceFinder-163"><span class="linenos">163</span></a>            
</span><span id="SliceFinder-164"><a href="#SliceFinder-164"><span class="linenos">164</span></a>    
</span><span id="SliceFinder-165"><a href="#SliceFinder-165"><span class="linenos">165</span></a>
</span><span id="SliceFinder-166"><a href="#SliceFinder-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">decode_top_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="SliceFinder-167"><a href="#SliceFinder-167"><span class="linenos">167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-168"><a href="#SliceFinder-168"><span class="linenos">168</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-169"><a href="#SliceFinder-169"><span class="linenos">169</span></a><span class="sd">            Convert slice representations back to their original form </span>
</span><span id="SliceFinder-170"><a href="#SliceFinder-170"><span class="linenos">170</span></a><span class="sd">            (before `X` was one-hot encoded).</span>
</span><span id="SliceFinder-171"><a href="#SliceFinder-171"><span class="linenos">171</span></a><span class="sd">        </span>
</span><span id="SliceFinder-172"><a href="#SliceFinder-172"><span class="linenos">172</span></a><span class="sd">        :param TK: </span>
</span><span id="SliceFinder-173"><a href="#SliceFinder-173"><span class="linenos">173</span></a><span class="sd">            Matrix of the top-k slices.</span>
</span><span id="SliceFinder-174"><a href="#SliceFinder-174"><span class="linenos">174</span></a><span class="sd">        </span>
</span><span id="SliceFinder-175"><a href="#SliceFinder-175"><span class="linenos">175</span></a><span class="sd">        :param fb: </span>
</span><span id="SliceFinder-176"><a href="#SliceFinder-176"><span class="linenos">176</span></a><span class="sd">            List of feature beginnings.</span>
</span><span id="SliceFinder-177"><a href="#SliceFinder-177"><span class="linenos">177</span></a><span class="sd">        </span>
</span><span id="SliceFinder-178"><a href="#SliceFinder-178"><span class="linenos">178</span></a><span class="sd">        :param fe: </span>
</span><span id="SliceFinder-179"><a href="#SliceFinder-179"><span class="linenos">179</span></a><span class="sd">            List of feature endings.</span>
</span><span id="SliceFinder-180"><a href="#SliceFinder-180"><span class="linenos">180</span></a><span class="sd">        </span>
</span><span id="SliceFinder-181"><a href="#SliceFinder-181"><span class="linenos">181</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-182"><a href="#SliceFinder-182"><span class="linenos">182</span></a><span class="sd">            Top-k slice representations from the original dataset `X`.</span>
</span><span id="SliceFinder-183"><a href="#SliceFinder-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-184"><a href="#SliceFinder-184"><span class="linenos">184</span></a>        
</span><span id="SliceFinder-185"><a href="#SliceFinder-185"><span class="linenos">185</span></a>        <span class="n">TK_decoded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="SliceFinder-186"><a href="#SliceFinder-186"><span class="linenos">186</span></a>
</span><span id="SliceFinder-187"><a href="#SliceFinder-187"><span class="linenos">187</span></a>        <span class="c1">#for each feature beg-end</span>
</span><span id="SliceFinder-188"><a href="#SliceFinder-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder-189"><a href="#SliceFinder-189"><span class="linenos">189</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fb</span><span class="p">)):</span>
</span><span id="SliceFinder-190"><a href="#SliceFinder-190"><span class="linenos">190</span></a>                <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder-191"><a href="#SliceFinder-191"><span class="linenos">191</span></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder-192"><a href="#SliceFinder-192"><span class="linenos">192</span></a>
</span><span id="SliceFinder-193"><a href="#SliceFinder-193"><span class="linenos">193</span></a>                
</span><span id="SliceFinder-194"><a href="#SliceFinder-194"><span class="linenos">194</span></a>                <span class="c1">#find the index in the expanded fature with a 1, that poisition is feature number</span>
</span><span id="SliceFinder-195"><a href="#SliceFinder-195"><span class="linenos">195</span></a>                <span class="n">sub_TK</span> <span class="o">=</span> <span class="n">TK</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>  
</span><span id="SliceFinder-196"><a href="#SliceFinder-196"><span class="linenos">196</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> 
</span><span id="SliceFinder-197"><a href="#SliceFinder-197"><span class="linenos">197</span></a>                <span class="n">maxcol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-198"><a href="#SliceFinder-198"><span class="linenos">198</span></a>                <span class="n">maxcol</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SliceFinder-199"><a href="#SliceFinder-199"><span class="linenos">199</span></a>                <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">maxcol</span>
</span><span id="SliceFinder-200"><a href="#SliceFinder-200"><span class="linenos">200</span></a>
</span><span id="SliceFinder-201"><a href="#SliceFinder-201"><span class="linenos">201</span></a>                <span class="n">TK_decoded</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
</span><span id="SliceFinder-202"><a href="#SliceFinder-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="n">TK_decoded</span>
</span><span id="SliceFinder-203"><a href="#SliceFinder-203"><span class="linenos">203</span></a>
</span><span id="SliceFinder-204"><a href="#SliceFinder-204"><span class="linenos">204</span></a>
</span><span id="SliceFinder-205"><a href="#SliceFinder-205"><span class="linenos">205</span></a>
</span><span id="SliceFinder-206"><a href="#SliceFinder-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">eval_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="SliceFinder-207"><a href="#SliceFinder-207"><span class="linenos">207</span></a>
</span><span id="SliceFinder-208"><a href="#SliceFinder-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-209"><a href="#SliceFinder-209"><span class="linenos">209</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-210"><a href="#SliceFinder-210"><span class="linenos">210</span></a><span class="sd">            Get statistics for slice `S`.</span>
</span><span id="SliceFinder-211"><a href="#SliceFinder-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="SliceFinder-212"><a href="#SliceFinder-212"><span class="linenos">212</span></a><span class="sd">        :param X: </span>
</span><span id="SliceFinder-213"><a href="#SliceFinder-213"><span class="linenos">213</span></a><span class="sd">            One-hot encoded dataset.</span>
</span><span id="SliceFinder-214"><a href="#SliceFinder-214"><span class="linenos">214</span></a><span class="sd">        </span>
</span><span id="SliceFinder-215"><a href="#SliceFinder-215"><span class="linenos">215</span></a><span class="sd">        :param e: </span>
</span><span id="SliceFinder-216"><a href="#SliceFinder-216"><span class="linenos">216</span></a><span class="sd">            Error vector for the entire dataset.</span>
</span><span id="SliceFinder-217"><a href="#SliceFinder-217"><span class="linenos">217</span></a><span class="sd">        </span>
</span><span id="SliceFinder-218"><a href="#SliceFinder-218"><span class="linenos">218</span></a><span class="sd">        :param S: </span>
</span><span id="SliceFinder-219"><a href="#SliceFinder-219"><span class="linenos">219</span></a><span class="sd">            A slice that needs to be evaluated.</span>
</span><span id="SliceFinder-220"><a href="#SliceFinder-220"><span class="linenos">220</span></a><span class="sd">        </span>
</span><span id="SliceFinder-221"><a href="#SliceFinder-221"><span class="linenos">221</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-222"><a href="#SliceFinder-222"><span class="linenos">222</span></a><span class="sd">            Vector where `stats[0]` is the score, `stats[1]` is the error, </span>
</span><span id="SliceFinder-223"><a href="#SliceFinder-223"><span class="linenos">223</span></a><span class="sd">            `stats[2]` is the maximum error, and `stats[3]` is the size.</span>
</span><span id="SliceFinder-224"><a href="#SliceFinder-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-225"><a href="#SliceFinder-225"><span class="linenos">225</span></a>        
</span><span id="SliceFinder-226"><a href="#SliceFinder-226"><span class="linenos">226</span></a>        <span class="c1">#indicator for which columns of error vector this slice needs</span>
</span><span id="SliceFinder-227"><a href="#SliceFinder-227"><span class="linenos">227</span></a>        <span class="n">s_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">S</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="SliceFinder-228"><a href="#SliceFinder-228"><span class="linenos">228</span></a>        
</span><span id="SliceFinder-229"><a href="#SliceFinder-229"><span class="linenos">229</span></a>        <span class="c1">#slice size, total error, max error, score</span>
</span><span id="SliceFinder-230"><a href="#SliceFinder-230"><span class="linenos">230</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-231"><a href="#SliceFinder-231"><span class="linenos">231</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">s_mask</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder-232"><a href="#SliceFinder-232"><span class="linenos">232</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_mask</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">s_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
</span><span id="SliceFinder-233"><a href="#SliceFinder-233"><span class="linenos">233</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder-234"><a href="#SliceFinder-234"><span class="linenos">234</span></a>        
</span><span id="SliceFinder-235"><a href="#SliceFinder-235"><span class="linenos">235</span></a>        <span class="c1">#stack them to form a row in </span>
</span><span id="SliceFinder-236"><a href="#SliceFinder-236"><span class="linenos">236</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder-237"><a href="#SliceFinder-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span><span id="SliceFinder-238"><a href="#SliceFinder-238"><span class="linenos">238</span></a>    
</span><span id="SliceFinder-239"><a href="#SliceFinder-239"><span class="linenos">239</span></a>    
</span><span id="SliceFinder-240"><a href="#SliceFinder-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">data_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SliceFinder-241"><a href="#SliceFinder-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-242"><a href="#SliceFinder-242"><span class="linenos">242</span></a><span class="sd">        Summary: </span>
</span><span id="SliceFinder-243"><a href="#SliceFinder-243"><span class="linenos">243</span></a><span class="sd">            1. Find domains for each feature.</span>
</span><span id="SliceFinder-244"><a href="#SliceFinder-244"><span class="linenos">244</span></a><span class="sd">            2. Compute start and end offsets of each feature.</span>
</span><span id="SliceFinder-245"><a href="#SliceFinder-245"><span class="linenos">245</span></a><span class="sd">            3. Get one-hot encoding of the entire dataset.</span>
</span><span id="SliceFinder-246"><a href="#SliceFinder-246"><span class="linenos">246</span></a><span class="sd">        </span>
</span><span id="SliceFinder-247"><a href="#SliceFinder-247"><span class="linenos">247</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-248"><a href="#SliceFinder-248"><span class="linenos">248</span></a><span class="sd">            - fdom: Domains sizes for each feature.</span>
</span><span id="SliceFinder-249"><a href="#SliceFinder-249"><span class="linenos">249</span></a><span class="sd">            - fb: Feature beginnings in the one-hot matrix.</span>
</span><span id="SliceFinder-250"><a href="#SliceFinder-250"><span class="linenos">250</span></a><span class="sd">            - fe: Feature endings in the one-hot matrix.</span>
</span><span id="SliceFinder-251"><a href="#SliceFinder-251"><span class="linenos">251</span></a><span class="sd">            - X: One-hot encoded dataset.</span>
</span><span id="SliceFinder-252"><a href="#SliceFinder-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-253"><a href="#SliceFinder-253"><span class="linenos">253</span></a>        <span class="c1">#fdom (feature domain sizes) are the maximum value along ecah column of the dataset for continuous integer encoding</span>
</span><span id="SliceFinder-254"><a href="#SliceFinder-254"><span class="linenos">254</span></a>        <span class="n">fdom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-255"><a href="#SliceFinder-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fdom: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="SliceFinder-256"><a href="#SliceFinder-256"><span class="linenos">256</span></a>        
</span><span id="SliceFinder-257"><a href="#SliceFinder-257"><span class="linenos">257</span></a>        <span class="c1">#fb is where each feature in new matrix starts</span>
</span><span id="SliceFinder-258"><a href="#SliceFinder-258"><span class="linenos">258</span></a>        <span class="n">fb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fdom</span><span class="p">)</span> <span class="o">-</span> <span class="n">fdom</span>
</span><span id="SliceFinder-259"><a href="#SliceFinder-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fb: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fb</span><span class="p">))</span>
</span><span id="SliceFinder-260"><a href="#SliceFinder-260"><span class="linenos">260</span></a>        
</span><span id="SliceFinder-261"><a href="#SliceFinder-261"><span class="linenos">261</span></a>        <span class="c1">#fe is where each feature in new matrix ends</span>
</span><span id="SliceFinder-262"><a href="#SliceFinder-262"><span class="linenos">262</span></a>        <span class="n">fe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fdom</span><span class="p">)</span>
</span><span id="SliceFinder-263"><a href="#SliceFinder-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fe: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fe</span><span class="p">))</span>
</span><span id="SliceFinder-264"><a href="#SliceFinder-264"><span class="linenos">264</span></a>        
</span><span id="SliceFinder-265"><a href="#SliceFinder-265"><span class="linenos">265</span></a>        
</span><span id="SliceFinder-266"><a href="#SliceFinder-266"><span class="linenos">266</span></a>        <span class="c1">#one hot encode the entire dataset</span>
</span><span id="SliceFinder-267"><a href="#SliceFinder-267"><span class="linenos">267</span></a>        <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
</span><span id="SliceFinder-268"><a href="#SliceFinder-268"><span class="linenos">268</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="SliceFinder-269"><a href="#SliceFinder-269"><span class="linenos">269</span></a>
</span><span id="SliceFinder-270"><a href="#SliceFinder-270"><span class="linenos">270</span></a>
</span><span id="SliceFinder-271"><a href="#SliceFinder-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="n">fdom</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">X</span>
</span><span id="SliceFinder-272"><a href="#SliceFinder-272"><span class="linenos">272</span></a>    
</span><span id="SliceFinder-273"><a href="#SliceFinder-273"><span class="linenos">273</span></a>
</span><span id="SliceFinder-274"><a href="#SliceFinder-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">getCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
</span><span id="SliceFinder-275"><a href="#SliceFinder-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-276"><a href="#SliceFinder-276"><span class="linenos">276</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-277"><a href="#SliceFinder-277"><span class="linenos">277</span></a><span class="sd">            - Count bins for an integer or vector.</span>
</span><span id="SliceFinder-278"><a href="#SliceFinder-278"><span class="linenos">278</span></a><span class="sd">            - For integers, it returns a set of bins with that integer&#39;s bin set to value 1.</span>
</span><span id="SliceFinder-279"><a href="#SliceFinder-279"><span class="linenos">279</span></a><span class="sd">            - For vectors, it returns a set of bins where `bins[i]` is the number of occurrences of `i` in the vector.</span>
</span><span id="SliceFinder-280"><a href="#SliceFinder-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="SliceFinder-281"><a href="#SliceFinder-281"><span class="linenos">281</span></a><span class="sd">        :param v: </span>
</span><span id="SliceFinder-282"><a href="#SliceFinder-282"><span class="linenos">282</span></a><span class="sd">            Vector or integer to be counted.</span>
</span><span id="SliceFinder-283"><a href="#SliceFinder-283"><span class="linenos">283</span></a><span class="sd">        </span>
</span><span id="SliceFinder-284"><a href="#SliceFinder-284"><span class="linenos">284</span></a><span class="sd">        :param vmax: </span>
</span><span id="SliceFinder-285"><a href="#SliceFinder-285"><span class="linenos">285</span></a><span class="sd">            The number of bins to include. Must be &gt;= the largest element in `v`.</span>
</span><span id="SliceFinder-286"><a href="#SliceFinder-286"><span class="linenos">286</span></a><span class="sd">        </span>
</span><span id="SliceFinder-287"><a href="#SliceFinder-287"><span class="linenos">287</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-288"><a href="#SliceFinder-288"><span class="linenos">288</span></a><span class="sd">            Bins for the given input. For integers, it returns a set with the corresponding bin set to 1. For vectors, it returns a set where each bin contains the count of occurrences of the index in the vector.</span>
</span><span id="SliceFinder-289"><a href="#SliceFinder-289"><span class="linenos">289</span></a><span class="sd">        &quot;&quot;&quot;</span>            
</span><span id="SliceFinder-290"><a href="#SliceFinder-290"><span class="linenos">290</span></a>        
</span><span id="SliceFinder-291"><a href="#SliceFinder-291"><span class="linenos">291</span></a>        
</span><span id="SliceFinder-292"><a href="#SliceFinder-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
</span><span id="SliceFinder-293"><a href="#SliceFinder-293"><span class="linenos">293</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">bins</span><span class="p">))</span>
</span><span id="SliceFinder-294"><a href="#SliceFinder-294"><span class="linenos">294</span></a>            <span class="n">vec</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SliceFinder-295"><a href="#SliceFinder-295"><span class="linenos">295</span></a>            <span class="k">return</span> <span class="n">vec</span>
</span><span id="SliceFinder-296"><a href="#SliceFinder-296"><span class="linenos">296</span></a>        
</span><span id="SliceFinder-297"><a href="#SliceFinder-297"><span class="linenos">297</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SliceFinder-298"><a href="#SliceFinder-298"><span class="linenos">298</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">bins</span><span class="p">))</span>
</span><span id="SliceFinder-299"><a href="#SliceFinder-299"><span class="linenos">299</span></a>            <span class="k">for</span> <span class="n">vij</span> <span class="ow">in</span> <span class="n">vi</span><span class="p">:</span>
</span><span id="SliceFinder-300"><a href="#SliceFinder-300"><span class="linenos">300</span></a>                <span class="n">vec</span><span class="p">[</span><span class="n">vij</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SliceFinder-301"><a href="#SliceFinder-301"><span class="linenos">301</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder-302"><a href="#SliceFinder-302"><span class="linenos">302</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;unsupported use of getCounts&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-303"><a href="#SliceFinder-303"><span class="linenos">303</span></a>            <span class="n">exit</span><span class="p">()</span>
</span><span id="SliceFinder-304"><a href="#SliceFinder-304"><span class="linenos">304</span></a>                
</span><span id="SliceFinder-305"><a href="#SliceFinder-305"><span class="linenos">305</span></a>                
</span><span id="SliceFinder-306"><a href="#SliceFinder-306"><span class="linenos">306</span></a>                
</span><span id="SliceFinder-307"><a href="#SliceFinder-307"><span class="linenos">307</span></a>        
</span><span id="SliceFinder-308"><a href="#SliceFinder-308"><span class="linenos">308</span></a>
</span><span id="SliceFinder-309"><a href="#SliceFinder-309"><span class="linenos">309</span></a>
</span><span id="SliceFinder-310"><a href="#SliceFinder-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SliceFinder-311"><a href="#SliceFinder-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-312"><a href="#SliceFinder-312"><span class="linenos">312</span></a><span class="sd">            Summary:</span>
</span><span id="SliceFinder-313"><a href="#SliceFinder-313"><span class="linenos">313</span></a><span class="sd">                gets a dense matrix representation of a sparse matrix v</span>
</span><span id="SliceFinder-314"><a href="#SliceFinder-314"><span class="linenos">314</span></a><span class="sd">            </span>
</span><span id="SliceFinder-315"><a href="#SliceFinder-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-316"><a href="#SliceFinder-316"><span class="linenos">316</span></a>        
</span><span id="SliceFinder-317"><a href="#SliceFinder-317"><span class="linenos">317</span></a>        
</span><span id="SliceFinder-318"><a href="#SliceFinder-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SliceFinder-319"><a href="#SliceFinder-319"><span class="linenos">319</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="SliceFinder-320"><a href="#SliceFinder-320"><span class="linenos">320</span></a>            
</span><span id="SliceFinder-321"><a href="#SliceFinder-321"><span class="linenos">321</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="SliceFinder-322"><a href="#SliceFinder-322"><span class="linenos">322</span></a>        <span class="c1">#count number of occourances for each value in each row</span>
</span><span id="SliceFinder-323"><a href="#SliceFinder-323"><span class="linenos">323</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder-324"><a href="#SliceFinder-324"><span class="linenos">324</span></a>
</span><span id="SliceFinder-325"><a href="#SliceFinder-325"><span class="linenos">325</span></a>            <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCounts</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">m</span><span class="p">)</span>
</span><span id="SliceFinder-326"><a href="#SliceFinder-326"><span class="linenos">326</span></a>
</span><span id="SliceFinder-327"><a href="#SliceFinder-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="n">R</span>
</span><span id="SliceFinder-328"><a href="#SliceFinder-328"><span class="linenos">328</span></a>    
</span><span id="SliceFinder-329"><a href="#SliceFinder-329"><span class="linenos">329</span></a>    
</span><span id="SliceFinder-330"><a href="#SliceFinder-330"><span class="linenos">330</span></a>
</span><span id="SliceFinder-331"><a href="#SliceFinder-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">find_score_basic_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
</span><span id="SliceFinder-332"><a href="#SliceFinder-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-333"><a href="#SliceFinder-333"><span class="linenos">333</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-334"><a href="#SliceFinder-334"><span class="linenos">334</span></a><span class="sd">            Find the 1-predicate slices and their statistics.</span>
</span><span id="SliceFinder-335"><a href="#SliceFinder-335"><span class="linenos">335</span></a><span class="sd">        </span>
</span><span id="SliceFinder-336"><a href="#SliceFinder-336"><span class="linenos">336</span></a><span class="sd">        :param X: </span>
</span><span id="SliceFinder-337"><a href="#SliceFinder-337"><span class="linenos">337</span></a><span class="sd">            One-hot encoded dataset.</span>
</span><span id="SliceFinder-338"><a href="#SliceFinder-338"><span class="linenos">338</span></a><span class="sd">        </span>
</span><span id="SliceFinder-339"><a href="#SliceFinder-339"><span class="linenos">339</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-340"><a href="#SliceFinder-340"><span class="linenos">340</span></a><span class="sd">            - S: Basic slices.</span>
</span><span id="SliceFinder-341"><a href="#SliceFinder-341"><span class="linenos">341</span></a><span class="sd">            - R: Basic slice statistics.</span>
</span><span id="SliceFinder-342"><a href="#SliceFinder-342"><span class="linenos">342</span></a><span class="sd">            - CI: Pruning indicator based on size and score.</span>
</span><span id="SliceFinder-343"><a href="#SliceFinder-343"><span class="linenos">343</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-344"><a href="#SliceFinder-344"><span class="linenos">344</span></a>        <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SliceFinder-345"><a href="#SliceFinder-345"><span class="linenos">345</span></a>        <span class="c1">#ss0 = sizes of each basic slice are column sums</span>
</span><span id="SliceFinder-346"><a href="#SliceFinder-346"><span class="linenos">346</span></a>        <span class="n">ss0</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-347"><a href="#SliceFinder-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ss0: </span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ss0</span><span class="p">))</span>
</span><span id="SliceFinder-348"><a href="#SliceFinder-348"><span class="linenos">348</span></a>        
</span><span id="SliceFinder-349"><a href="#SliceFinder-349"><span class="linenos">349</span></a>        <span class="c1">#se0 = error of each basic slice</span>
</span><span id="SliceFinder-350"><a href="#SliceFinder-350"><span class="linenos">350</span></a>        <span class="n">se0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-351"><a href="#SliceFinder-351"><span class="linenos">351</span></a>        
</span><span id="SliceFinder-352"><a href="#SliceFinder-352"><span class="linenos">352</span></a>        <span class="c1">#sm0 = the maximum error among elements in each slice</span>
</span><span id="SliceFinder-353"><a href="#SliceFinder-353"><span class="linenos">353</span></a>        <span class="n">sm0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-354"><a href="#SliceFinder-354"><span class="linenos">354</span></a>
</span><span id="SliceFinder-355"><a href="#SliceFinder-355"><span class="linenos">355</span></a>        <span class="c1">#pruning indicator</span>
</span><span id="SliceFinder-356"><a href="#SliceFinder-356"><span class="linenos">356</span></a>        <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="n">ss0</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">se0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-357"><a href="#SliceFinder-357"><span class="linenos">357</span></a>
</span><span id="SliceFinder-358"><a href="#SliceFinder-358"><span class="linenos">358</span></a>        <span class="c1">#prune basic slice scores and errors</span>
</span><span id="SliceFinder-359"><a href="#SliceFinder-359"><span class="linenos">359</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder-360"><a href="#SliceFinder-360"><span class="linenos">360</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">se0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder-361"><a href="#SliceFinder-361"><span class="linenos">361</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">sm0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder-362"><a href="#SliceFinder-362"><span class="linenos">362</span></a>        
</span><span id="SliceFinder-363"><a href="#SliceFinder-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ss: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span>
</span><span id="SliceFinder-364"><a href="#SliceFinder-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;se: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">se</span><span class="p">))</span>
</span><span id="SliceFinder-365"><a href="#SliceFinder-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sm: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sm</span><span class="p">))</span>
</span><span id="SliceFinder-366"><a href="#SliceFinder-366"><span class="linenos">366</span></a>        
</span><span id="SliceFinder-367"><a href="#SliceFinder-367"><span class="linenos">367</span></a>        
</span><span id="SliceFinder-368"><a href="#SliceFinder-368"><span class="linenos">368</span></a>        <span class="c1">#a set of pruned slices (very sparse matrix representation)</span>
</span><span id="SliceFinder-369"><a href="#SliceFinder-369"><span class="linenos">369</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)[</span><span class="n">CI</span><span class="p">],</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</span><span id="SliceFinder-370"><a href="#SliceFinder-370"><span class="linenos">370</span></a>
</span><span id="SliceFinder-371"><a href="#SliceFinder-371"><span class="linenos">371</span></a>        <span class="c1">#slice scores</span>
</span><span id="SliceFinder-372"><a href="#SliceFinder-372"><span class="linenos">372</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span><span id="SliceFinder-373"><a href="#SliceFinder-373"><span class="linenos">373</span></a>
</span><span id="SliceFinder-374"><a href="#SliceFinder-374"><span class="linenos">374</span></a>        
</span><span id="SliceFinder-375"><a href="#SliceFinder-375"><span class="linenos">375</span></a>        <span class="c1">#form statistics matrix</span>
</span><span id="SliceFinder-376"><a href="#SliceFinder-376"><span class="linenos">376</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder-377"><a href="#SliceFinder-377"><span class="linenos">377</span></a>
</span><span id="SliceFinder-378"><a href="#SliceFinder-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">slices</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span>
</span><span id="SliceFinder-379"><a href="#SliceFinder-379"><span class="linenos">379</span></a>        
</span><span id="SliceFinder-380"><a href="#SliceFinder-380"><span class="linenos">380</span></a>
</span><span id="SliceFinder-381"><a href="#SliceFinder-381"><span class="linenos">381</span></a>
</span><span id="SliceFinder-382"><a href="#SliceFinder-382"><span class="linenos">382</span></a>
</span><span id="SliceFinder-383"><a href="#SliceFinder-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">get_pair_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="SliceFinder-384"><a href="#SliceFinder-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-385"><a href="#SliceFinder-385"><span class="linenos">385</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-386"><a href="#SliceFinder-386"><span class="linenos">386</span></a><span class="sd">            Form a set of valid L-predicate slices using the given L-1 predicate slices `S`.</span>
</span><span id="SliceFinder-387"><a href="#SliceFinder-387"><span class="linenos">387</span></a>
</span><span id="SliceFinder-388"><a href="#SliceFinder-388"><span class="linenos">388</span></a><span class="sd">            1. Form every combination of slices from level L-1.</span>
</span><span id="SliceFinder-389"><a href="#SliceFinder-389"><span class="linenos">389</span></a><span class="sd">            2. Prune those without L-2 overlap.</span>
</span><span id="SliceFinder-390"><a href="#SliceFinder-390"><span class="linenos">390</span></a><span class="sd">            3. Form row and column index pairs of valid combinations.</span>
</span><span id="SliceFinder-391"><a href="#SliceFinder-391"><span class="linenos">391</span></a><span class="sd">            4. Get parents using row, column index pairs.</span>
</span><span id="SliceFinder-392"><a href="#SliceFinder-392"><span class="linenos">392</span></a><span class="sd">            5. Form new slices.</span>
</span><span id="SliceFinder-393"><a href="#SliceFinder-393"><span class="linenos">393</span></a><span class="sd">            6. Prune slices that assign more than one value to a feature.</span>
</span><span id="SliceFinder-394"><a href="#SliceFinder-394"><span class="linenos">394</span></a><span class="sd">            7. Extract size and error for new slices as the minimum of their parents.</span>
</span><span id="SliceFinder-395"><a href="#SliceFinder-395"><span class="linenos">395</span></a><span class="sd">            8. Perform deduplication using unique IDs.</span>
</span><span id="SliceFinder-396"><a href="#SliceFinder-396"><span class="linenos">396</span></a><span class="sd">            9. Upper bound the scoring function and prune new slices.</span>
</span><span id="SliceFinder-397"><a href="#SliceFinder-397"><span class="linenos">397</span></a><span class="sd">        </span>
</span><span id="SliceFinder-398"><a href="#SliceFinder-398"><span class="linenos">398</span></a><span class="sd">        :param S: </span>
</span><span id="SliceFinder-399"><a href="#SliceFinder-399"><span class="linenos">399</span></a><span class="sd">            Slices from level L-1.</span>
</span><span id="SliceFinder-400"><a href="#SliceFinder-400"><span class="linenos">400</span></a><span class="sd">        </span>
</span><span id="SliceFinder-401"><a href="#SliceFinder-401"><span class="linenos">401</span></a><span class="sd">        :param R: </span>
</span><span id="SliceFinder-402"><a href="#SliceFinder-402"><span class="linenos">402</span></a><span class="sd">            Statistics for those slices.</span>
</span><span id="SliceFinder-403"><a href="#SliceFinder-403"><span class="linenos">403</span></a><span class="sd">        </span>
</span><span id="SliceFinder-404"><a href="#SliceFinder-404"><span class="linenos">404</span></a><span class="sd">        :param TKC: </span>
</span><span id="SliceFinder-405"><a href="#SliceFinder-405"><span class="linenos">405</span></a><span class="sd">            Top-k slice statistics.</span>
</span><span id="SliceFinder-406"><a href="#SliceFinder-406"><span class="linenos">406</span></a><span class="sd">        </span>
</span><span id="SliceFinder-407"><a href="#SliceFinder-407"><span class="linenos">407</span></a><span class="sd">        :param L: </span>
</span><span id="SliceFinder-408"><a href="#SliceFinder-408"><span class="linenos">408</span></a><span class="sd">            Current level of slices.</span>
</span><span id="SliceFinder-409"><a href="#SliceFinder-409"><span class="linenos">409</span></a><span class="sd">        </span>
</span><span id="SliceFinder-410"><a href="#SliceFinder-410"><span class="linenos">410</span></a><span class="sd">        :param fb: </span>
</span><span id="SliceFinder-411"><a href="#SliceFinder-411"><span class="linenos">411</span></a><span class="sd">            Feature beginnings.</span>
</span><span id="SliceFinder-412"><a href="#SliceFinder-412"><span class="linenos">412</span></a><span class="sd">        </span>
</span><span id="SliceFinder-413"><a href="#SliceFinder-413"><span class="linenos">413</span></a><span class="sd">        :param fe: </span>
</span><span id="SliceFinder-414"><a href="#SliceFinder-414"><span class="linenos">414</span></a><span class="sd">            Feature endings.</span>
</span><span id="SliceFinder-415"><a href="#SliceFinder-415"><span class="linenos">415</span></a><span class="sd">        </span>
</span><span id="SliceFinder-416"><a href="#SliceFinder-416"><span class="linenos">416</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-417"><a href="#SliceFinder-417"><span class="linenos">417</span></a><span class="sd">            - P: A set of valid pair candidates.</span>
</span><span id="SliceFinder-418"><a href="#SliceFinder-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-419"><a href="#SliceFinder-419"><span class="linenos">419</span></a>        
</span><span id="SliceFinder-420"><a href="#SliceFinder-420"><span class="linenos">420</span></a>        <span class="c1">#prune invalid input slices using thresholds for size (sigma) and error (non-negative)</span>
</span><span id="SliceFinder-421"><a href="#SliceFinder-421"><span class="linenos">421</span></a>        <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-422"><a href="#SliceFinder-422"><span class="linenos">422</span></a>        <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder-423"><a href="#SliceFinder-423"><span class="linenos">423</span></a>
</span><span id="SliceFinder-424"><a href="#SliceFinder-424"><span class="linenos">424</span></a>        <span class="c1">#(S ⊙ S.T) creates every possible combination of slices</span>
</span><span id="SliceFinder-425"><a href="#SliceFinder-425"><span class="linenos">425</span></a>        <span class="n">SST</span> <span class="o">=</span> <span class="n">S</span> <span class="o">@</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder-426"><a href="#SliceFinder-426"><span class="linenos">426</span></a>
</span><span id="SliceFinder-427"><a href="#SliceFinder-427"><span class="linenos">427</span></a>        <span class="c1">#valid slices should have L-2 overlap</span>
</span><span id="SliceFinder-428"><a href="#SliceFinder-428"><span class="linenos">428</span></a>        <span class="n">valid_SST</span> <span class="o">=</span> <span class="p">(</span><span class="n">SST</span> <span class="o">==</span> <span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</span><span id="SliceFinder-429"><a href="#SliceFinder-429"><span class="linenos">429</span></a>
</span><span id="SliceFinder-430"><a href="#SliceFinder-430"><span class="linenos">430</span></a>        
</span><span id="SliceFinder-431"><a href="#SliceFinder-431"><span class="linenos">431</span></a>        <span class="c1">#since the matrix is symetric we only need top half</span>
</span><span id="SliceFinder-432"><a href="#SliceFinder-432"><span class="linenos">432</span></a>        <span class="c1">#I is a mask for new slices with L-2 overlap</span>
</span><span id="SliceFinder-433"><a href="#SliceFinder-433"><span class="linenos">433</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">valid_SST</span><span class="p">)</span> <span class="o">*</span> <span class="n">valid_SST</span>
</span><span id="SliceFinder-434"><a href="#SliceFinder-434"><span class="linenos">434</span></a>        
</span><span id="SliceFinder-435"><a href="#SliceFinder-435"><span class="linenos">435</span></a>
</span><span id="SliceFinder-436"><a href="#SliceFinder-436"><span class="linenos">436</span></a>        <span class="c1">#create combined slices parents by converting I to row, column index pairs (rix and cix)</span>
</span><span id="SliceFinder-437"><a href="#SliceFinder-437"><span class="linenos">437</span></a>        <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SliceFinder-438"><a href="#SliceFinder-438"><span class="linenos">438</span></a>        
</span><span id="SliceFinder-439"><a href="#SliceFinder-439"><span class="linenos">439</span></a>        <span class="c1">#form row index matrix</span>
</span><span id="SliceFinder-440"><a href="#SliceFinder-440"><span class="linenos">440</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_cols</span><span class="p">))</span>
</span><span id="SliceFinder-441"><a href="#SliceFinder-441"><span class="linenos">441</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">rix</span>
</span><span id="SliceFinder-442"><a href="#SliceFinder-442"><span class="linenos">442</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-443"><a href="#SliceFinder-443"><span class="linenos">443</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="p">[</span> <span class="n">rix</span><span class="o">!=</span><span class="mi">0</span> <span class="p">]</span>
</span><span id="SliceFinder-444"><a href="#SliceFinder-444"><span class="linenos">444</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="o">-</span><span class="mi">1</span>
</span><span id="SliceFinder-445"><a href="#SliceFinder-445"><span class="linenos">445</span></a>        
</span><span id="SliceFinder-446"><a href="#SliceFinder-446"><span class="linenos">446</span></a>        <span class="c1">#column index matrix</span>
</span><span id="SliceFinder-447"><a href="#SliceFinder-447"><span class="linenos">447</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_cols</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="SliceFinder-448"><a href="#SliceFinder-448"><span class="linenos">448</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">cix</span>
</span><span id="SliceFinder-449"><a href="#SliceFinder-449"><span class="linenos">449</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-450"><a href="#SliceFinder-450"><span class="linenos">450</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="p">[</span><span class="n">cix</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="SliceFinder-451"><a href="#SliceFinder-451"><span class="linenos">451</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="o">-</span><span class="mi">1</span>
</span><span id="SliceFinder-452"><a href="#SliceFinder-452"><span class="linenos">452</span></a>        
</span><span id="SliceFinder-453"><a href="#SliceFinder-453"><span class="linenos">453</span></a>        <span class="c1">#if there are new slices</span>
</span><span id="SliceFinder-454"><a href="#SliceFinder-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rix</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder-455"><a href="#SliceFinder-455"><span class="linenos">455</span></a>            
</span><span id="SliceFinder-456"><a href="#SliceFinder-456"><span class="linenos">456</span></a>            <span class="c1">#get parents</span>
</span><span id="SliceFinder-457"><a href="#SliceFinder-457"><span class="linenos">457</span></a>            <span class="n">P1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">rix</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder-458"><a href="#SliceFinder-458"><span class="linenos">458</span></a>            <span class="n">P2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">cix</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder-459"><a href="#SliceFinder-459"><span class="linenos">459</span></a>            
</span><span id="SliceFinder-460"><a href="#SliceFinder-460"><span class="linenos">460</span></a>            <span class="c1">#form new slices</span>
</span><span id="SliceFinder-461"><a href="#SliceFinder-461"><span class="linenos">461</span></a>            <span class="n">newSlices</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">P2</span>
</span><span id="SliceFinder-462"><a href="#SliceFinder-462"><span class="linenos">462</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="p">(((</span><span class="n">P1</span> <span class="o">@</span> <span class="n">S</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">P2</span> <span class="o">@</span> <span class="n">S</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="SliceFinder-463"><a href="#SliceFinder-463"><span class="linenos">463</span></a>                 
</span><span id="SliceFinder-464"><a href="#SliceFinder-464"><span class="linenos">464</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder-465"><a href="#SliceFinder-465"><span class="linenos">465</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error, ran out of valid slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-466"><a href="#SliceFinder-466"><span class="linenos">466</span></a>            <span class="n">exit</span><span class="p">()</span>
</span><span id="SliceFinder-467"><a href="#SliceFinder-467"><span class="linenos">467</span></a>
</span><span id="SliceFinder-468"><a href="#SliceFinder-468"><span class="linenos">468</span></a>        
</span><span id="SliceFinder-469"><a href="#SliceFinder-469"><span class="linenos">469</span></a>        <span class="c1">#extract new slice sizes and errors as minimum of parents (with parent handling)</span>
</span><span id="SliceFinder-470"><a href="#SliceFinder-470"><span class="linenos">470</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SliceFinder-471"><a href="#SliceFinder-471"><span class="linenos">471</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="SliceFinder-472"><a href="#SliceFinder-472"><span class="linenos">472</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
</span><span id="SliceFinder-473"><a href="#SliceFinder-473"><span class="linenos">473</span></a>
</span><span id="SliceFinder-474"><a href="#SliceFinder-474"><span class="linenos">474</span></a>
</span><span id="SliceFinder-475"><a href="#SliceFinder-475"><span class="linenos">475</span></a>
</span><span id="SliceFinder-476"><a href="#SliceFinder-476"><span class="linenos">476</span></a>        <span class="c1">#discard invalid slices with multiple assignments per feature using indicator I</span>
</span><span id="SliceFinder-477"><a href="#SliceFinder-477"><span class="linenos">477</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="SliceFinder-478"><a href="#SliceFinder-478"><span class="linenos">478</span></a>
</span><span id="SliceFinder-479"><a href="#SliceFinder-479"><span class="linenos">479</span></a>        <span class="c1">#with each expanded feature (from beg-end)</span>
</span><span id="SliceFinder-480"><a href="#SliceFinder-480"><span class="linenos">480</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder-481"><a href="#SliceFinder-481"><span class="linenos">481</span></a>            <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder-482"><a href="#SliceFinder-482"><span class="linenos">482</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder-483"><a href="#SliceFinder-483"><span class="linenos">483</span></a>            
</span><span id="SliceFinder-484"><a href="#SliceFinder-484"><span class="linenos">484</span></a>            <span class="c1">#make sure it only has 1 domain value assigned to it</span>
</span><span id="SliceFinder-485"><a href="#SliceFinder-485"><span class="linenos">485</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-486"><a href="#SliceFinder-486"><span class="linenos">486</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">rowsums</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="SliceFinder-487"><a href="#SliceFinder-487"><span class="linenos">487</span></a>
</span><span id="SliceFinder-488"><a href="#SliceFinder-488"><span class="linenos">488</span></a>            <span class="c1">#update mask to exclude features with more than one value</span>
</span><span id="SliceFinder-489"><a href="#SliceFinder-489"><span class="linenos">489</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">&amp;</span> <span class="n">rowsums</span>
</span><span id="SliceFinder-490"><a href="#SliceFinder-490"><span class="linenos">490</span></a>
</span><span id="SliceFinder-491"><a href="#SliceFinder-491"><span class="linenos">491</span></a>
</span><span id="SliceFinder-492"><a href="#SliceFinder-492"><span class="linenos">492</span></a>        <span class="c1">#prune slices with more than one assignment per feature</span>
</span><span id="SliceFinder-493"><a href="#SliceFinder-493"><span class="linenos">493</span></a>        <span class="n">newSlices</span> <span class="o">=</span> <span class="n">newSlices</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder-494"><a href="#SliceFinder-494"><span class="linenos">494</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder-495"><a href="#SliceFinder-495"><span class="linenos">495</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-496"><a href="#SliceFinder-496"><span class="linenos">496</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">se</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-497"><a href="#SliceFinder-497"><span class="linenos">497</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">sm</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-498"><a href="#SliceFinder-498"><span class="linenos">498</span></a>
</span><span id="SliceFinder-499"><a href="#SliceFinder-499"><span class="linenos">499</span></a>
</span><span id="SliceFinder-500"><a href="#SliceFinder-500"><span class="linenos">500</span></a>
</span><span id="SliceFinder-501"><a href="#SliceFinder-501"><span class="linenos">501</span></a>        <span class="c1">#deduplication </span>
</span><span id="SliceFinder-502"><a href="#SliceFinder-502"><span class="linenos">502</span></a>        <span class="n">dom</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-</span><span class="n">fb</span><span class="o">+</span><span class="mi">1</span>
</span><span id="SliceFinder-503"><a href="#SliceFinder-503"><span class="linenos">503</span></a>        <span class="c1">#unique ids for each slice are the sum of weighted feature contributions.  Makes it so slices map to same ID if they have same features</span>
</span><span id="SliceFinder-504"><a href="#SliceFinder-504"><span class="linenos">504</span></a>        <span class="n">ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="SliceFinder-505"><a href="#SliceFinder-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder-506"><a href="#SliceFinder-506"><span class="linenos">506</span></a>            <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder-507"><a href="#SliceFinder-507"><span class="linenos">507</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder-508"><a href="#SliceFinder-508"><span class="linenos">508</span></a>            
</span><span id="SliceFinder-509"><a href="#SliceFinder-509"><span class="linenos">509</span></a>            <span class="n">max_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SliceFinder-510"><a href="#SliceFinder-510"><span class="linenos">510</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-511"><a href="#SliceFinder-511"><span class="linenos">511</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">max_col</span> <span class="o">*</span> <span class="n">rowsums</span>
</span><span id="SliceFinder-512"><a href="#SliceFinder-512"><span class="linenos">512</span></a>
</span><span id="SliceFinder-513"><a href="#SliceFinder-513"><span class="linenos">513</span></a>            <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SliceFinder-514"><a href="#SliceFinder-514"><span class="linenos">514</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="SliceFinder-515"><a href="#SliceFinder-515"><span class="linenos">515</span></a>                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dom</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="SliceFinder-516"><a href="#SliceFinder-516"><span class="linenos">516</span></a>            
</span><span id="SliceFinder-517"><a href="#SliceFinder-517"><span class="linenos">517</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
</span><span id="SliceFinder-518"><a href="#SliceFinder-518"><span class="linenos">518</span></a>            <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
</span><span id="SliceFinder-519"><a href="#SliceFinder-519"><span class="linenos">519</span></a>
</span><span id="SliceFinder-520"><a href="#SliceFinder-520"><span class="linenos">520</span></a>            <span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span> <span class="o">+</span> <span class="n">I</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="SliceFinder-521"><a href="#SliceFinder-521"><span class="linenos">521</span></a>    
</span><span id="SliceFinder-522"><a href="#SliceFinder-522"><span class="linenos">522</span></a>
</span><span id="SliceFinder-523"><a href="#SliceFinder-523"><span class="linenos">523</span></a>        <span class="c1">#map cotains deduplication pruning mask</span>
</span><span id="SliceFinder-524"><a href="#SliceFinder-524"><span class="linenos">524</span></a>        <span class="nb">map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ID</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="SliceFinder-525"><a href="#SliceFinder-525"><span class="linenos">525</span></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-526"><a href="#SliceFinder-526"><span class="linenos">526</span></a>        
</span><span id="SliceFinder-527"><a href="#SliceFinder-527"><span class="linenos">527</span></a>        <span class="c1">#size pruning by upper bounding sizes</span>
</span><span id="SliceFinder-528"><a href="#SliceFinder-528"><span class="linenos">528</span></a>        <span class="n">ub_sizes</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ex</span> <span class="o">@</span> <span class="n">ss</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-529"><a href="#SliceFinder-529"><span class="linenos">529</span></a>        <span class="n">ub_sizes</span><span class="p">[</span><span class="n">ub_sizes</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SliceFinder-530"><a href="#SliceFinder-530"><span class="linenos">530</span></a>        <span class="n">f_sizes</span> <span class="o">=</span> <span class="n">ub_sizes</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
</span><span id="SliceFinder-531"><a href="#SliceFinder-531"><span class="linenos">531</span></a>        
</span><span id="SliceFinder-532"><a href="#SliceFinder-532"><span class="linenos">532</span></a>        
</span><span id="SliceFinder-533"><a href="#SliceFinder-533"><span class="linenos">533</span></a>        <span class="c1">#error pruning mask</span>
</span><span id="SliceFinder-534"><a href="#SliceFinder-534"><span class="linenos">534</span></a>        <span class="n">ub_error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ex</span> <span class="o">@</span> <span class="n">se</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="SliceFinder-535"><a href="#SliceFinder-535"><span class="linenos">535</span></a>        <span class="n">ub_error</span><span class="p">[</span><span class="n">ub_error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SliceFinder-536"><a href="#SliceFinder-536"><span class="linenos">536</span></a>        <span class="n">ub_max_error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="n">ex</span> <span class="o">@</span> <span class="n">sm</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-537"><a href="#SliceFinder-537"><span class="linenos">537</span></a>        <span class="n">ub_max_error</span><span class="p">[</span><span class="n">ub_max_error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SliceFinder-538"><a href="#SliceFinder-538"><span class="linenos">538</span></a>
</span><span id="SliceFinder-539"><a href="#SliceFinder-539"><span class="linenos">539</span></a>
</span><span id="SliceFinder-540"><a href="#SliceFinder-540"><span class="linenos">540</span></a>        <span class="c1">#score pruning mask</span>
</span><span id="SliceFinder-541"><a href="#SliceFinder-541"><span class="linenos">541</span></a>        <span class="n">ub_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperbound_score</span><span class="p">(</span><span class="n">ub_sizes</span><span class="p">,</span> <span class="n">ub_error</span><span class="p">,</span> <span class="n">ub_max_error</span><span class="p">)</span>
</span><span id="SliceFinder-542"><a href="#SliceFinder-542"><span class="linenos">542</span></a>        <span class="n">TMP3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_topK</span><span class="p">(</span><span class="n">TKC</span><span class="p">)</span>
</span><span id="SliceFinder-543"><a href="#SliceFinder-543"><span class="linenos">543</span></a>        <span class="n">minsc</span> <span class="o">=</span> <span class="n">TMP3</span><span class="p">[</span><span class="s2">&quot;minScore&quot;</span><span class="p">]</span>
</span><span id="SliceFinder-544"><a href="#SliceFinder-544"><span class="linenos">544</span></a>        <span class="n">fScores</span> <span class="o">=</span> <span class="p">(</span><span class="n">ub_scores</span> <span class="o">&gt;</span> <span class="n">minsc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub_scores</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder-545"><a href="#SliceFinder-545"><span class="linenos">545</span></a>        
</span><span id="SliceFinder-546"><a href="#SliceFinder-546"><span class="linenos">546</span></a>        
</span><span id="SliceFinder-547"><a href="#SliceFinder-547"><span class="linenos">547</span></a>        <span class="c1">#missing parents pruning mask</span>
</span><span id="SliceFinder-548"><a href="#SliceFinder-548"><span class="linenos">548</span></a>        <span class="n">sparse_map</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
</span><span id="SliceFinder-549"><a href="#SliceFinder-549"><span class="linenos">549</span></a>        <span class="n">sparse_slices</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">newSlices</span><span class="p">)</span>
</span><span id="SliceFinder-550"><a href="#SliceFinder-550"><span class="linenos">550</span></a>        <span class="n">result_sparse</span> <span class="o">=</span> <span class="n">sparse_map</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sparse_slices</span><span class="p">)</span>
</span><span id="SliceFinder-551"><a href="#SliceFinder-551"><span class="linenos">551</span></a>        <span class="n">num_parents</span> <span class="o">=</span> <span class="n">result_sparse</span><span class="o">.</span><span class="n">nnz</span>
</span><span id="SliceFinder-552"><a href="#SliceFinder-552"><span class="linenos">552</span></a>        <span class="n">f_parents</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_parents</span> <span class="o">==</span> <span class="n">L</span><span class="p">)</span>
</span><span id="SliceFinder-553"><a href="#SliceFinder-553"><span class="linenos">553</span></a>
</span><span id="SliceFinder-554"><a href="#SliceFinder-554"><span class="linenos">554</span></a>        <span class="c1">#combine all pruning masks</span>
</span><span id="SliceFinder-555"><a href="#SliceFinder-555"><span class="linenos">555</span></a>        <span class="nb">map</span> <span class="o">=</span> <span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_sizes</span> <span class="o">&amp;</span> <span class="n">fScores</span> <span class="o">&amp;</span> <span class="n">f_parents</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SliceFinder-556"><a href="#SliceFinder-556"><span class="linenos">556</span></a>
</span><span id="SliceFinder-557"><a href="#SliceFinder-557"><span class="linenos">557</span></a>
</span><span id="SliceFinder-558"><a href="#SliceFinder-558"><span class="linenos">558</span></a>        <span class="c1">#apply masks</span>
</span><span id="SliceFinder-559"><a href="#SliceFinder-559"><span class="linenos">559</span></a>        <span class="n">dedup</span> <span class="o">=</span> <span class="nb">map</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,:]</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="SliceFinder-560"><a href="#SliceFinder-560"><span class="linenos">560</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">dedup</span> <span class="o">@</span> <span class="n">P</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="SliceFinder-561"><a href="#SliceFinder-561"><span class="linenos">561</span></a>
</span><span id="SliceFinder-562"><a href="#SliceFinder-562"><span class="linenos">562</span></a>        <span class="k">return</span> <span class="n">P</span>
</span><span id="SliceFinder-563"><a href="#SliceFinder-563"><span class="linenos">563</span></a>    
</span><span id="SliceFinder-564"><a href="#SliceFinder-564"><span class="linenos">564</span></a>    
</span><span id="SliceFinder-565"><a href="#SliceFinder-565"><span class="linenos">565</span></a>
</span><span id="SliceFinder-566"><a href="#SliceFinder-566"><span class="linenos">566</span></a>    <span class="k">def</span> <span class="nf">analyze_topK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TKC</span><span class="p">):</span>
</span><span id="SliceFinder-567"><a href="#SliceFinder-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-568"><a href="#SliceFinder-568"><span class="linenos">568</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-569"><a href="#SliceFinder-569"><span class="linenos">569</span></a><span class="sd">            Find the minimum and maximum score in the current top-k set `TKC`.</span>
</span><span id="SliceFinder-570"><a href="#SliceFinder-570"><span class="linenos">570</span></a><span class="sd">        </span>
</span><span id="SliceFinder-571"><a href="#SliceFinder-571"><span class="linenos">571</span></a><span class="sd">        :param TKC: </span>
</span><span id="SliceFinder-572"><a href="#SliceFinder-572"><span class="linenos">572</span></a><span class="sd">            A k x 4 matrix of statistics for the current slices.</span>
</span><span id="SliceFinder-573"><a href="#SliceFinder-573"><span class="linenos">573</span></a><span class="sd">        </span>
</span><span id="SliceFinder-574"><a href="#SliceFinder-574"><span class="linenos">574</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-575"><a href="#SliceFinder-575"><span class="linenos">575</span></a><span class="sd">            A dictionary containing:</span>
</span><span id="SliceFinder-576"><a href="#SliceFinder-576"><span class="linenos">576</span></a><span class="sd">            - `&quot;maxScore&quot;`: The maximum score (float).</span>
</span><span id="SliceFinder-577"><a href="#SliceFinder-577"><span class="linenos">577</span></a><span class="sd">            - `&quot;minScore&quot;`: The minimum score (float).</span>
</span><span id="SliceFinder-578"><a href="#SliceFinder-578"><span class="linenos">578</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-579"><a href="#SliceFinder-579"><span class="linenos">579</span></a>        <span class="n">maxScore</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="SliceFinder-580"><a href="#SliceFinder-580"><span class="linenos">580</span></a>        <span class="n">minScore</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="SliceFinder-581"><a href="#SliceFinder-581"><span class="linenos">581</span></a>        
</span><span id="SliceFinder-582"><a href="#SliceFinder-582"><span class="linenos">582</span></a>        <span class="k">if</span> <span class="n">TKC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder-583"><a href="#SliceFinder-583"><span class="linenos">583</span></a>            <span class="n">maxScore</span> <span class="o">=</span> <span class="n">TKC</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SliceFinder-584"><a href="#SliceFinder-584"><span class="linenos">584</span></a>            <span class="n">minScore</span> <span class="o">=</span> <span class="n">TKC</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">TKC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SliceFinder-585"><a href="#SliceFinder-585"><span class="linenos">585</span></a>            
</span><span id="SliceFinder-586"><a href="#SliceFinder-586"><span class="linenos">586</span></a>
</span><span id="SliceFinder-587"><a href="#SliceFinder-587"><span class="linenos">587</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;maxScore&quot;</span> <span class="p">:</span> <span class="n">maxScore</span><span class="p">,</span> <span class="s2">&quot;minScore&quot;</span> <span class="p">:</span> <span class="n">minScore</span><span class="p">}</span>
</span><span id="SliceFinder-588"><a href="#SliceFinder-588"><span class="linenos">588</span></a>
</span><span id="SliceFinder-589"><a href="#SliceFinder-589"><span class="linenos">589</span></a>
</span><span id="SliceFinder-590"><a href="#SliceFinder-590"><span class="linenos">590</span></a>
</span><span id="SliceFinder-591"><a href="#SliceFinder-591"><span class="linenos">591</span></a>    
</span><span id="SliceFinder-592"><a href="#SliceFinder-592"><span class="linenos">592</span></a>
</span><span id="SliceFinder-593"><a href="#SliceFinder-593"><span class="linenos">593</span></a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_sizes</span><span class="p">,</span> <span class="n">slice_errors</span><span class="p">,</span> <span class="n">total_samples</span><span class="p">):</span>
</span><span id="SliceFinder-594"><a href="#SliceFinder-594"><span class="linenos">594</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-595"><a href="#SliceFinder-595"><span class="linenos">595</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-596"><a href="#SliceFinder-596"><span class="linenos">596</span></a><span class="sd">            Apply the SliceLines scoring function. If division by zero occurs, return `-inf`.</span>
</span><span id="SliceFinder-597"><a href="#SliceFinder-597"><span class="linenos">597</span></a><span class="sd">        </span>
</span><span id="SliceFinder-598"><a href="#SliceFinder-598"><span class="linenos">598</span></a><span class="sd">        :param sliceSizes: </span>
</span><span id="SliceFinder-599"><a href="#SliceFinder-599"><span class="linenos">599</span></a><span class="sd">            Vector of sizes for each slice.</span>
</span><span id="SliceFinder-600"><a href="#SliceFinder-600"><span class="linenos">600</span></a><span class="sd">        </span>
</span><span id="SliceFinder-601"><a href="#SliceFinder-601"><span class="linenos">601</span></a><span class="sd">        :param sliceErrors: </span>
</span><span id="SliceFinder-602"><a href="#SliceFinder-602"><span class="linenos">602</span></a><span class="sd">            Vector of errors for each slice.</span>
</span><span id="SliceFinder-603"><a href="#SliceFinder-603"><span class="linenos">603</span></a><span class="sd">        </span>
</span><span id="SliceFinder-604"><a href="#SliceFinder-604"><span class="linenos">604</span></a><span class="sd">        :param nrows: </span>
</span><span id="SliceFinder-605"><a href="#SliceFinder-605"><span class="linenos">605</span></a><span class="sd">            Number of samples in the entire dataset.</span>
</span><span id="SliceFinder-606"><a href="#SliceFinder-606"><span class="linenos">606</span></a><span class="sd">        </span>
</span><span id="SliceFinder-607"><a href="#SliceFinder-607"><span class="linenos">607</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-608"><a href="#SliceFinder-608"><span class="linenos">608</span></a><span class="sd">            The computed scores for each slice, with `-inf` for cases where division by zero occurs.</span>
</span><span id="SliceFinder-609"><a href="#SliceFinder-609"><span class="linenos">609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-610"><a href="#SliceFinder-610"><span class="linenos">610</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">((</span><span class="n">slice_errors</span><span class="o">/</span><span class="n">slice_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgError</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_samples</span><span class="o">/</span><span class="n">slice_sizes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-611"><a href="#SliceFinder-611"><span class="linenos">611</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">nan</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SliceFinder-612"><a href="#SliceFinder-612"><span class="linenos">612</span></a>    
</span><span id="SliceFinder-613"><a href="#SliceFinder-613"><span class="linenos">613</span></a>    
</span><span id="SliceFinder-614"><a href="#SliceFinder-614"><span class="linenos">614</span></a>
</span><span id="SliceFinder-615"><a href="#SliceFinder-615"><span class="linenos">615</span></a>    <span class="k">def</span> <span class="nf">upperbound_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">):</span>
</span><span id="SliceFinder-616"><a href="#SliceFinder-616"><span class="linenos">616</span></a>
</span><span id="SliceFinder-617"><a href="#SliceFinder-617"><span class="linenos">617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-618"><a href="#SliceFinder-618"><span class="linenos">618</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-619"><a href="#SliceFinder-619"><span class="linenos">619</span></a><span class="sd">            Compute an upper bound for the SliceLines scoring function.</span>
</span><span id="SliceFinder-620"><a href="#SliceFinder-620"><span class="linenos">620</span></a><span class="sd">        </span>
</span><span id="SliceFinder-621"><a href="#SliceFinder-621"><span class="linenos">621</span></a><span class="sd">        :param ss: </span>
</span><span id="SliceFinder-622"><a href="#SliceFinder-622"><span class="linenos">622</span></a><span class="sd">            Vector containing the size of each slice.</span>
</span><span id="SliceFinder-623"><a href="#SliceFinder-623"><span class="linenos">623</span></a><span class="sd">        </span>
</span><span id="SliceFinder-624"><a href="#SliceFinder-624"><span class="linenos">624</span></a><span class="sd">        :param se: </span>
</span><span id="SliceFinder-625"><a href="#SliceFinder-625"><span class="linenos">625</span></a><span class="sd">            Vector containing the error for each slice.</span>
</span><span id="SliceFinder-626"><a href="#SliceFinder-626"><span class="linenos">626</span></a><span class="sd">        </span>
</span><span id="SliceFinder-627"><a href="#SliceFinder-627"><span class="linenos">627</span></a><span class="sd">        :param sm: </span>
</span><span id="SliceFinder-628"><a href="#SliceFinder-628"><span class="linenos">628</span></a><span class="sd">            Vector containing the maximum error for each slice.</span>
</span><span id="SliceFinder-629"><a href="#SliceFinder-629"><span class="linenos">629</span></a><span class="sd">        </span>
</span><span id="SliceFinder-630"><a href="#SliceFinder-630"><span class="linenos">630</span></a>
</span><span id="SliceFinder-631"><a href="#SliceFinder-631"><span class="linenos">631</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-632"><a href="#SliceFinder-632"><span class="linenos">632</span></a><span class="sd">            The computed upper bound for the SliceLines scoring function.</span>
</span><span id="SliceFinder-633"><a href="#SliceFinder-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-634"><a href="#SliceFinder-634"><span class="linenos">634</span></a>        <span class="c1"># probe interesting points of sc in the interval [minSup, ss],</span>
</span><span id="SliceFinder-635"><a href="#SliceFinder-635"><span class="linenos">635</span></a>        <span class="c1"># and compute the maximum to serve as the upper bound </span>
</span><span id="SliceFinder-636"><a href="#SliceFinder-636"><span class="linenos">636</span></a>        
</span><span id="SliceFinder-637"><a href="#SliceFinder-637"><span class="linenos">637</span></a>        <span class="c1">#s is the critical points we have to check</span>
</span><span id="SliceFinder-638"><a href="#SliceFinder-638"><span class="linenos">638</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">ss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">se</span><span class="o">/</span><span class="n">sm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span> <span class="n">ss</span><span class="p">))</span>
</span><span id="SliceFinder-639"><a href="#SliceFinder-639"><span class="linenos">639</span></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>
</span><span id="SliceFinder-640"><a href="#SliceFinder-640"><span class="linenos">640</span></a>        <span class="n">smex</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sm</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">sm</span><span class="p">))</span>
</span><span id="SliceFinder-641"><a href="#SliceFinder-641"><span class="linenos">641</span></a>        <span class="n">seex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">se</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">se</span><span class="p">))</span>
</span><span id="SliceFinder-642"><a href="#SliceFinder-642"><span class="linenos">642</span></a>        <span class="n">pmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">smex</span><span class="p">,</span> <span class="n">seex</span><span class="p">)</span>
</span><span id="SliceFinder-643"><a href="#SliceFinder-643"><span class="linenos">643</span></a>
</span><span id="SliceFinder-644"><a href="#SliceFinder-644"><span class="linenos">644</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">((</span><span class="n">pmin</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_error</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">s</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder-645"><a href="#SliceFinder-645"><span class="linenos">645</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">nan</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SliceFinder-646"><a href="#SliceFinder-646"><span class="linenos">646</span></a>        
</span><span id="SliceFinder-647"><a href="#SliceFinder-647"><span class="linenos">647</span></a>        
</span><span id="SliceFinder-648"><a href="#SliceFinder-648"><span class="linenos">648</span></a>        <span class="k">return</span> <span class="n">sc</span>
</span><span id="SliceFinder-649"><a href="#SliceFinder-649"><span class="linenos">649</span></a>            
</span><span id="SliceFinder-650"><a href="#SliceFinder-650"><span class="linenos">650</span></a>
</span><span id="SliceFinder-651"><a href="#SliceFinder-651"><span class="linenos">651</span></a>    <span class="k">def</span> <span class="nf">maintainTopK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">):</span>
</span><span id="SliceFinder-652"><a href="#SliceFinder-652"><span class="linenos">652</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-653"><a href="#SliceFinder-653"><span class="linenos">653</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-654"><a href="#SliceFinder-654"><span class="linenos">654</span></a><span class="sd">            Update the top-k slices and their statistics given the new slices `S` and statistics `R`.</span>
</span><span id="SliceFinder-655"><a href="#SliceFinder-655"><span class="linenos">655</span></a><span class="sd">        </span>
</span><span id="SliceFinder-656"><a href="#SliceFinder-656"><span class="linenos">656</span></a><span class="sd">        :param S: </span>
</span><span id="SliceFinder-657"><a href="#SliceFinder-657"><span class="linenos">657</span></a><span class="sd">            New slices to be considered for updating the top-k.</span>
</span><span id="SliceFinder-658"><a href="#SliceFinder-658"><span class="linenos">658</span></a><span class="sd">        </span>
</span><span id="SliceFinder-659"><a href="#SliceFinder-659"><span class="linenos">659</span></a><span class="sd">        :param R: </span>
</span><span id="SliceFinder-660"><a href="#SliceFinder-660"><span class="linenos">660</span></a><span class="sd">            New statistics corresponding to the new slices `S`.</span>
</span><span id="SliceFinder-661"><a href="#SliceFinder-661"><span class="linenos">661</span></a><span class="sd">        </span>
</span><span id="SliceFinder-662"><a href="#SliceFinder-662"><span class="linenos">662</span></a><span class="sd">        :param TK: </span>
</span><span id="SliceFinder-663"><a href="#SliceFinder-663"><span class="linenos">663</span></a><span class="sd">            Current top-k slices that will be updated.</span>
</span><span id="SliceFinder-664"><a href="#SliceFinder-664"><span class="linenos">664</span></a><span class="sd">        </span>
</span><span id="SliceFinder-665"><a href="#SliceFinder-665"><span class="linenos">665</span></a><span class="sd">        :param TKC: </span>
</span><span id="SliceFinder-666"><a href="#SliceFinder-666"><span class="linenos">666</span></a><span class="sd">            Current top-k statistics that will be updated.</span>
</span><span id="SliceFinder-667"><a href="#SliceFinder-667"><span class="linenos">667</span></a><span class="sd">        </span>
</span><span id="SliceFinder-668"><a href="#SliceFinder-668"><span class="linenos">668</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-669"><a href="#SliceFinder-669"><span class="linenos">669</span></a><span class="sd">            - `TK`: Updated top-k slices.</span>
</span><span id="SliceFinder-670"><a href="#SliceFinder-670"><span class="linenos">670</span></a><span class="sd">            - `TKC`: Updated top-k statistics.</span>
</span><span id="SliceFinder-671"><a href="#SliceFinder-671"><span class="linenos">671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-672"><a href="#SliceFinder-672"><span class="linenos">672</span></a>        
</span><span id="SliceFinder-673"><a href="#SliceFinder-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Maintain topk:&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-674"><a href="#SliceFinder-674"><span class="linenos">674</span></a>        <span class="n">top_k_indicies</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SliceFinder-675"><a href="#SliceFinder-675"><span class="linenos">675</span></a>        
</span><span id="SliceFinder-676"><a href="#SliceFinder-676"><span class="linenos">676</span></a>
</span><span id="SliceFinder-677"><a href="#SliceFinder-677"><span class="linenos">677</span></a>        <span class="c1">#prune on size and score</span>
</span><span id="SliceFinder-678"><a href="#SliceFinder-678"><span class="linenos">678</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="SliceFinder-679"><a href="#SliceFinder-679"><span class="linenos">679</span></a>        
</span><span id="SliceFinder-680"><a href="#SliceFinder-680"><span class="linenos">680</span></a>        <span class="c1">#if there are still valid slices left</span>
</span><span id="SliceFinder-681"><a href="#SliceFinder-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder-682"><a href="#SliceFinder-682"><span class="linenos">682</span></a>            <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder-683"><a href="#SliceFinder-683"><span class="linenos">683</span></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder-684"><a href="#SliceFinder-684"><span class="linenos">684</span></a>            
</span><span id="SliceFinder-685"><a href="#SliceFinder-685"><span class="linenos">685</span></a>            <span class="c1">#???</span>
</span><span id="SliceFinder-686"><a href="#SliceFinder-686"><span class="linenos">686</span></a>            <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SliceFinder-687"><a href="#SliceFinder-687"><span class="linenos">687</span></a>                <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span> 
</span><span id="SliceFinder-688"><a href="#SliceFinder-688"><span class="linenos">688</span></a>                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder-689"><a href="#SliceFinder-689"><span class="linenos">689</span></a>                
</span><span id="SliceFinder-690"><a href="#SliceFinder-690"><span class="linenos">690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; S </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
</span><span id="SliceFinder-691"><a href="#SliceFinder-691"><span class="linenos">691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; R </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
</span><span id="SliceFinder-692"><a href="#SliceFinder-692"><span class="linenos">692</span></a>
</span><span id="SliceFinder-693"><a href="#SliceFinder-693"><span class="linenos">693</span></a>            
</span><span id="SliceFinder-694"><a href="#SliceFinder-694"><span class="linenos">694</span></a>            <span class="n">slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TK</span><span class="p">,</span> <span class="n">S</span><span class="p">))</span>
</span><span id="SliceFinder-695"><a href="#SliceFinder-695"><span class="linenos">695</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TKC</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
</span><span id="SliceFinder-696"><a href="#SliceFinder-696"><span class="linenos">696</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;slices </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slices</span><span class="p">))</span>
</span><span id="SliceFinder-697"><a href="#SliceFinder-697"><span class="linenos">697</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;scores </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</span><span id="SliceFinder-698"><a href="#SliceFinder-698"><span class="linenos">698</span></a>            
</span><span id="SliceFinder-699"><a href="#SliceFinder-699"><span class="linenos">699</span></a>            
</span><span id="SliceFinder-700"><a href="#SliceFinder-700"><span class="linenos">700</span></a>            <span class="c1">#find new top-k slice indicies</span>
</span><span id="SliceFinder-701"><a href="#SliceFinder-701"><span class="linenos">701</span></a>            <span class="n">sorted_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder-702"><a href="#SliceFinder-702"><span class="linenos">702</span></a>            <span class="n">top_idxs</span> <span class="o">=</span> <span class="n">sorted_idxs</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_idxs</span><span class="p">))]</span>
</span><span id="SliceFinder-703"><a href="#SliceFinder-703"><span class="linenos">703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sorted idxs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sorted_idxs</span><span class="p">))</span>
</span><span id="SliceFinder-704"><a href="#SliceFinder-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;topk idxs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_idxs</span><span class="p">))</span>
</span><span id="SliceFinder-705"><a href="#SliceFinder-705"><span class="linenos">705</span></a>            
</span><span id="SliceFinder-706"><a href="#SliceFinder-706"><span class="linenos">706</span></a>            <span class="c1">#update top slices and top statistics with new topk values</span>
</span><span id="SliceFinder-707"><a href="#SliceFinder-707"><span class="linenos">707</span></a>            <span class="n">TK</span> <span class="o">=</span> <span class="n">slices</span><span class="p">[</span><span class="n">top_idxs</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="SliceFinder-708"><a href="#SliceFinder-708"><span class="linenos">708</span></a>            <span class="n">TKC</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">top_idxs</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="SliceFinder-709"><a href="#SliceFinder-709"><span class="linenos">709</span></a>            
</span><span id="SliceFinder-710"><a href="#SliceFinder-710"><span class="linenos">710</span></a>
</span><span id="SliceFinder-711"><a href="#SliceFinder-711"><span class="linenos">711</span></a>        <span class="k">return</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span>
</span><span id="SliceFinder-712"><a href="#SliceFinder-712"><span class="linenos">712</span></a>        
</span><span id="SliceFinder-713"><a href="#SliceFinder-713"><span class="linenos">713</span></a>    
</span><span id="SliceFinder-714"><a href="#SliceFinder-714"><span class="linenos">714</span></a>    
</span><span id="SliceFinder-715"><a href="#SliceFinder-715"><span class="linenos">715</span></a>
</span><span id="SliceFinder-716"><a href="#SliceFinder-716"><span class="linenos">716</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SliceFinder-717"><a href="#SliceFinder-717"><span class="linenos">717</span></a>    <span class="k">def</span> <span class="nf">pretty_print_results</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">featureNames</span><span class="p">,</span> <span class="n">domainValues</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SliceFinder-718"><a href="#SliceFinder-718"><span class="linenos">718</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder-719"><a href="#SliceFinder-719"><span class="linenos">719</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder-720"><a href="#SliceFinder-720"><span class="linenos">720</span></a><span class="sd">            Print the top-k selected slices and their statistics. </span>
</span><span id="SliceFinder-721"><a href="#SliceFinder-721"><span class="linenos">721</span></a><span class="sd">            Fill in the numeric column names and domain values with their actual values.</span>
</span><span id="SliceFinder-722"><a href="#SliceFinder-722"><span class="linenos">722</span></a><span class="sd">        </span>
</span><span id="SliceFinder-723"><a href="#SliceFinder-723"><span class="linenos">723</span></a><span class="sd">        :param result: </span>
</span><span id="SliceFinder-724"><a href="#SliceFinder-724"><span class="linenos">724</span></a><span class="sd">            A dictionary containing:</span>
</span><span id="SliceFinder-725"><a href="#SliceFinder-725"><span class="linenos">725</span></a><span class="sd">            - `&quot;TK&quot;`: Top-k slices.</span>
</span><span id="SliceFinder-726"><a href="#SliceFinder-726"><span class="linenos">726</span></a><span class="sd">            - `&quot;TKC&quot;`: Top-k statistics.</span>
</span><span id="SliceFinder-727"><a href="#SliceFinder-727"><span class="linenos">727</span></a><span class="sd">        </span>
</span><span id="SliceFinder-728"><a href="#SliceFinder-728"><span class="linenos">728</span></a><span class="sd">        :param featureNames: </span>
</span><span id="SliceFinder-729"><a href="#SliceFinder-729"><span class="linenos">729</span></a><span class="sd">            A list of names for each feature, 1-indexed. </span>
</span><span id="SliceFinder-730"><a href="#SliceFinder-730"><span class="linenos">730</span></a><span class="sd">            `featureNames[0]` should be an empty string.</span>
</span><span id="SliceFinder-731"><a href="#SliceFinder-731"><span class="linenos">731</span></a><span class="sd">        </span>
</span><span id="SliceFinder-732"><a href="#SliceFinder-732"><span class="linenos">732</span></a><span class="sd">        :param domainValues: </span>
</span><span id="SliceFinder-733"><a href="#SliceFinder-733"><span class="linenos">733</span></a><span class="sd">            A matrix where `domainValues[i][k]` is the name of the feature `i` taking on the `k`th domain value.</span>
</span><span id="SliceFinder-734"><a href="#SliceFinder-734"><span class="linenos">734</span></a><span class="sd">        </span>
</span><span id="SliceFinder-735"><a href="#SliceFinder-735"><span class="linenos">735</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder-736"><a href="#SliceFinder-736"><span class="linenos">736</span></a><span class="sd">            None. Prints the output to the screen.</span>
</span><span id="SliceFinder-737"><a href="#SliceFinder-737"><span class="linenos">737</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder-738"><a href="#SliceFinder-738"><span class="linenos">738</span></a>        <span class="n">TK</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;TK&quot;</span><span class="p">]</span>
</span><span id="SliceFinder-739"><a href="#SliceFinder-739"><span class="linenos">739</span></a>        <span class="n">TKC</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;TKC&quot;</span><span class="p">]</span>
</span><span id="SliceFinder-740"><a href="#SliceFinder-740"><span class="linenos">740</span></a>        
</span><span id="SliceFinder-741"><a href="#SliceFinder-741"><span class="linenos">741</span></a>        <span class="c1">#print(&quot;TK&quot;)</span>
</span><span id="SliceFinder-742"><a href="#SliceFinder-742"><span class="linenos">742</span></a>        <span class="c1">#print(TK)</span>
</span><span id="SliceFinder-743"><a href="#SliceFinder-743"><span class="linenos">743</span></a>        
</span><span id="SliceFinder-744"><a href="#SliceFinder-744"><span class="linenos">744</span></a>        <span class="c1">#print(&quot;TKC&quot;)</span>
</span><span id="SliceFinder-745"><a href="#SliceFinder-745"><span class="linenos">745</span></a>        <span class="c1">#print(TKC)</span>
</span><span id="SliceFinder-746"><a href="#SliceFinder-746"><span class="linenos">746</span></a>        
</span><span id="SliceFinder-747"><a href="#SliceFinder-747"><span class="linenos">747</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SliceFinder-748"><a href="#SliceFinder-748"><span class="linenos">748</span></a>        
</span><span id="SliceFinder-749"><a href="#SliceFinder-749"><span class="linenos">749</span></a>        
</span><span id="SliceFinder-750"><a href="#SliceFinder-750"><span class="linenos">750</span></a>        <span class="k">for</span> <span class="nb">slice</span> <span class="ow">in</span> <span class="n">TK</span><span class="p">:</span>
</span><span id="SliceFinder-751"><a href="#SliceFinder-751"><span class="linenos">751</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slice &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span><span id="SliceFinder-752"><a href="#SliceFinder-752"><span class="linenos">752</span></a>            
</span><span id="SliceFinder-753"><a href="#SliceFinder-753"><span class="linenos">753</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-754"><a href="#SliceFinder-754"><span class="linenos">754</span></a>            <span class="c1">#print features</span>
</span><span id="SliceFinder-755"><a href="#SliceFinder-755"><span class="linenos">755</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">slice</span><span class="p">)):</span>
</span><span id="SliceFinder-756"><a href="#SliceFinder-756"><span class="linenos">756</span></a>                <span class="k">if</span> <span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder-757"><a href="#SliceFinder-757"><span class="linenos">757</span></a>                    
</span><span id="SliceFinder-758"><a href="#SliceFinder-758"><span class="linenos">758</span></a>                    <span class="k">if</span> <span class="n">domainValues</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SliceFinder-759"><a href="#SliceFinder-759"><span class="linenos">759</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureNames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
</span><span id="SliceFinder-760"><a href="#SliceFinder-760"><span class="linenos">760</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder-761"><a href="#SliceFinder-761"><span class="linenos">761</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureNames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domainValues</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
</span><span id="SliceFinder-762"><a href="#SliceFinder-762"><span class="linenos">762</span></a>                        
</span><span id="SliceFinder-763"><a href="#SliceFinder-763"><span class="linenos">763</span></a>                    
</span><span id="SliceFinder-764"><a href="#SliceFinder-764"><span class="linenos">764</span></a>            <span class="c1">#print scores</span>
</span><span id="SliceFinder-765"><a href="#SliceFinder-765"><span class="linenos">765</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------&quot;</span><span class="p">)</span>
</span><span id="SliceFinder-766"><a href="#SliceFinder-766"><span class="linenos">766</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   score: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="SliceFinder-767"><a href="#SliceFinder-767"><span class="linenos">767</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   avg. error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="SliceFinder-768"><a href="#SliceFinder-768"><span class="linenos">768</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   max error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="SliceFinder-769"><a href="#SliceFinder-769"><span class="linenos">769</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="SliceFinder-770"><a href="#SliceFinder-770"><span class="linenos">770</span></a>            
</span><span id="SliceFinder-771"><a href="#SliceFinder-771"><span class="linenos">771</span></a>            
</span><span id="SliceFinder-772"><a href="#SliceFinder-772"><span class="linenos">772</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SliceFinder-773"><a href="#SliceFinder-773"><span class="linenos">773</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>An implementation of SliceLine Fast Linear Alebra Based Slice Finding</p>

<p>Algorithm Credit: <a href="https://dl.acm.org/doi/10.1145/3448016.3457323">https://dl.acm.org/doi/10.1145/3448016.3457323</a></p>

<p>Parameters:
    K (int)
    X (matrix of size of size n x m)
    e  (vector of size containing error for each point) 
    σ (int, size threshold)
    ∝ (score function parameter)
    L (how many level of the lattice to prune)</p>

<p>Returns: 
    TS (a K x m matrix)
        Each row is a slice that was picked as topk
        Each feature is in {0, 1} where a 0 means a feature is not considered in the slice (free)
    TR (a K x 3 matrix of statistics for each slice)
        Score
        Error
        Size</p>
</div>


                            <div id="SliceFinder.__init__" class="classattr">
                                        <input id="SliceFinder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SliceFinder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">X</span>, </span><span class="param"><span class="n">e</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">k</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">sigma</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span>, </span><span class="param"><span class="n">L</span><span class="o">=</span><span class="mi">2</span>, </span><span class="param"><span class="n">logger</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">auto</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="SliceFinder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.__init__-48"><a href="#SliceFinder.__init__-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SliceFinder.__init__-49"><a href="#SliceFinder.__init__-49"><span class="linenos">49</span></a>        <span class="c1">#e: list of errors for each datapoint</span>
</span><span id="SliceFinder.__init__-50"><a href="#SliceFinder.__init__-50"><span class="linenos">50</span></a>        <span class="c1">#sigma: size threshold for smallest allowable slice</span>
</span><span id="SliceFinder.__init__-51"><a href="#SliceFinder.__init__-51"><span class="linenos">51</span></a>        <span class="c1">#alpha: score function balancing parameter</span>
</span><span id="SliceFinder.__init__-52"><a href="#SliceFinder.__init__-52"><span class="linenos">52</span></a>        <span class="c1">#L : how many levels of the lattice to prune</span>
</span><span id="SliceFinder.__init__-53"><a href="#SliceFinder.__init__-53"><span class="linenos">53</span></a>        
</span><span id="SliceFinder.__init__-54"><a href="#SliceFinder.__init__-54"><span class="linenos">54</span></a>        
</span><span id="SliceFinder.__init__-55"><a href="#SliceFinder.__init__-55"><span class="linenos">55</span></a>        <span class="c1">#Initilize variables</span>
</span><span id="SliceFinder.__init__-56"><a href="#SliceFinder.__init__-56"><span class="linenos">56</span></a>        <span class="k">if</span> <span class="n">logger</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SliceFinder.__init__-57"><a href="#SliceFinder.__init__-57"><span class="linenos">57</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;dummyLog.log&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.__init__-58"><a href="#SliceFinder.__init__-58"><span class="linenos">58</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder.__init__-59"><a href="#SliceFinder.__init__-59"><span class="linenos">59</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
</span><span id="SliceFinder.__init__-60"><a href="#SliceFinder.__init__-60"><span class="linenos">60</span></a>            
</span><span id="SliceFinder.__init__-61"><a href="#SliceFinder.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">X0</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="SliceFinder.__init__-62"><a href="#SliceFinder.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="SliceFinder.__init__-63"><a href="#SliceFinder.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="SliceFinder.__init__-64"><a href="#SliceFinder.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
</span><span id="SliceFinder.__init__-65"><a href="#SliceFinder.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="SliceFinder.__init__-66"><a href="#SliceFinder.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SliceFinder.__init__-67"><a href="#SliceFinder.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">L_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
</span><span id="SliceFinder.__init__-68"><a href="#SliceFinder.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">avgError</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span>
</span><span id="SliceFinder.__init__-69"><a href="#SliceFinder.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;samples: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
</span><span id="SliceFinder.__init__-70"><a href="#SliceFinder.__init__-70"><span class="linenos">70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;features: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
</span><span id="SliceFinder.__init__-71"><a href="#SliceFinder.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;avg error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avgError</span><span class="p">))</span>
</span><span id="SliceFinder.__init__-72"><a href="#SliceFinder.__init__-72"><span class="linenos">72</span></a>        
</span><span id="SliceFinder.__init__-73"><a href="#SliceFinder.__init__-73"><span class="linenos">73</span></a>        
</span><span id="SliceFinder.__init__-74"><a href="#SliceFinder.__init__-74"><span class="linenos">74</span></a>        
</span><span id="SliceFinder.__init__-75"><a href="#SliceFinder.__init__-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="n">auto</span><span class="p">:</span>
</span><span id="SliceFinder.__init__-76"><a href="#SliceFinder.__init__-76"><span class="linenos">76</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="SliceFinder.X0" class="classattr">
                                <div class="attr variable">
            <span class="name">X0</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.X0"></a>
    
    

                            </div>
                            <div id="SliceFinder.k" class="classattr">
                                <div class="attr variable">
            <span class="name">k</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.k"></a>
    
    

                            </div>
                            <div id="SliceFinder.errors" class="classattr">
                                <div class="attr variable">
            <span class="name">errors</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.errors"></a>
    
    

                            </div>
                            <div id="SliceFinder.sigma" class="classattr">
                                <div class="attr variable">
            <span class="name">sigma</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.sigma"></a>
    
    

                            </div>
                            <div id="SliceFinder.alpha" class="classattr">
                                <div class="attr variable">
            <span class="name">alpha</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.alpha"></a>
    
    

                            </div>
                            <div id="SliceFinder.L_max" class="classattr">
                                <div class="attr variable">
            <span class="name">L_max</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.L_max"></a>
    
    

                            </div>
                            <div id="SliceFinder.avgError" class="classattr">
                                <div class="attr variable">
            <span class="name">avgError</span>

        
    </div>
    <a class="headerlink" href="#SliceFinder.avgError"></a>
    
    

                            </div>
                            <div id="SliceFinder.run" class="classattr">
                                        <input id="SliceFinder.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.run-80"><a href="#SliceFinder.run-80"><span class="linenos">80</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SliceFinder.run-81"><a href="#SliceFinder.run-81"><span class="linenos">81</span></a>        <span class="c1">#one hot encode dataset and get new feature begginings (fb) and ends (fe)</span>
</span><span id="SliceFinder.run-82"><a href="#SliceFinder.run-82"><span class="linenos">82</span></a>        <span class="n">fdom</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_prep</span><span class="p">()</span>
</span><span id="SliceFinder.run-83"><a href="#SliceFinder.run-83"><span class="linenos">83</span></a>        
</span><span id="SliceFinder.run-84"><a href="#SliceFinder.run-84"><span class="linenos">84</span></a>        <span class="c1">#new number of features</span>
</span><span id="SliceFinder.run-85"><a href="#SliceFinder.run-85"><span class="linenos">85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SliceFinder.run-86"><a href="#SliceFinder.run-86"><span class="linenos">86</span></a>        
</span><span id="SliceFinder.run-87"><a href="#SliceFinder.run-87"><span class="linenos">87</span></a>        <span class="c1">#get 1-predicate slices, stats, pruning indicator</span>
</span><span id="SliceFinder.run-88"><a href="#SliceFinder.run-88"><span class="linenos">88</span></a>        <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_score_basic_slices</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span id="SliceFinder.run-89"><a href="#SliceFinder.run-89"><span class="linenos">89</span></a>        
</span><span id="SliceFinder.run-90"><a href="#SliceFinder.run-90"><span class="linenos">90</span></a>        <span class="c1">#Top slices (TS), top statistics (TR)</span>
</span><span id="SliceFinder.run-91"><a href="#SliceFinder.run-91"><span class="linenos">91</span></a>        <span class="n">TS</span><span class="p">,</span> <span class="n">TR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintainTopK</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)))</span>
</span><span id="SliceFinder.run-92"><a href="#SliceFinder.run-92"><span class="linenos">92</span></a>        
</span><span id="SliceFinder.run-93"><a href="#SliceFinder.run-93"><span class="linenos">93</span></a>        <span class="c1">#Run recursive step</span>
</span><span id="SliceFinder.run-94"><a href="#SliceFinder.run-94"><span class="linenos">94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainLoop</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">TS</span><span class="p">,</span> <span class="n">TR</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SliceFinder.mainLoop" class="classattr">
                                        <input id="SliceFinder.mainLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainLoop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">X</span>, </span><span class="param"><span class="n">S</span>, </span><span class="param"><span class="n">R</span>, </span><span class="param"><span class="n">CI</span>, </span><span class="param"><span class="n">TK</span>, </span><span class="param"><span class="n">TKC</span>, </span><span class="param"><span class="n">fb</span>, </span><span class="param"><span class="n">fe</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.mainLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.mainLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.mainLoop-100"><a href="#SliceFinder.mainLoop-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">mainLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="SliceFinder.mainLoop-101"><a href="#SliceFinder.mainLoop-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.mainLoop-102"><a href="#SliceFinder.mainLoop-102"><span class="linenos">102</span></a>
</span><span id="SliceFinder.mainLoop-103"><a href="#SliceFinder.mainLoop-103"><span class="linenos">103</span></a><span class="sd">            Executes the recursive part of sliceLine</span>
</span><span id="SliceFinder.mainLoop-104"><a href="#SliceFinder.mainLoop-104"><span class="linenos">104</span></a><span class="sd">            </span>
</span><span id="SliceFinder.mainLoop-105"><a href="#SliceFinder.mainLoop-105"><span class="linenos">105</span></a><span class="sd">            :param X: </span>
</span><span id="SliceFinder.mainLoop-106"><a href="#SliceFinder.mainLoop-106"><span class="linenos">106</span></a><span class="sd">                a one hot encoded dataset matrix</span>
</span><span id="SliceFinder.mainLoop-107"><a href="#SliceFinder.mainLoop-107"><span class="linenos">107</span></a><span class="sd">                </span>
</span><span id="SliceFinder.mainLoop-108"><a href="#SliceFinder.mainLoop-108"><span class="linenos">108</span></a><span class="sd">            :param S: </span>
</span><span id="SliceFinder.mainLoop-109"><a href="#SliceFinder.mainLoop-109"><span class="linenos">109</span></a><span class="sd">                a set of 1-predicate slices</span>
</span><span id="SliceFinder.mainLoop-110"><a href="#SliceFinder.mainLoop-110"><span class="linenos">110</span></a><span class="sd">                </span>
</span><span id="SliceFinder.mainLoop-111"><a href="#SliceFinder.mainLoop-111"><span class="linenos">111</span></a><span class="sd">            :param R: </span>
</span><span id="SliceFinder.mainLoop-112"><a href="#SliceFinder.mainLoop-112"><span class="linenos">112</span></a><span class="sd">                Statistics for the 1-predicate slices. (R[0] = ...)</span>
</span><span id="SliceFinder.mainLoop-113"><a href="#SliceFinder.mainLoop-113"><span class="linenos">113</span></a><span class="sd">            </span>
</span><span id="SliceFinder.mainLoop-114"><a href="#SliceFinder.mainLoop-114"><span class="linenos">114</span></a><span class="sd">            :param CI: </span>
</span><span id="SliceFinder.mainLoop-115"><a href="#SliceFinder.mainLoop-115"><span class="linenos">115</span></a><span class="sd">                Pruning indicator for basic slices.</span>
</span><span id="SliceFinder.mainLoop-116"><a href="#SliceFinder.mainLoop-116"><span class="linenos">116</span></a><span class="sd">            </span>
</span><span id="SliceFinder.mainLoop-117"><a href="#SliceFinder.mainLoop-117"><span class="linenos">117</span></a><span class="sd">            :param TK: </span>
</span><span id="SliceFinder.mainLoop-118"><a href="#SliceFinder.mainLoop-118"><span class="linenos">118</span></a><span class="sd">                Top-k slice representations.</span>
</span><span id="SliceFinder.mainLoop-119"><a href="#SliceFinder.mainLoop-119"><span class="linenos">119</span></a><span class="sd">            </span>
</span><span id="SliceFinder.mainLoop-120"><a href="#SliceFinder.mainLoop-120"><span class="linenos">120</span></a><span class="sd">            :param TKC: </span>
</span><span id="SliceFinder.mainLoop-121"><a href="#SliceFinder.mainLoop-121"><span class="linenos">121</span></a><span class="sd">                Top-k slice statistics.</span>
</span><span id="SliceFinder.mainLoop-122"><a href="#SliceFinder.mainLoop-122"><span class="linenos">122</span></a><span class="sd">            </span>
</span><span id="SliceFinder.mainLoop-123"><a href="#SliceFinder.mainLoop-123"><span class="linenos">123</span></a><span class="sd">            :param fb: </span>
</span><span id="SliceFinder.mainLoop-124"><a href="#SliceFinder.mainLoop-124"><span class="linenos">124</span></a><span class="sd">                Feature beginnings.</span>
</span><span id="SliceFinder.mainLoop-125"><a href="#SliceFinder.mainLoop-125"><span class="linenos">125</span></a><span class="sd">            </span>
</span><span id="SliceFinder.mainLoop-126"><a href="#SliceFinder.mainLoop-126"><span class="linenos">126</span></a><span class="sd">            :param fe: </span>
</span><span id="SliceFinder.mainLoop-127"><a href="#SliceFinder.mainLoop-127"><span class="linenos">127</span></a><span class="sd">                Feature endings.</span>
</span><span id="SliceFinder.mainLoop-128"><a href="#SliceFinder.mainLoop-128"><span class="linenos">128</span></a>
</span><span id="SliceFinder.mainLoop-129"><a href="#SliceFinder.mainLoop-129"><span class="linenos">129</span></a><span class="sd">            :return: </span>
</span><span id="SliceFinder.mainLoop-130"><a href="#SliceFinder.mainLoop-130"><span class="linenos">130</span></a><span class="sd">                Top slices (TK) and statistics (TKC) in a dict</span>
</span><span id="SliceFinder.mainLoop-131"><a href="#SliceFinder.mainLoop-131"><span class="linenos">131</span></a><span class="sd">            :rtype: dict</span>
</span><span id="SliceFinder.mainLoop-132"><a href="#SliceFinder.mainLoop-132"><span class="linenos">132</span></a><span class="sd">                </span>
</span><span id="SliceFinder.mainLoop-133"><a href="#SliceFinder.mainLoop-133"><span class="linenos">133</span></a>
</span><span id="SliceFinder.mainLoop-134"><a href="#SliceFinder.mainLoop-134"><span class="linenos">134</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SliceFinder.mainLoop-135"><a href="#SliceFinder.mainLoop-135"><span class="linenos">135</span></a>        
</span><span id="SliceFinder.mainLoop-136"><a href="#SliceFinder.mainLoop-136"><span class="linenos">136</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="SliceFinder.mainLoop-137"><a href="#SliceFinder.mainLoop-137"><span class="linenos">137</span></a>        
</span><span id="SliceFinder.mainLoop-138"><a href="#SliceFinder.mainLoop-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Entering the main loop&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-139"><a href="#SliceFinder.mainLoop-139"><span class="linenos">139</span></a>        <span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SliceFinder.mainLoop-140"><a href="#SliceFinder.mainLoop-140"><span class="linenos">140</span></a>        
</span><span id="SliceFinder.mainLoop-141"><a href="#SliceFinder.mainLoop-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Pruning current slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-142"><a href="#SliceFinder.mainLoop-142"><span class="linenos">142</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder.mainLoop-143"><a href="#SliceFinder.mainLoop-143"><span class="linenos">143</span></a>        
</span><span id="SliceFinder.mainLoop-144"><a href="#SliceFinder.mainLoop-144"><span class="linenos">144</span></a>        <span class="c1">#while there are still valid slices left and </span>
</span><span id="SliceFinder.mainLoop-145"><a href="#SliceFinder.mainLoop-145"><span class="linenos">145</span></a>        <span class="k">while</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_max</span><span class="p">):</span>
</span><span id="SliceFinder.mainLoop-146"><a href="#SliceFinder.mainLoop-146"><span class="linenos">146</span></a>            <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span>
</span><span id="SliceFinder.mainLoop-147"><a href="#SliceFinder.mainLoop-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; Forming new slices for level &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
</span><span id="SliceFinder.mainLoop-148"><a href="#SliceFinder.mainLoop-148"><span class="linenos">148</span></a>            <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pair_candidates</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-149"><a href="#SliceFinder.mainLoop-149"><span class="linenos">149</span></a>            
</span><span id="SliceFinder.mainLoop-150"><a href="#SliceFinder.mainLoop-150"><span class="linenos">150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Evaluating new slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-151"><a href="#SliceFinder.mainLoop-151"><span class="linenos">151</span></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="SliceFinder.mainLoop-152"><a href="#SliceFinder.mainLoop-152"><span class="linenos">152</span></a>
</span><span id="SliceFinder.mainLoop-153"><a href="#SliceFinder.mainLoop-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder.mainLoop-154"><a href="#SliceFinder.mainLoop-154"><span class="linenos">154</span></a>                <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_slice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">L</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-155"><a href="#SliceFinder.mainLoop-155"><span class="linenos">155</span></a>            
</span><span id="SliceFinder.mainLoop-156"><a href="#SliceFinder.mainLoop-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Maintaing topk&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-157"><a href="#SliceFinder.mainLoop-157"><span class="linenos">157</span></a>            <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintainTopK</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-158"><a href="#SliceFinder.mainLoop-158"><span class="linenos">158</span></a>            
</span><span id="SliceFinder.mainLoop-159"><a href="#SliceFinder.mainLoop-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;finished in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span> <span class="p">))</span>
</span><span id="SliceFinder.mainLoop-160"><a href="#SliceFinder.mainLoop-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;decoding top-k slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-161"><a href="#SliceFinder.mainLoop-161"><span class="linenos">161</span></a>        <span class="n">TK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_top_k</span><span class="p">(</span><span class="n">TK</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">)</span>
</span><span id="SliceFinder.mainLoop-162"><a href="#SliceFinder.mainLoop-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;TK&quot;</span> <span class="p">:</span> <span class="n">TK</span><span class="p">,</span> <span class="s2">&quot;TKC&quot;</span> <span class="p">:</span> <span class="n">TKC</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Executes the recursive part of sliceLine</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>X</strong>:<br />
a one hot encoded dataset matrix</p></li>
<li><p><strong>S</strong>:<br />
a set of 1-predicate slices</p></li>
<li><p><strong>R</strong>:<br />
Statistics for the 1-predicate slices. (R[0] = ...)</p></li>
<li><p><strong>CI</strong>:<br />
Pruning indicator for basic slices.</p></li>
<li><p><strong>TK</strong>:<br />
Top-k slice representations.</p></li>
<li><p><strong>TKC</strong>:<br />
Top-k slice statistics.</p></li>
<li><p><strong>fb</strong>:<br />
Feature beginnings.</p></li>
<li><p><strong>fe</strong>:<br />
Feature endings.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>Top slices (TK) and statistics (TKC) in a dict
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.decode_top_k" class="classattr">
                                        <input id="SliceFinder.decode_top_k-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_top_k</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">TK</span>, </span><span class="param"><span class="n">fb</span>, </span><span class="param"><span class="n">fe</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.decode_top_k-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.decode_top_k"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.decode_top_k-166"><a href="#SliceFinder.decode_top_k-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">decode_top_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="SliceFinder.decode_top_k-167"><a href="#SliceFinder.decode_top_k-167"><span class="linenos">167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.decode_top_k-168"><a href="#SliceFinder.decode_top_k-168"><span class="linenos">168</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.decode_top_k-169"><a href="#SliceFinder.decode_top_k-169"><span class="linenos">169</span></a><span class="sd">            Convert slice representations back to their original form </span>
</span><span id="SliceFinder.decode_top_k-170"><a href="#SliceFinder.decode_top_k-170"><span class="linenos">170</span></a><span class="sd">            (before `X` was one-hot encoded).</span>
</span><span id="SliceFinder.decode_top_k-171"><a href="#SliceFinder.decode_top_k-171"><span class="linenos">171</span></a><span class="sd">        </span>
</span><span id="SliceFinder.decode_top_k-172"><a href="#SliceFinder.decode_top_k-172"><span class="linenos">172</span></a><span class="sd">        :param TK: </span>
</span><span id="SliceFinder.decode_top_k-173"><a href="#SliceFinder.decode_top_k-173"><span class="linenos">173</span></a><span class="sd">            Matrix of the top-k slices.</span>
</span><span id="SliceFinder.decode_top_k-174"><a href="#SliceFinder.decode_top_k-174"><span class="linenos">174</span></a><span class="sd">        </span>
</span><span id="SliceFinder.decode_top_k-175"><a href="#SliceFinder.decode_top_k-175"><span class="linenos">175</span></a><span class="sd">        :param fb: </span>
</span><span id="SliceFinder.decode_top_k-176"><a href="#SliceFinder.decode_top_k-176"><span class="linenos">176</span></a><span class="sd">            List of feature beginnings.</span>
</span><span id="SliceFinder.decode_top_k-177"><a href="#SliceFinder.decode_top_k-177"><span class="linenos">177</span></a><span class="sd">        </span>
</span><span id="SliceFinder.decode_top_k-178"><a href="#SliceFinder.decode_top_k-178"><span class="linenos">178</span></a><span class="sd">        :param fe: </span>
</span><span id="SliceFinder.decode_top_k-179"><a href="#SliceFinder.decode_top_k-179"><span class="linenos">179</span></a><span class="sd">            List of feature endings.</span>
</span><span id="SliceFinder.decode_top_k-180"><a href="#SliceFinder.decode_top_k-180"><span class="linenos">180</span></a><span class="sd">        </span>
</span><span id="SliceFinder.decode_top_k-181"><a href="#SliceFinder.decode_top_k-181"><span class="linenos">181</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.decode_top_k-182"><a href="#SliceFinder.decode_top_k-182"><span class="linenos">182</span></a><span class="sd">            Top-k slice representations from the original dataset `X`.</span>
</span><span id="SliceFinder.decode_top_k-183"><a href="#SliceFinder.decode_top_k-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.decode_top_k-184"><a href="#SliceFinder.decode_top_k-184"><span class="linenos">184</span></a>        
</span><span id="SliceFinder.decode_top_k-185"><a href="#SliceFinder.decode_top_k-185"><span class="linenos">185</span></a>        <span class="n">TK_decoded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="SliceFinder.decode_top_k-186"><a href="#SliceFinder.decode_top_k-186"><span class="linenos">186</span></a>
</span><span id="SliceFinder.decode_top_k-187"><a href="#SliceFinder.decode_top_k-187"><span class="linenos">187</span></a>        <span class="c1">#for each feature beg-end</span>
</span><span id="SliceFinder.decode_top_k-188"><a href="#SliceFinder.decode_top_k-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder.decode_top_k-189"><a href="#SliceFinder.decode_top_k-189"><span class="linenos">189</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fb</span><span class="p">)):</span>
</span><span id="SliceFinder.decode_top_k-190"><a href="#SliceFinder.decode_top_k-190"><span class="linenos">190</span></a>                <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder.decode_top_k-191"><a href="#SliceFinder.decode_top_k-191"><span class="linenos">191</span></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder.decode_top_k-192"><a href="#SliceFinder.decode_top_k-192"><span class="linenos">192</span></a>
</span><span id="SliceFinder.decode_top_k-193"><a href="#SliceFinder.decode_top_k-193"><span class="linenos">193</span></a>                
</span><span id="SliceFinder.decode_top_k-194"><a href="#SliceFinder.decode_top_k-194"><span class="linenos">194</span></a>                <span class="c1">#find the index in the expanded fature with a 1, that poisition is feature number</span>
</span><span id="SliceFinder.decode_top_k-195"><a href="#SliceFinder.decode_top_k-195"><span class="linenos">195</span></a>                <span class="n">sub_TK</span> <span class="o">=</span> <span class="n">TK</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>  
</span><span id="SliceFinder.decode_top_k-196"><a href="#SliceFinder.decode_top_k-196"><span class="linenos">196</span></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> 
</span><span id="SliceFinder.decode_top_k-197"><a href="#SliceFinder.decode_top_k-197"><span class="linenos">197</span></a>                <span class="n">maxcol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.decode_top_k-198"><a href="#SliceFinder.decode_top_k-198"><span class="linenos">198</span></a>                <span class="n">maxcol</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SliceFinder.decode_top_k-199"><a href="#SliceFinder.decode_top_k-199"><span class="linenos">199</span></a>                <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_TK</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">maxcol</span>
</span><span id="SliceFinder.decode_top_k-200"><a href="#SliceFinder.decode_top_k-200"><span class="linenos">200</span></a>
</span><span id="SliceFinder.decode_top_k-201"><a href="#SliceFinder.decode_top_k-201"><span class="linenos">201</span></a>                <span class="n">TK_decoded</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
</span><span id="SliceFinder.decode_top_k-202"><a href="#SliceFinder.decode_top_k-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="n">TK_decoded</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Convert slice representations back to their original form 
    (before <code>X</code> was one-hot encoded).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>TK</strong>:<br />
Matrix of the top-k slices.</p></li>
<li><p><strong>fb</strong>:<br />
List of feature beginnings.</p></li>
<li><p><strong>fe</strong>:<br />
List of feature endings.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>Top-k slice representations from the original dataset `X`.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.eval_slice" class="classattr">
                                        <input id="SliceFinder.eval_slice-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">eval_slice</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">X</span>, </span><span class="param"><span class="n">e</span>, </span><span class="param"><span class="n">S</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.eval_slice-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.eval_slice"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.eval_slice-206"><a href="#SliceFinder.eval_slice-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">eval_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
</span><span id="SliceFinder.eval_slice-207"><a href="#SliceFinder.eval_slice-207"><span class="linenos">207</span></a>
</span><span id="SliceFinder.eval_slice-208"><a href="#SliceFinder.eval_slice-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.eval_slice-209"><a href="#SliceFinder.eval_slice-209"><span class="linenos">209</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.eval_slice-210"><a href="#SliceFinder.eval_slice-210"><span class="linenos">210</span></a><span class="sd">            Get statistics for slice `S`.</span>
</span><span id="SliceFinder.eval_slice-211"><a href="#SliceFinder.eval_slice-211"><span class="linenos">211</span></a><span class="sd">        </span>
</span><span id="SliceFinder.eval_slice-212"><a href="#SliceFinder.eval_slice-212"><span class="linenos">212</span></a><span class="sd">        :param X: </span>
</span><span id="SliceFinder.eval_slice-213"><a href="#SliceFinder.eval_slice-213"><span class="linenos">213</span></a><span class="sd">            One-hot encoded dataset.</span>
</span><span id="SliceFinder.eval_slice-214"><a href="#SliceFinder.eval_slice-214"><span class="linenos">214</span></a><span class="sd">        </span>
</span><span id="SliceFinder.eval_slice-215"><a href="#SliceFinder.eval_slice-215"><span class="linenos">215</span></a><span class="sd">        :param e: </span>
</span><span id="SliceFinder.eval_slice-216"><a href="#SliceFinder.eval_slice-216"><span class="linenos">216</span></a><span class="sd">            Error vector for the entire dataset.</span>
</span><span id="SliceFinder.eval_slice-217"><a href="#SliceFinder.eval_slice-217"><span class="linenos">217</span></a><span class="sd">        </span>
</span><span id="SliceFinder.eval_slice-218"><a href="#SliceFinder.eval_slice-218"><span class="linenos">218</span></a><span class="sd">        :param S: </span>
</span><span id="SliceFinder.eval_slice-219"><a href="#SliceFinder.eval_slice-219"><span class="linenos">219</span></a><span class="sd">            A slice that needs to be evaluated.</span>
</span><span id="SliceFinder.eval_slice-220"><a href="#SliceFinder.eval_slice-220"><span class="linenos">220</span></a><span class="sd">        </span>
</span><span id="SliceFinder.eval_slice-221"><a href="#SliceFinder.eval_slice-221"><span class="linenos">221</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.eval_slice-222"><a href="#SliceFinder.eval_slice-222"><span class="linenos">222</span></a><span class="sd">            Vector where `stats[0]` is the score, `stats[1]` is the error, </span>
</span><span id="SliceFinder.eval_slice-223"><a href="#SliceFinder.eval_slice-223"><span class="linenos">223</span></a><span class="sd">            `stats[2]` is the maximum error, and `stats[3]` is the size.</span>
</span><span id="SliceFinder.eval_slice-224"><a href="#SliceFinder.eval_slice-224"><span class="linenos">224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.eval_slice-225"><a href="#SliceFinder.eval_slice-225"><span class="linenos">225</span></a>        
</span><span id="SliceFinder.eval_slice-226"><a href="#SliceFinder.eval_slice-226"><span class="linenos">226</span></a>        <span class="c1">#indicator for which columns of error vector this slice needs</span>
</span><span id="SliceFinder.eval_slice-227"><a href="#SliceFinder.eval_slice-227"><span class="linenos">227</span></a>        <span class="n">s_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">S</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="SliceFinder.eval_slice-228"><a href="#SliceFinder.eval_slice-228"><span class="linenos">228</span></a>        
</span><span id="SliceFinder.eval_slice-229"><a href="#SliceFinder.eval_slice-229"><span class="linenos">229</span></a>        <span class="c1">#slice size, total error, max error, score</span>
</span><span id="SliceFinder.eval_slice-230"><a href="#SliceFinder.eval_slice-230"><span class="linenos">230</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.eval_slice-231"><a href="#SliceFinder.eval_slice-231"><span class="linenos">231</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">s_mask</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder.eval_slice-232"><a href="#SliceFinder.eval_slice-232"><span class="linenos">232</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_mask</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">s_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
</span><span id="SliceFinder.eval_slice-233"><a href="#SliceFinder.eval_slice-233"><span class="linenos">233</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder.eval_slice-234"><a href="#SliceFinder.eval_slice-234"><span class="linenos">234</span></a>        
</span><span id="SliceFinder.eval_slice-235"><a href="#SliceFinder.eval_slice-235"><span class="linenos">235</span></a>        <span class="c1">#stack them to form a row in </span>
</span><span id="SliceFinder.eval_slice-236"><a href="#SliceFinder.eval_slice-236"><span class="linenos">236</span></a>        <span class="n">stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder.eval_slice-237"><a href="#SliceFinder.eval_slice-237"><span class="linenos">237</span></a>        <span class="k">return</span> <span class="n">stats</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Get statistics for slice <code>S</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>X</strong>:<br />
One-hot encoded dataset.</p></li>
<li><p><strong>e</strong>:<br />
Error vector for the entire dataset.</p></li>
<li><p><strong>S</strong>:<br />
A slice that needs to be evaluated.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>Vector where `stats[0]` is the score, `stats[1]` is the error, 
`stats[2]` is the maximum error, and `stats[3]` is the size.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.data_prep" class="classattr">
                                        <input id="SliceFinder.data_prep-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">data_prep</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.data_prep-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.data_prep"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.data_prep-240"><a href="#SliceFinder.data_prep-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">data_prep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SliceFinder.data_prep-241"><a href="#SliceFinder.data_prep-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.data_prep-242"><a href="#SliceFinder.data_prep-242"><span class="linenos">242</span></a><span class="sd">        Summary: </span>
</span><span id="SliceFinder.data_prep-243"><a href="#SliceFinder.data_prep-243"><span class="linenos">243</span></a><span class="sd">            1. Find domains for each feature.</span>
</span><span id="SliceFinder.data_prep-244"><a href="#SliceFinder.data_prep-244"><span class="linenos">244</span></a><span class="sd">            2. Compute start and end offsets of each feature.</span>
</span><span id="SliceFinder.data_prep-245"><a href="#SliceFinder.data_prep-245"><span class="linenos">245</span></a><span class="sd">            3. Get one-hot encoding of the entire dataset.</span>
</span><span id="SliceFinder.data_prep-246"><a href="#SliceFinder.data_prep-246"><span class="linenos">246</span></a><span class="sd">        </span>
</span><span id="SliceFinder.data_prep-247"><a href="#SliceFinder.data_prep-247"><span class="linenos">247</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.data_prep-248"><a href="#SliceFinder.data_prep-248"><span class="linenos">248</span></a><span class="sd">            - fdom: Domains sizes for each feature.</span>
</span><span id="SliceFinder.data_prep-249"><a href="#SliceFinder.data_prep-249"><span class="linenos">249</span></a><span class="sd">            - fb: Feature beginnings in the one-hot matrix.</span>
</span><span id="SliceFinder.data_prep-250"><a href="#SliceFinder.data_prep-250"><span class="linenos">250</span></a><span class="sd">            - fe: Feature endings in the one-hot matrix.</span>
</span><span id="SliceFinder.data_prep-251"><a href="#SliceFinder.data_prep-251"><span class="linenos">251</span></a><span class="sd">            - X: One-hot encoded dataset.</span>
</span><span id="SliceFinder.data_prep-252"><a href="#SliceFinder.data_prep-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.data_prep-253"><a href="#SliceFinder.data_prep-253"><span class="linenos">253</span></a>        <span class="c1">#fdom (feature domain sizes) are the maximum value along ecah column of the dataset for continuous integer encoding</span>
</span><span id="SliceFinder.data_prep-254"><a href="#SliceFinder.data_prep-254"><span class="linenos">254</span></a>        <span class="n">fdom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.data_prep-255"><a href="#SliceFinder.data_prep-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fdom: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="SliceFinder.data_prep-256"><a href="#SliceFinder.data_prep-256"><span class="linenos">256</span></a>        
</span><span id="SliceFinder.data_prep-257"><a href="#SliceFinder.data_prep-257"><span class="linenos">257</span></a>        <span class="c1">#fb is where each feature in new matrix starts</span>
</span><span id="SliceFinder.data_prep-258"><a href="#SliceFinder.data_prep-258"><span class="linenos">258</span></a>        <span class="n">fb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fdom</span><span class="p">)</span> <span class="o">-</span> <span class="n">fdom</span>
</span><span id="SliceFinder.data_prep-259"><a href="#SliceFinder.data_prep-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fb: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fb</span><span class="p">))</span>
</span><span id="SliceFinder.data_prep-260"><a href="#SliceFinder.data_prep-260"><span class="linenos">260</span></a>        
</span><span id="SliceFinder.data_prep-261"><a href="#SliceFinder.data_prep-261"><span class="linenos">261</span></a>        <span class="c1">#fe is where each feature in new matrix ends</span>
</span><span id="SliceFinder.data_prep-262"><a href="#SliceFinder.data_prep-262"><span class="linenos">262</span></a>        <span class="n">fe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">fdom</span><span class="p">)</span>
</span><span id="SliceFinder.data_prep-263"><a href="#SliceFinder.data_prep-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fe: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fe</span><span class="p">))</span>
</span><span id="SliceFinder.data_prep-264"><a href="#SliceFinder.data_prep-264"><span class="linenos">264</span></a>        
</span><span id="SliceFinder.data_prep-265"><a href="#SliceFinder.data_prep-265"><span class="linenos">265</span></a>        
</span><span id="SliceFinder.data_prep-266"><a href="#SliceFinder.data_prep-266"><span class="linenos">266</span></a>        <span class="c1">#one hot encode the entire dataset</span>
</span><span id="SliceFinder.data_prep-267"><a href="#SliceFinder.data_prep-267"><span class="linenos">267</span></a>        <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
</span><span id="SliceFinder.data_prep-268"><a href="#SliceFinder.data_prep-268"><span class="linenos">268</span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</span><span id="SliceFinder.data_prep-269"><a href="#SliceFinder.data_prep-269"><span class="linenos">269</span></a>
</span><span id="SliceFinder.data_prep-270"><a href="#SliceFinder.data_prep-270"><span class="linenos">270</span></a>
</span><span id="SliceFinder.data_prep-271"><a href="#SliceFinder.data_prep-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="n">fdom</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">X</span>
</span></pre></div>


            <div class="docstring"><p>Summary: 
    1. Find domains for each feature.
    2. Compute start and end offsets of each feature.
    3. Get one-hot encoding of the entire dataset.</p>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>- fdom: Domains sizes for each feature.
- fb: Feature beginnings in the one-hot matrix.
- fe: Feature endings in the one-hot matrix.
- X: One-hot encoded dataset.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.getCounts" class="classattr">
                                        <input id="SliceFinder.getCounts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getCounts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">v</span>, </span><span class="param"><span class="n">bins</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.getCounts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.getCounts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.getCounts-274"><a href="#SliceFinder.getCounts-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">getCounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
</span><span id="SliceFinder.getCounts-275"><a href="#SliceFinder.getCounts-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.getCounts-276"><a href="#SliceFinder.getCounts-276"><span class="linenos">276</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.getCounts-277"><a href="#SliceFinder.getCounts-277"><span class="linenos">277</span></a><span class="sd">            - Count bins for an integer or vector.</span>
</span><span id="SliceFinder.getCounts-278"><a href="#SliceFinder.getCounts-278"><span class="linenos">278</span></a><span class="sd">            - For integers, it returns a set of bins with that integer&#39;s bin set to value 1.</span>
</span><span id="SliceFinder.getCounts-279"><a href="#SliceFinder.getCounts-279"><span class="linenos">279</span></a><span class="sd">            - For vectors, it returns a set of bins where `bins[i]` is the number of occurrences of `i` in the vector.</span>
</span><span id="SliceFinder.getCounts-280"><a href="#SliceFinder.getCounts-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="SliceFinder.getCounts-281"><a href="#SliceFinder.getCounts-281"><span class="linenos">281</span></a><span class="sd">        :param v: </span>
</span><span id="SliceFinder.getCounts-282"><a href="#SliceFinder.getCounts-282"><span class="linenos">282</span></a><span class="sd">            Vector or integer to be counted.</span>
</span><span id="SliceFinder.getCounts-283"><a href="#SliceFinder.getCounts-283"><span class="linenos">283</span></a><span class="sd">        </span>
</span><span id="SliceFinder.getCounts-284"><a href="#SliceFinder.getCounts-284"><span class="linenos">284</span></a><span class="sd">        :param vmax: </span>
</span><span id="SliceFinder.getCounts-285"><a href="#SliceFinder.getCounts-285"><span class="linenos">285</span></a><span class="sd">            The number of bins to include. Must be &gt;= the largest element in `v`.</span>
</span><span id="SliceFinder.getCounts-286"><a href="#SliceFinder.getCounts-286"><span class="linenos">286</span></a><span class="sd">        </span>
</span><span id="SliceFinder.getCounts-287"><a href="#SliceFinder.getCounts-287"><span class="linenos">287</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.getCounts-288"><a href="#SliceFinder.getCounts-288"><span class="linenos">288</span></a><span class="sd">            Bins for the given input. For integers, it returns a set with the corresponding bin set to 1. For vectors, it returns a set where each bin contains the count of occurrences of the index in the vector.</span>
</span><span id="SliceFinder.getCounts-289"><a href="#SliceFinder.getCounts-289"><span class="linenos">289</span></a><span class="sd">        &quot;&quot;&quot;</span>            
</span><span id="SliceFinder.getCounts-290"><a href="#SliceFinder.getCounts-290"><span class="linenos">290</span></a>        
</span><span id="SliceFinder.getCounts-291"><a href="#SliceFinder.getCounts-291"><span class="linenos">291</span></a>        
</span><span id="SliceFinder.getCounts-292"><a href="#SliceFinder.getCounts-292"><span class="linenos">292</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>
</span><span id="SliceFinder.getCounts-293"><a href="#SliceFinder.getCounts-293"><span class="linenos">293</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">bins</span><span class="p">))</span>
</span><span id="SliceFinder.getCounts-294"><a href="#SliceFinder.getCounts-294"><span class="linenos">294</span></a>            <span class="n">vec</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SliceFinder.getCounts-295"><a href="#SliceFinder.getCounts-295"><span class="linenos">295</span></a>            <span class="k">return</span> <span class="n">vec</span>
</span><span id="SliceFinder.getCounts-296"><a href="#SliceFinder.getCounts-296"><span class="linenos">296</span></a>        
</span><span id="SliceFinder.getCounts-297"><a href="#SliceFinder.getCounts-297"><span class="linenos">297</span></a>        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="SliceFinder.getCounts-298"><a href="#SliceFinder.getCounts-298"><span class="linenos">298</span></a>            <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">bins</span><span class="p">))</span>
</span><span id="SliceFinder.getCounts-299"><a href="#SliceFinder.getCounts-299"><span class="linenos">299</span></a>            <span class="k">for</span> <span class="n">vij</span> <span class="ow">in</span> <span class="n">vi</span><span class="p">:</span>
</span><span id="SliceFinder.getCounts-300"><a href="#SliceFinder.getCounts-300"><span class="linenos">300</span></a>                <span class="n">vec</span><span class="p">[</span><span class="n">vij</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SliceFinder.getCounts-301"><a href="#SliceFinder.getCounts-301"><span class="linenos">301</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder.getCounts-302"><a href="#SliceFinder.getCounts-302"><span class="linenos">302</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;unsupported use of getCounts&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.getCounts-303"><a href="#SliceFinder.getCounts-303"><span class="linenos">303</span></a>            <span class="n">exit</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    - Count bins for an integer or vector.
    - For integers, it returns a set of bins with that integer's bin set to value 1.
    - For vectors, it returns a set of bins where <code>bins[i]</code> is the number of occurrences of <code>i</code> in the vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>v</strong>:<br />
Vector or integer to be counted.</p></li>
<li><p><strong>vmax</strong>:<br />
The number of bins to include. Must be &gt;= the largest element in <code>v</code>.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>Bins for the given input. For integers, it returns a set with the corresponding bin set to 1. For vectors, it returns a set where each bin contains the count of occurrences of the index in the vector.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.expand" class="classattr">
                                        <input id="SliceFinder.expand-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">expand</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">v</span>, </span><span class="param"><span class="n">m</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.expand-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.expand"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.expand-310"><a href="#SliceFinder.expand-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SliceFinder.expand-311"><a href="#SliceFinder.expand-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.expand-312"><a href="#SliceFinder.expand-312"><span class="linenos">312</span></a><span class="sd">            Summary:</span>
</span><span id="SliceFinder.expand-313"><a href="#SliceFinder.expand-313"><span class="linenos">313</span></a><span class="sd">                gets a dense matrix representation of a sparse matrix v</span>
</span><span id="SliceFinder.expand-314"><a href="#SliceFinder.expand-314"><span class="linenos">314</span></a><span class="sd">            </span>
</span><span id="SliceFinder.expand-315"><a href="#SliceFinder.expand-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.expand-316"><a href="#SliceFinder.expand-316"><span class="linenos">316</span></a>        
</span><span id="SliceFinder.expand-317"><a href="#SliceFinder.expand-317"><span class="linenos">317</span></a>        
</span><span id="SliceFinder.expand-318"><a href="#SliceFinder.expand-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SliceFinder.expand-319"><a href="#SliceFinder.expand-319"><span class="linenos">319</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="SliceFinder.expand-320"><a href="#SliceFinder.expand-320"><span class="linenos">320</span></a>            
</span><span id="SliceFinder.expand-321"><a href="#SliceFinder.expand-321"><span class="linenos">321</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="SliceFinder.expand-322"><a href="#SliceFinder.expand-322"><span class="linenos">322</span></a>        <span class="c1">#count number of occourances for each value in each row</span>
</span><span id="SliceFinder.expand-323"><a href="#SliceFinder.expand-323"><span class="linenos">323</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder.expand-324"><a href="#SliceFinder.expand-324"><span class="linenos">324</span></a>
</span><span id="SliceFinder.expand-325"><a href="#SliceFinder.expand-325"><span class="linenos">325</span></a>            <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCounts</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">m</span><span class="p">)</span>
</span><span id="SliceFinder.expand-326"><a href="#SliceFinder.expand-326"><span class="linenos">326</span></a>
</span><span id="SliceFinder.expand-327"><a href="#SliceFinder.expand-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="n">R</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    gets a dense matrix representation of a sparse matrix v</p>
</div>


                            </div>
                            <div id="SliceFinder.find_score_basic_slices" class="classattr">
                                        <input id="SliceFinder.find_score_basic_slices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_score_basic_slices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">X</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.find_score_basic_slices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.find_score_basic_slices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.find_score_basic_slices-331"><a href="#SliceFinder.find_score_basic_slices-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">find_score_basic_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
</span><span id="SliceFinder.find_score_basic_slices-332"><a href="#SliceFinder.find_score_basic_slices-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.find_score_basic_slices-333"><a href="#SliceFinder.find_score_basic_slices-333"><span class="linenos">333</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.find_score_basic_slices-334"><a href="#SliceFinder.find_score_basic_slices-334"><span class="linenos">334</span></a><span class="sd">            Find the 1-predicate slices and their statistics.</span>
</span><span id="SliceFinder.find_score_basic_slices-335"><a href="#SliceFinder.find_score_basic_slices-335"><span class="linenos">335</span></a><span class="sd">        </span>
</span><span id="SliceFinder.find_score_basic_slices-336"><a href="#SliceFinder.find_score_basic_slices-336"><span class="linenos">336</span></a><span class="sd">        :param X: </span>
</span><span id="SliceFinder.find_score_basic_slices-337"><a href="#SliceFinder.find_score_basic_slices-337"><span class="linenos">337</span></a><span class="sd">            One-hot encoded dataset.</span>
</span><span id="SliceFinder.find_score_basic_slices-338"><a href="#SliceFinder.find_score_basic_slices-338"><span class="linenos">338</span></a><span class="sd">        </span>
</span><span id="SliceFinder.find_score_basic_slices-339"><a href="#SliceFinder.find_score_basic_slices-339"><span class="linenos">339</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.find_score_basic_slices-340"><a href="#SliceFinder.find_score_basic_slices-340"><span class="linenos">340</span></a><span class="sd">            - S: Basic slices.</span>
</span><span id="SliceFinder.find_score_basic_slices-341"><a href="#SliceFinder.find_score_basic_slices-341"><span class="linenos">341</span></a><span class="sd">            - R: Basic slice statistics.</span>
</span><span id="SliceFinder.find_score_basic_slices-342"><a href="#SliceFinder.find_score_basic_slices-342"><span class="linenos">342</span></a><span class="sd">            - CI: Pruning indicator based on size and score.</span>
</span><span id="SliceFinder.find_score_basic_slices-343"><a href="#SliceFinder.find_score_basic_slices-343"><span class="linenos">343</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.find_score_basic_slices-344"><a href="#SliceFinder.find_score_basic_slices-344"><span class="linenos">344</span></a>        <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SliceFinder.find_score_basic_slices-345"><a href="#SliceFinder.find_score_basic_slices-345"><span class="linenos">345</span></a>        <span class="c1">#ss0 = sizes of each basic slice are column sums</span>
</span><span id="SliceFinder.find_score_basic_slices-346"><a href="#SliceFinder.find_score_basic_slices-346"><span class="linenos">346</span></a>        <span class="n">ss0</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.find_score_basic_slices-347"><a href="#SliceFinder.find_score_basic_slices-347"><span class="linenos">347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ss0: </span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ss0</span><span class="p">))</span>
</span><span id="SliceFinder.find_score_basic_slices-348"><a href="#SliceFinder.find_score_basic_slices-348"><span class="linenos">348</span></a>        
</span><span id="SliceFinder.find_score_basic_slices-349"><a href="#SliceFinder.find_score_basic_slices-349"><span class="linenos">349</span></a>        <span class="c1">#se0 = error of each basic slice</span>
</span><span id="SliceFinder.find_score_basic_slices-350"><a href="#SliceFinder.find_score_basic_slices-350"><span class="linenos">350</span></a>        <span class="n">se0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.find_score_basic_slices-351"><a href="#SliceFinder.find_score_basic_slices-351"><span class="linenos">351</span></a>        
</span><span id="SliceFinder.find_score_basic_slices-352"><a href="#SliceFinder.find_score_basic_slices-352"><span class="linenos">352</span></a>        <span class="c1">#sm0 = the maximum error among elements in each slice</span>
</span><span id="SliceFinder.find_score_basic_slices-353"><a href="#SliceFinder.find_score_basic_slices-353"><span class="linenos">353</span></a>        <span class="n">sm0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.find_score_basic_slices-354"><a href="#SliceFinder.find_score_basic_slices-354"><span class="linenos">354</span></a>
</span><span id="SliceFinder.find_score_basic_slices-355"><a href="#SliceFinder.find_score_basic_slices-355"><span class="linenos">355</span></a>        <span class="c1">#pruning indicator</span>
</span><span id="SliceFinder.find_score_basic_slices-356"><a href="#SliceFinder.find_score_basic_slices-356"><span class="linenos">356</span></a>        <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="n">ss0</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">se0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.find_score_basic_slices-357"><a href="#SliceFinder.find_score_basic_slices-357"><span class="linenos">357</span></a>
</span><span id="SliceFinder.find_score_basic_slices-358"><a href="#SliceFinder.find_score_basic_slices-358"><span class="linenos">358</span></a>        <span class="c1">#prune basic slice scores and errors</span>
</span><span id="SliceFinder.find_score_basic_slices-359"><a href="#SliceFinder.find_score_basic_slices-359"><span class="linenos">359</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder.find_score_basic_slices-360"><a href="#SliceFinder.find_score_basic_slices-360"><span class="linenos">360</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">se0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder.find_score_basic_slices-361"><a href="#SliceFinder.find_score_basic_slices-361"><span class="linenos">361</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">sm0</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder.find_score_basic_slices-362"><a href="#SliceFinder.find_score_basic_slices-362"><span class="linenos">362</span></a>        
</span><span id="SliceFinder.find_score_basic_slices-363"><a href="#SliceFinder.find_score_basic_slices-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;ss: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span>
</span><span id="SliceFinder.find_score_basic_slices-364"><a href="#SliceFinder.find_score_basic_slices-364"><span class="linenos">364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;se: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">se</span><span class="p">))</span>
</span><span id="SliceFinder.find_score_basic_slices-365"><a href="#SliceFinder.find_score_basic_slices-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sm: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sm</span><span class="p">))</span>
</span><span id="SliceFinder.find_score_basic_slices-366"><a href="#SliceFinder.find_score_basic_slices-366"><span class="linenos">366</span></a>        
</span><span id="SliceFinder.find_score_basic_slices-367"><a href="#SliceFinder.find_score_basic_slices-367"><span class="linenos">367</span></a>        
</span><span id="SliceFinder.find_score_basic_slices-368"><a href="#SliceFinder.find_score_basic_slices-368"><span class="linenos">368</span></a>        <span class="c1">#a set of pruned slices (very sparse matrix representation)</span>
</span><span id="SliceFinder.find_score_basic_slices-369"><a href="#SliceFinder.find_score_basic_slices-369"><span class="linenos">369</span></a>        <span class="n">slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)[</span><span class="n">CI</span><span class="p">],</span> <span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</span><span id="SliceFinder.find_score_basic_slices-370"><a href="#SliceFinder.find_score_basic_slices-370"><span class="linenos">370</span></a>
</span><span id="SliceFinder.find_score_basic_slices-371"><a href="#SliceFinder.find_score_basic_slices-371"><span class="linenos">371</span></a>        <span class="c1">#slice scores</span>
</span><span id="SliceFinder.find_score_basic_slices-372"><a href="#SliceFinder.find_score_basic_slices-372"><span class="linenos">372</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</span><span id="SliceFinder.find_score_basic_slices-373"><a href="#SliceFinder.find_score_basic_slices-373"><span class="linenos">373</span></a>
</span><span id="SliceFinder.find_score_basic_slices-374"><a href="#SliceFinder.find_score_basic_slices-374"><span class="linenos">374</span></a>        
</span><span id="SliceFinder.find_score_basic_slices-375"><a href="#SliceFinder.find_score_basic_slices-375"><span class="linenos">375</span></a>        <span class="c1">#form statistics matrix</span>
</span><span id="SliceFinder.find_score_basic_slices-376"><a href="#SliceFinder.find_score_basic_slices-376"><span class="linenos">376</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sc</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder.find_score_basic_slices-377"><a href="#SliceFinder.find_score_basic_slices-377"><span class="linenos">377</span></a>
</span><span id="SliceFinder.find_score_basic_slices-378"><a href="#SliceFinder.find_score_basic_slices-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="n">slices</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">CI</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Find the 1-predicate slices and their statistics.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>X</strong>:<br />
One-hot encoded dataset.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>- S: Basic slices.
- R: Basic slice statistics.
- CI: Pruning indicator based on size and score.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.get_pair_candidates" class="classattr">
                                        <input id="SliceFinder.get_pair_candidates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_pair_candidates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">S</span>, </span><span class="param"><span class="n">R</span>, </span><span class="param"><span class="n">TKC</span>, </span><span class="param"><span class="n">L</span>, </span><span class="param"><span class="n">fb</span>, </span><span class="param"><span class="n">fe</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.get_pair_candidates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.get_pair_candidates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.get_pair_candidates-383"><a href="#SliceFinder.get_pair_candidates-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">get_pair_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TKC</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fe</span><span class="p">):</span>
</span><span id="SliceFinder.get_pair_candidates-384"><a href="#SliceFinder.get_pair_candidates-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.get_pair_candidates-385"><a href="#SliceFinder.get_pair_candidates-385"><span class="linenos">385</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.get_pair_candidates-386"><a href="#SliceFinder.get_pair_candidates-386"><span class="linenos">386</span></a><span class="sd">            Form a set of valid L-predicate slices using the given L-1 predicate slices `S`.</span>
</span><span id="SliceFinder.get_pair_candidates-387"><a href="#SliceFinder.get_pair_candidates-387"><span class="linenos">387</span></a>
</span><span id="SliceFinder.get_pair_candidates-388"><a href="#SliceFinder.get_pair_candidates-388"><span class="linenos">388</span></a><span class="sd">            1. Form every combination of slices from level L-1.</span>
</span><span id="SliceFinder.get_pair_candidates-389"><a href="#SliceFinder.get_pair_candidates-389"><span class="linenos">389</span></a><span class="sd">            2. Prune those without L-2 overlap.</span>
</span><span id="SliceFinder.get_pair_candidates-390"><a href="#SliceFinder.get_pair_candidates-390"><span class="linenos">390</span></a><span class="sd">            3. Form row and column index pairs of valid combinations.</span>
</span><span id="SliceFinder.get_pair_candidates-391"><a href="#SliceFinder.get_pair_candidates-391"><span class="linenos">391</span></a><span class="sd">            4. Get parents using row, column index pairs.</span>
</span><span id="SliceFinder.get_pair_candidates-392"><a href="#SliceFinder.get_pair_candidates-392"><span class="linenos">392</span></a><span class="sd">            5. Form new slices.</span>
</span><span id="SliceFinder.get_pair_candidates-393"><a href="#SliceFinder.get_pair_candidates-393"><span class="linenos">393</span></a><span class="sd">            6. Prune slices that assign more than one value to a feature.</span>
</span><span id="SliceFinder.get_pair_candidates-394"><a href="#SliceFinder.get_pair_candidates-394"><span class="linenos">394</span></a><span class="sd">            7. Extract size and error for new slices as the minimum of their parents.</span>
</span><span id="SliceFinder.get_pair_candidates-395"><a href="#SliceFinder.get_pair_candidates-395"><span class="linenos">395</span></a><span class="sd">            8. Perform deduplication using unique IDs.</span>
</span><span id="SliceFinder.get_pair_candidates-396"><a href="#SliceFinder.get_pair_candidates-396"><span class="linenos">396</span></a><span class="sd">            9. Upper bound the scoring function and prune new slices.</span>
</span><span id="SliceFinder.get_pair_candidates-397"><a href="#SliceFinder.get_pair_candidates-397"><span class="linenos">397</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-398"><a href="#SliceFinder.get_pair_candidates-398"><span class="linenos">398</span></a><span class="sd">        :param S: </span>
</span><span id="SliceFinder.get_pair_candidates-399"><a href="#SliceFinder.get_pair_candidates-399"><span class="linenos">399</span></a><span class="sd">            Slices from level L-1.</span>
</span><span id="SliceFinder.get_pair_candidates-400"><a href="#SliceFinder.get_pair_candidates-400"><span class="linenos">400</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-401"><a href="#SliceFinder.get_pair_candidates-401"><span class="linenos">401</span></a><span class="sd">        :param R: </span>
</span><span id="SliceFinder.get_pair_candidates-402"><a href="#SliceFinder.get_pair_candidates-402"><span class="linenos">402</span></a><span class="sd">            Statistics for those slices.</span>
</span><span id="SliceFinder.get_pair_candidates-403"><a href="#SliceFinder.get_pair_candidates-403"><span class="linenos">403</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-404"><a href="#SliceFinder.get_pair_candidates-404"><span class="linenos">404</span></a><span class="sd">        :param TKC: </span>
</span><span id="SliceFinder.get_pair_candidates-405"><a href="#SliceFinder.get_pair_candidates-405"><span class="linenos">405</span></a><span class="sd">            Top-k slice statistics.</span>
</span><span id="SliceFinder.get_pair_candidates-406"><a href="#SliceFinder.get_pair_candidates-406"><span class="linenos">406</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-407"><a href="#SliceFinder.get_pair_candidates-407"><span class="linenos">407</span></a><span class="sd">        :param L: </span>
</span><span id="SliceFinder.get_pair_candidates-408"><a href="#SliceFinder.get_pair_candidates-408"><span class="linenos">408</span></a><span class="sd">            Current level of slices.</span>
</span><span id="SliceFinder.get_pair_candidates-409"><a href="#SliceFinder.get_pair_candidates-409"><span class="linenos">409</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-410"><a href="#SliceFinder.get_pair_candidates-410"><span class="linenos">410</span></a><span class="sd">        :param fb: </span>
</span><span id="SliceFinder.get_pair_candidates-411"><a href="#SliceFinder.get_pair_candidates-411"><span class="linenos">411</span></a><span class="sd">            Feature beginnings.</span>
</span><span id="SliceFinder.get_pair_candidates-412"><a href="#SliceFinder.get_pair_candidates-412"><span class="linenos">412</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-413"><a href="#SliceFinder.get_pair_candidates-413"><span class="linenos">413</span></a><span class="sd">        :param fe: </span>
</span><span id="SliceFinder.get_pair_candidates-414"><a href="#SliceFinder.get_pair_candidates-414"><span class="linenos">414</span></a><span class="sd">            Feature endings.</span>
</span><span id="SliceFinder.get_pair_candidates-415"><a href="#SliceFinder.get_pair_candidates-415"><span class="linenos">415</span></a><span class="sd">        </span>
</span><span id="SliceFinder.get_pair_candidates-416"><a href="#SliceFinder.get_pair_candidates-416"><span class="linenos">416</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.get_pair_candidates-417"><a href="#SliceFinder.get_pair_candidates-417"><span class="linenos">417</span></a><span class="sd">            - P: A set of valid pair candidates.</span>
</span><span id="SliceFinder.get_pair_candidates-418"><a href="#SliceFinder.get_pair_candidates-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.get_pair_candidates-419"><a href="#SliceFinder.get_pair_candidates-419"><span class="linenos">419</span></a>        
</span><span id="SliceFinder.get_pair_candidates-420"><a href="#SliceFinder.get_pair_candidates-420"><span class="linenos">420</span></a>        <span class="c1">#prune invalid input slices using thresholds for size (sigma) and error (non-negative)</span>
</span><span id="SliceFinder.get_pair_candidates-421"><a href="#SliceFinder.get_pair_candidates-421"><span class="linenos">421</span></a>        <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-422"><a href="#SliceFinder.get_pair_candidates-422"><span class="linenos">422</span></a>        <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">CI</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-423"><a href="#SliceFinder.get_pair_candidates-423"><span class="linenos">423</span></a>
</span><span id="SliceFinder.get_pair_candidates-424"><a href="#SliceFinder.get_pair_candidates-424"><span class="linenos">424</span></a>        <span class="c1">#(S ⊙ S.T) creates every possible combination of slices</span>
</span><span id="SliceFinder.get_pair_candidates-425"><a href="#SliceFinder.get_pair_candidates-425"><span class="linenos">425</span></a>        <span class="n">SST</span> <span class="o">=</span> <span class="n">S</span> <span class="o">@</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder.get_pair_candidates-426"><a href="#SliceFinder.get_pair_candidates-426"><span class="linenos">426</span></a>
</span><span id="SliceFinder.get_pair_candidates-427"><a href="#SliceFinder.get_pair_candidates-427"><span class="linenos">427</span></a>        <span class="c1">#valid slices should have L-2 overlap</span>
</span><span id="SliceFinder.get_pair_candidates-428"><a href="#SliceFinder.get_pair_candidates-428"><span class="linenos">428</span></a>        <span class="n">valid_SST</span> <span class="o">=</span> <span class="p">(</span><span class="n">SST</span> <span class="o">==</span> <span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
</span><span id="SliceFinder.get_pair_candidates-429"><a href="#SliceFinder.get_pair_candidates-429"><span class="linenos">429</span></a>
</span><span id="SliceFinder.get_pair_candidates-430"><a href="#SliceFinder.get_pair_candidates-430"><span class="linenos">430</span></a>        
</span><span id="SliceFinder.get_pair_candidates-431"><a href="#SliceFinder.get_pair_candidates-431"><span class="linenos">431</span></a>        <span class="c1">#since the matrix is symetric we only need top half</span>
</span><span id="SliceFinder.get_pair_candidates-432"><a href="#SliceFinder.get_pair_candidates-432"><span class="linenos">432</span></a>        <span class="c1">#I is a mask for new slices with L-2 overlap</span>
</span><span id="SliceFinder.get_pair_candidates-433"><a href="#SliceFinder.get_pair_candidates-433"><span class="linenos">433</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">valid_SST</span><span class="p">)</span> <span class="o">*</span> <span class="n">valid_SST</span>
</span><span id="SliceFinder.get_pair_candidates-434"><a href="#SliceFinder.get_pair_candidates-434"><span class="linenos">434</span></a>        
</span><span id="SliceFinder.get_pair_candidates-435"><a href="#SliceFinder.get_pair_candidates-435"><span class="linenos">435</span></a>
</span><span id="SliceFinder.get_pair_candidates-436"><a href="#SliceFinder.get_pair_candidates-436"><span class="linenos">436</span></a>        <span class="c1">#create combined slices parents by converting I to row, column index pairs (rix and cix)</span>
</span><span id="SliceFinder.get_pair_candidates-437"><a href="#SliceFinder.get_pair_candidates-437"><span class="linenos">437</span></a>        <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SliceFinder.get_pair_candidates-438"><a href="#SliceFinder.get_pair_candidates-438"><span class="linenos">438</span></a>        
</span><span id="SliceFinder.get_pair_candidates-439"><a href="#SliceFinder.get_pair_candidates-439"><span class="linenos">439</span></a>        <span class="c1">#form row index matrix</span>
</span><span id="SliceFinder.get_pair_candidates-440"><a href="#SliceFinder.get_pair_candidates-440"><span class="linenos">440</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_cols</span><span class="p">))</span>
</span><span id="SliceFinder.get_pair_candidates-441"><a href="#SliceFinder.get_pair_candidates-441"><span class="linenos">441</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">rix</span>
</span><span id="SliceFinder.get_pair_candidates-442"><a href="#SliceFinder.get_pair_candidates-442"><span class="linenos">442</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-443"><a href="#SliceFinder.get_pair_candidates-443"><span class="linenos">443</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="p">[</span> <span class="n">rix</span><span class="o">!=</span><span class="mi">0</span> <span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-444"><a href="#SliceFinder.get_pair_candidates-444"><span class="linenos">444</span></a>        <span class="n">rix</span> <span class="o">=</span> <span class="n">rix</span><span class="o">-</span><span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-445"><a href="#SliceFinder.get_pair_candidates-445"><span class="linenos">445</span></a>        
</span><span id="SliceFinder.get_pair_candidates-446"><a href="#SliceFinder.get_pair_candidates-446"><span class="linenos">446</span></a>        <span class="c1">#column index matrix</span>
</span><span id="SliceFinder.get_pair_candidates-447"><a href="#SliceFinder.get_pair_candidates-447"><span class="linenos">447</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_cols</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="SliceFinder.get_pair_candidates-448"><a href="#SliceFinder.get_pair_candidates-448"><span class="linenos">448</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">I</span> <span class="o">*</span> <span class="n">cix</span>
</span><span id="SliceFinder.get_pair_candidates-449"><a href="#SliceFinder.get_pair_candidates-449"><span class="linenos">449</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-450"><a href="#SliceFinder.get_pair_candidates-450"><span class="linenos">450</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="p">[</span><span class="n">cix</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-451"><a href="#SliceFinder.get_pair_candidates-451"><span class="linenos">451</span></a>        <span class="n">cix</span> <span class="o">=</span> <span class="n">cix</span><span class="o">-</span><span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-452"><a href="#SliceFinder.get_pair_candidates-452"><span class="linenos">452</span></a>        
</span><span id="SliceFinder.get_pair_candidates-453"><a href="#SliceFinder.get_pair_candidates-453"><span class="linenos">453</span></a>        <span class="c1">#if there are new slices</span>
</span><span id="SliceFinder.get_pair_candidates-454"><a href="#SliceFinder.get_pair_candidates-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rix</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder.get_pair_candidates-455"><a href="#SliceFinder.get_pair_candidates-455"><span class="linenos">455</span></a>            
</span><span id="SliceFinder.get_pair_candidates-456"><a href="#SliceFinder.get_pair_candidates-456"><span class="linenos">456</span></a>            <span class="c1">#get parents</span>
</span><span id="SliceFinder.get_pair_candidates-457"><a href="#SliceFinder.get_pair_candidates-457"><span class="linenos">457</span></a>            <span class="n">P1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">rix</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder.get_pair_candidates-458"><a href="#SliceFinder.get_pair_candidates-458"><span class="linenos">458</span></a>            <span class="n">P2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">cix</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder.get_pair_candidates-459"><a href="#SliceFinder.get_pair_candidates-459"><span class="linenos">459</span></a>            
</span><span id="SliceFinder.get_pair_candidates-460"><a href="#SliceFinder.get_pair_candidates-460"><span class="linenos">460</span></a>            <span class="c1">#form new slices</span>
</span><span id="SliceFinder.get_pair_candidates-461"><a href="#SliceFinder.get_pair_candidates-461"><span class="linenos">461</span></a>            <span class="n">newSlices</span> <span class="o">=</span> <span class="n">P1</span> <span class="o">+</span> <span class="n">P2</span>
</span><span id="SliceFinder.get_pair_candidates-462"><a href="#SliceFinder.get_pair_candidates-462"><span class="linenos">462</span></a>            <span class="n">P</span> <span class="o">=</span> <span class="p">(((</span><span class="n">P1</span> <span class="o">@</span> <span class="n">S</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">P2</span> <span class="o">@</span> <span class="n">S</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-463"><a href="#SliceFinder.get_pair_candidates-463"><span class="linenos">463</span></a>                 
</span><span id="SliceFinder.get_pair_candidates-464"><a href="#SliceFinder.get_pair_candidates-464"><span class="linenos">464</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder.get_pair_candidates-465"><a href="#SliceFinder.get_pair_candidates-465"><span class="linenos">465</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error, ran out of valid slices&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-466"><a href="#SliceFinder.get_pair_candidates-466"><span class="linenos">466</span></a>            <span class="n">exit</span><span class="p">()</span>
</span><span id="SliceFinder.get_pair_candidates-467"><a href="#SliceFinder.get_pair_candidates-467"><span class="linenos">467</span></a>
</span><span id="SliceFinder.get_pair_candidates-468"><a href="#SliceFinder.get_pair_candidates-468"><span class="linenos">468</span></a>        
</span><span id="SliceFinder.get_pair_candidates-469"><a href="#SliceFinder.get_pair_candidates-469"><span class="linenos">469</span></a>        <span class="c1">#extract new slice sizes and errors as minimum of parents (with parent handling)</span>
</span><span id="SliceFinder.get_pair_candidates-470"><a href="#SliceFinder.get_pair_candidates-470"><span class="linenos">470</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="SliceFinder.get_pair_candidates-471"><a href="#SliceFinder.get_pair_candidates-471"><span class="linenos">471</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="SliceFinder.get_pair_candidates-472"><a href="#SliceFinder.get_pair_candidates-472"><span class="linenos">472</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">P1</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">R</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">])</span>
</span><span id="SliceFinder.get_pair_candidates-473"><a href="#SliceFinder.get_pair_candidates-473"><span class="linenos">473</span></a>
</span><span id="SliceFinder.get_pair_candidates-474"><a href="#SliceFinder.get_pair_candidates-474"><span class="linenos">474</span></a>
</span><span id="SliceFinder.get_pair_candidates-475"><a href="#SliceFinder.get_pair_candidates-475"><span class="linenos">475</span></a>
</span><span id="SliceFinder.get_pair_candidates-476"><a href="#SliceFinder.get_pair_candidates-476"><span class="linenos">476</span></a>        <span class="c1">#discard invalid slices with multiple assignments per feature using indicator I</span>
</span><span id="SliceFinder.get_pair_candidates-477"><a href="#SliceFinder.get_pair_candidates-477"><span class="linenos">477</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-478"><a href="#SliceFinder.get_pair_candidates-478"><span class="linenos">478</span></a>
</span><span id="SliceFinder.get_pair_candidates-479"><a href="#SliceFinder.get_pair_candidates-479"><span class="linenos">479</span></a>        <span class="c1">#with each expanded feature (from beg-end)</span>
</span><span id="SliceFinder.get_pair_candidates-480"><a href="#SliceFinder.get_pair_candidates-480"><span class="linenos">480</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder.get_pair_candidates-481"><a href="#SliceFinder.get_pair_candidates-481"><span class="linenos">481</span></a>            <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-482"><a href="#SliceFinder.get_pair_candidates-482"><span class="linenos">482</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-483"><a href="#SliceFinder.get_pair_candidates-483"><span class="linenos">483</span></a>            
</span><span id="SliceFinder.get_pair_candidates-484"><a href="#SliceFinder.get_pair_candidates-484"><span class="linenos">484</span></a>            <span class="c1">#make sure it only has 1 domain value assigned to it</span>
</span><span id="SliceFinder.get_pair_candidates-485"><a href="#SliceFinder.get_pair_candidates-485"><span class="linenos">485</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-486"><a href="#SliceFinder.get_pair_candidates-486"><span class="linenos">486</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">rowsums</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-487"><a href="#SliceFinder.get_pair_candidates-487"><span class="linenos">487</span></a>
</span><span id="SliceFinder.get_pair_candidates-488"><a href="#SliceFinder.get_pair_candidates-488"><span class="linenos">488</span></a>            <span class="c1">#update mask to exclude features with more than one value</span>
</span><span id="SliceFinder.get_pair_candidates-489"><a href="#SliceFinder.get_pair_candidates-489"><span class="linenos">489</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">&amp;</span> <span class="n">rowsums</span>
</span><span id="SliceFinder.get_pair_candidates-490"><a href="#SliceFinder.get_pair_candidates-490"><span class="linenos">490</span></a>
</span><span id="SliceFinder.get_pair_candidates-491"><a href="#SliceFinder.get_pair_candidates-491"><span class="linenos">491</span></a>
</span><span id="SliceFinder.get_pair_candidates-492"><a href="#SliceFinder.get_pair_candidates-492"><span class="linenos">492</span></a>        <span class="c1">#prune slices with more than one assignment per feature</span>
</span><span id="SliceFinder.get_pair_candidates-493"><a href="#SliceFinder.get_pair_candidates-493"><span class="linenos">493</span></a>        <span class="n">newSlices</span> <span class="o">=</span> <span class="n">newSlices</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-494"><a href="#SliceFinder.get_pair_candidates-494"><span class="linenos">494</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-495"><a href="#SliceFinder.get_pair_candidates-495"><span class="linenos">495</span></a>        <span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-496"><a href="#SliceFinder.get_pair_candidates-496"><span class="linenos">496</span></a>        <span class="n">se</span> <span class="o">=</span> <span class="n">se</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-497"><a href="#SliceFinder.get_pair_candidates-497"><span class="linenos">497</span></a>        <span class="n">sm</span> <span class="o">=</span> <span class="n">sm</span><span class="p">[</span><span class="n">I</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-498"><a href="#SliceFinder.get_pair_candidates-498"><span class="linenos">498</span></a>
</span><span id="SliceFinder.get_pair_candidates-499"><a href="#SliceFinder.get_pair_candidates-499"><span class="linenos">499</span></a>
</span><span id="SliceFinder.get_pair_candidates-500"><a href="#SliceFinder.get_pair_candidates-500"><span class="linenos">500</span></a>
</span><span id="SliceFinder.get_pair_candidates-501"><a href="#SliceFinder.get_pair_candidates-501"><span class="linenos">501</span></a>        <span class="c1">#deduplication </span>
</span><span id="SliceFinder.get_pair_candidates-502"><a href="#SliceFinder.get_pair_candidates-502"><span class="linenos">502</span></a>        <span class="n">dom</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-</span><span class="n">fb</span><span class="o">+</span><span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-503"><a href="#SliceFinder.get_pair_candidates-503"><span class="linenos">503</span></a>        <span class="c1">#unique ids for each slice are the sum of weighted feature contributions.  Makes it so slices map to same ID if they have same features</span>
</span><span id="SliceFinder.get_pair_candidates-504"><a href="#SliceFinder.get_pair_candidates-504"><span class="linenos">504</span></a>        <span class="n">ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-505"><a href="#SliceFinder.get_pair_candidates-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SliceFinder.get_pair_candidates-506"><a href="#SliceFinder.get_pair_candidates-506"><span class="linenos">506</span></a>            <span class="n">beg</span> <span class="o">=</span> <span class="n">fb</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-507"><a href="#SliceFinder.get_pair_candidates-507"><span class="linenos">507</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">fe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-508"><a href="#SliceFinder.get_pair_candidates-508"><span class="linenos">508</span></a>            
</span><span id="SliceFinder.get_pair_candidates-509"><a href="#SliceFinder.get_pair_candidates-509"><span class="linenos">509</span></a>            <span class="n">max_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-510"><a href="#SliceFinder.get_pair_candidates-510"><span class="linenos">510</span></a>            <span class="n">rowsums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-511"><a href="#SliceFinder.get_pair_candidates-511"><span class="linenos">511</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">max_col</span> <span class="o">*</span> <span class="n">rowsums</span>
</span><span id="SliceFinder.get_pair_candidates-512"><a href="#SliceFinder.get_pair_candidates-512"><span class="linenos">512</span></a>
</span><span id="SliceFinder.get_pair_candidates-513"><a href="#SliceFinder.get_pair_candidates-513"><span class="linenos">513</span></a>            <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SliceFinder.get_pair_candidates-514"><a href="#SliceFinder.get_pair_candidates-514"><span class="linenos">514</span></a>            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">dom</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="SliceFinder.get_pair_candidates-515"><a href="#SliceFinder.get_pair_candidates-515"><span class="linenos">515</span></a>                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">dom</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="SliceFinder.get_pair_candidates-516"><a href="#SliceFinder.get_pair_candidates-516"><span class="linenos">516</span></a>            
</span><span id="SliceFinder.get_pair_candidates-517"><a href="#SliceFinder.get_pair_candidates-517"><span class="linenos">517</span></a>            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-518"><a href="#SliceFinder.get_pair_candidates-518"><span class="linenos">518</span></a>            <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-519"><a href="#SliceFinder.get_pair_candidates-519"><span class="linenos">519</span></a>
</span><span id="SliceFinder.get_pair_candidates-520"><a href="#SliceFinder.get_pair_candidates-520"><span class="linenos">520</span></a>            <span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span> <span class="o">+</span> <span class="n">I</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="SliceFinder.get_pair_candidates-521"><a href="#SliceFinder.get_pair_candidates-521"><span class="linenos">521</span></a>    
</span><span id="SliceFinder.get_pair_candidates-522"><a href="#SliceFinder.get_pair_candidates-522"><span class="linenos">522</span></a>
</span><span id="SliceFinder.get_pair_candidates-523"><a href="#SliceFinder.get_pair_candidates-523"><span class="linenos">523</span></a>        <span class="c1">#map cotains deduplication pruning mask</span>
</span><span id="SliceFinder.get_pair_candidates-524"><a href="#SliceFinder.get_pair_candidates-524"><span class="linenos">524</span></a>        <span class="nb">map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ID</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span id="SliceFinder.get_pair_candidates-525"><a href="#SliceFinder.get_pair_candidates-525"><span class="linenos">525</span></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-526"><a href="#SliceFinder.get_pair_candidates-526"><span class="linenos">526</span></a>        
</span><span id="SliceFinder.get_pair_candidates-527"><a href="#SliceFinder.get_pair_candidates-527"><span class="linenos">527</span></a>        <span class="c1">#size pruning by upper bounding sizes</span>
</span><span id="SliceFinder.get_pair_candidates-528"><a href="#SliceFinder.get_pair_candidates-528"><span class="linenos">528</span></a>        <span class="n">ub_sizes</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">ex</span> <span class="o">@</span> <span class="n">ss</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-529"><a href="#SliceFinder.get_pair_candidates-529"><span class="linenos">529</span></a>        <span class="n">ub_sizes</span><span class="p">[</span><span class="n">ub_sizes</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SliceFinder.get_pair_candidates-530"><a href="#SliceFinder.get_pair_candidates-530"><span class="linenos">530</span></a>        <span class="n">f_sizes</span> <span class="o">=</span> <span class="n">ub_sizes</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
</span><span id="SliceFinder.get_pair_candidates-531"><a href="#SliceFinder.get_pair_candidates-531"><span class="linenos">531</span></a>        
</span><span id="SliceFinder.get_pair_candidates-532"><a href="#SliceFinder.get_pair_candidates-532"><span class="linenos">532</span></a>        
</span><span id="SliceFinder.get_pair_candidates-533"><a href="#SliceFinder.get_pair_candidates-533"><span class="linenos">533</span></a>        <span class="c1">#error pruning mask</span>
</span><span id="SliceFinder.get_pair_candidates-534"><a href="#SliceFinder.get_pair_candidates-534"><span class="linenos">534</span></a>        <span class="n">ub_error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">ex</span> <span class="o">@</span> <span class="n">se</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="SliceFinder.get_pair_candidates-535"><a href="#SliceFinder.get_pair_candidates-535"><span class="linenos">535</span></a>        <span class="n">ub_error</span><span class="p">[</span><span class="n">ub_error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SliceFinder.get_pair_candidates-536"><a href="#SliceFinder.get_pair_candidates-536"><span class="linenos">536</span></a>        <span class="n">ub_max_error</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span> <span class="p">(</span><span class="n">ex</span> <span class="o">@</span> <span class="n">sm</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-537"><a href="#SliceFinder.get_pair_candidates-537"><span class="linenos">537</span></a>        <span class="n">ub_max_error</span><span class="p">[</span><span class="n">ub_max_error</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="SliceFinder.get_pair_candidates-538"><a href="#SliceFinder.get_pair_candidates-538"><span class="linenos">538</span></a>
</span><span id="SliceFinder.get_pair_candidates-539"><a href="#SliceFinder.get_pair_candidates-539"><span class="linenos">539</span></a>
</span><span id="SliceFinder.get_pair_candidates-540"><a href="#SliceFinder.get_pair_candidates-540"><span class="linenos">540</span></a>        <span class="c1">#score pruning mask</span>
</span><span id="SliceFinder.get_pair_candidates-541"><a href="#SliceFinder.get_pair_candidates-541"><span class="linenos">541</span></a>        <span class="n">ub_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperbound_score</span><span class="p">(</span><span class="n">ub_sizes</span><span class="p">,</span> <span class="n">ub_error</span><span class="p">,</span> <span class="n">ub_max_error</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-542"><a href="#SliceFinder.get_pair_candidates-542"><span class="linenos">542</span></a>        <span class="n">TMP3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_topK</span><span class="p">(</span><span class="n">TKC</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-543"><a href="#SliceFinder.get_pair_candidates-543"><span class="linenos">543</span></a>        <span class="n">minsc</span> <span class="o">=</span> <span class="n">TMP3</span><span class="p">[</span><span class="s2">&quot;minScore&quot;</span><span class="p">]</span>
</span><span id="SliceFinder.get_pair_candidates-544"><a href="#SliceFinder.get_pair_candidates-544"><span class="linenos">544</span></a>        <span class="n">fScores</span> <span class="o">=</span> <span class="p">(</span><span class="n">ub_scores</span> <span class="o">&gt;</span> <span class="n">minsc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub_scores</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-545"><a href="#SliceFinder.get_pair_candidates-545"><span class="linenos">545</span></a>        
</span><span id="SliceFinder.get_pair_candidates-546"><a href="#SliceFinder.get_pair_candidates-546"><span class="linenos">546</span></a>        
</span><span id="SliceFinder.get_pair_candidates-547"><a href="#SliceFinder.get_pair_candidates-547"><span class="linenos">547</span></a>        <span class="c1">#missing parents pruning mask</span>
</span><span id="SliceFinder.get_pair_candidates-548"><a href="#SliceFinder.get_pair_candidates-548"><span class="linenos">548</span></a>        <span class="n">sparse_map</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-549"><a href="#SliceFinder.get_pair_candidates-549"><span class="linenos">549</span></a>        <span class="n">sparse_slices</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">newSlices</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-550"><a href="#SliceFinder.get_pair_candidates-550"><span class="linenos">550</span></a>        <span class="n">result_sparse</span> <span class="o">=</span> <span class="n">sparse_map</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sparse_slices</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-551"><a href="#SliceFinder.get_pair_candidates-551"><span class="linenos">551</span></a>        <span class="n">num_parents</span> <span class="o">=</span> <span class="n">result_sparse</span><span class="o">.</span><span class="n">nnz</span>
</span><span id="SliceFinder.get_pair_candidates-552"><a href="#SliceFinder.get_pair_candidates-552"><span class="linenos">552</span></a>        <span class="n">f_parents</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_parents</span> <span class="o">==</span> <span class="n">L</span><span class="p">)</span>
</span><span id="SliceFinder.get_pair_candidates-553"><a href="#SliceFinder.get_pair_candidates-553"><span class="linenos">553</span></a>
</span><span id="SliceFinder.get_pair_candidates-554"><a href="#SliceFinder.get_pair_candidates-554"><span class="linenos">554</span></a>        <span class="c1">#combine all pruning masks</span>
</span><span id="SliceFinder.get_pair_candidates-555"><a href="#SliceFinder.get_pair_candidates-555"><span class="linenos">555</span></a>        <span class="nb">map</span> <span class="o">=</span> <span class="nb">map</span> <span class="o">*</span> <span class="p">(</span><span class="n">f_sizes</span> <span class="o">&amp;</span> <span class="n">fScores</span> <span class="o">&amp;</span> <span class="n">f_parents</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SliceFinder.get_pair_candidates-556"><a href="#SliceFinder.get_pair_candidates-556"><span class="linenos">556</span></a>
</span><span id="SliceFinder.get_pair_candidates-557"><a href="#SliceFinder.get_pair_candidates-557"><span class="linenos">557</span></a>
</span><span id="SliceFinder.get_pair_candidates-558"><a href="#SliceFinder.get_pair_candidates-558"><span class="linenos">558</span></a>        <span class="c1">#apply masks</span>
</span><span id="SliceFinder.get_pair_candidates-559"><a href="#SliceFinder.get_pair_candidates-559"><span class="linenos">559</span></a>        <span class="n">dedup</span> <span class="o">=</span> <span class="nb">map</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,:]</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="SliceFinder.get_pair_candidates-560"><a href="#SliceFinder.get_pair_candidates-560"><span class="linenos">560</span></a>        <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">dedup</span> <span class="o">@</span> <span class="n">P</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="SliceFinder.get_pair_candidates-561"><a href="#SliceFinder.get_pair_candidates-561"><span class="linenos">561</span></a>
</span><span id="SliceFinder.get_pair_candidates-562"><a href="#SliceFinder.get_pair_candidates-562"><span class="linenos">562</span></a>        <span class="k">return</span> <span class="n">P</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Form a set of valid L-predicate slices using the given L-1 predicate slices <code>S</code>.</p>

<pre><code>1. Form every combination of slices from level L-1.
2. Prune those without L-2 overlap.
3. Form row and column index pairs of valid combinations.
4. Get parents using row, column index pairs.
5. Form new slices.
6. Prune slices that assign more than one value to a feature.
7. Extract size and error for new slices as the minimum of their parents.
8. Perform deduplication using unique IDs.
9. Upper bound the scoring function and prune new slices.
</code></pre>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>S</strong>:<br />
Slices from level L-1.</p></li>
<li><p><strong>R</strong>:<br />
Statistics for those slices.</p></li>
<li><p><strong>TKC</strong>:<br />
Top-k slice statistics.</p></li>
<li><p><strong>L</strong>:<br />
Current level of slices.</p></li>
<li><p><strong>fb</strong>:<br />
Feature beginnings.</p></li>
<li><p><strong>fe</strong>:<br />
Feature endings.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>- P: A set of valid pair candidates.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.analyze_topK" class="classattr">
                                        <input id="SliceFinder.analyze_topK-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">analyze_topK</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">TKC</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.analyze_topK-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.analyze_topK"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.analyze_topK-566"><a href="#SliceFinder.analyze_topK-566"><span class="linenos">566</span></a>    <span class="k">def</span> <span class="nf">analyze_topK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TKC</span><span class="p">):</span>
</span><span id="SliceFinder.analyze_topK-567"><a href="#SliceFinder.analyze_topK-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.analyze_topK-568"><a href="#SliceFinder.analyze_topK-568"><span class="linenos">568</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.analyze_topK-569"><a href="#SliceFinder.analyze_topK-569"><span class="linenos">569</span></a><span class="sd">            Find the minimum and maximum score in the current top-k set `TKC`.</span>
</span><span id="SliceFinder.analyze_topK-570"><a href="#SliceFinder.analyze_topK-570"><span class="linenos">570</span></a><span class="sd">        </span>
</span><span id="SliceFinder.analyze_topK-571"><a href="#SliceFinder.analyze_topK-571"><span class="linenos">571</span></a><span class="sd">        :param TKC: </span>
</span><span id="SliceFinder.analyze_topK-572"><a href="#SliceFinder.analyze_topK-572"><span class="linenos">572</span></a><span class="sd">            A k x 4 matrix of statistics for the current slices.</span>
</span><span id="SliceFinder.analyze_topK-573"><a href="#SliceFinder.analyze_topK-573"><span class="linenos">573</span></a><span class="sd">        </span>
</span><span id="SliceFinder.analyze_topK-574"><a href="#SliceFinder.analyze_topK-574"><span class="linenos">574</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.analyze_topK-575"><a href="#SliceFinder.analyze_topK-575"><span class="linenos">575</span></a><span class="sd">            A dictionary containing:</span>
</span><span id="SliceFinder.analyze_topK-576"><a href="#SliceFinder.analyze_topK-576"><span class="linenos">576</span></a><span class="sd">            - `&quot;maxScore&quot;`: The maximum score (float).</span>
</span><span id="SliceFinder.analyze_topK-577"><a href="#SliceFinder.analyze_topK-577"><span class="linenos">577</span></a><span class="sd">            - `&quot;minScore&quot;`: The minimum score (float).</span>
</span><span id="SliceFinder.analyze_topK-578"><a href="#SliceFinder.analyze_topK-578"><span class="linenos">578</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.analyze_topK-579"><a href="#SliceFinder.analyze_topK-579"><span class="linenos">579</span></a>        <span class="n">maxScore</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="SliceFinder.analyze_topK-580"><a href="#SliceFinder.analyze_topK-580"><span class="linenos">580</span></a>        <span class="n">minScore</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</span><span id="SliceFinder.analyze_topK-581"><a href="#SliceFinder.analyze_topK-581"><span class="linenos">581</span></a>        
</span><span id="SliceFinder.analyze_topK-582"><a href="#SliceFinder.analyze_topK-582"><span class="linenos">582</span></a>        <span class="k">if</span> <span class="n">TKC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder.analyze_topK-583"><a href="#SliceFinder.analyze_topK-583"><span class="linenos">583</span></a>            <span class="n">maxScore</span> <span class="o">=</span> <span class="n">TKC</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SliceFinder.analyze_topK-584"><a href="#SliceFinder.analyze_topK-584"><span class="linenos">584</span></a>            <span class="n">minScore</span> <span class="o">=</span> <span class="n">TKC</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">TKC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SliceFinder.analyze_topK-585"><a href="#SliceFinder.analyze_topK-585"><span class="linenos">585</span></a>            
</span><span id="SliceFinder.analyze_topK-586"><a href="#SliceFinder.analyze_topK-586"><span class="linenos">586</span></a>
</span><span id="SliceFinder.analyze_topK-587"><a href="#SliceFinder.analyze_topK-587"><span class="linenos">587</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;maxScore&quot;</span> <span class="p">:</span> <span class="n">maxScore</span><span class="p">,</span> <span class="s2">&quot;minScore&quot;</span> <span class="p">:</span> <span class="n">minScore</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Find the minimum and maximum score in the current top-k set <code>TKC</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>TKC</strong>:<br />
A k x 4 matrix of statistics for the current slices.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>A dictionary containing:
- `"maxScore"`: The maximum score (float).
- `"minScore"`: The minimum score (float).
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.score" class="classattr">
                                        <input id="SliceFinder.score-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">score</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">slice_sizes</span>, </span><span class="param"><span class="n">slice_errors</span>, </span><span class="param"><span class="n">total_samples</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.score-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.score"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.score-593"><a href="#SliceFinder.score-593"><span class="linenos">593</span></a>    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_sizes</span><span class="p">,</span> <span class="n">slice_errors</span><span class="p">,</span> <span class="n">total_samples</span><span class="p">):</span>
</span><span id="SliceFinder.score-594"><a href="#SliceFinder.score-594"><span class="linenos">594</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.score-595"><a href="#SliceFinder.score-595"><span class="linenos">595</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.score-596"><a href="#SliceFinder.score-596"><span class="linenos">596</span></a><span class="sd">            Apply the SliceLines scoring function. If division by zero occurs, return `-inf`.</span>
</span><span id="SliceFinder.score-597"><a href="#SliceFinder.score-597"><span class="linenos">597</span></a><span class="sd">        </span>
</span><span id="SliceFinder.score-598"><a href="#SliceFinder.score-598"><span class="linenos">598</span></a><span class="sd">        :param sliceSizes: </span>
</span><span id="SliceFinder.score-599"><a href="#SliceFinder.score-599"><span class="linenos">599</span></a><span class="sd">            Vector of sizes for each slice.</span>
</span><span id="SliceFinder.score-600"><a href="#SliceFinder.score-600"><span class="linenos">600</span></a><span class="sd">        </span>
</span><span id="SliceFinder.score-601"><a href="#SliceFinder.score-601"><span class="linenos">601</span></a><span class="sd">        :param sliceErrors: </span>
</span><span id="SliceFinder.score-602"><a href="#SliceFinder.score-602"><span class="linenos">602</span></a><span class="sd">            Vector of errors for each slice.</span>
</span><span id="SliceFinder.score-603"><a href="#SliceFinder.score-603"><span class="linenos">603</span></a><span class="sd">        </span>
</span><span id="SliceFinder.score-604"><a href="#SliceFinder.score-604"><span class="linenos">604</span></a><span class="sd">        :param nrows: </span>
</span><span id="SliceFinder.score-605"><a href="#SliceFinder.score-605"><span class="linenos">605</span></a><span class="sd">            Number of samples in the entire dataset.</span>
</span><span id="SliceFinder.score-606"><a href="#SliceFinder.score-606"><span class="linenos">606</span></a><span class="sd">        </span>
</span><span id="SliceFinder.score-607"><a href="#SliceFinder.score-607"><span class="linenos">607</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.score-608"><a href="#SliceFinder.score-608"><span class="linenos">608</span></a><span class="sd">            The computed scores for each slice, with `-inf` for cases where division by zero occurs.</span>
</span><span id="SliceFinder.score-609"><a href="#SliceFinder.score-609"><span class="linenos">609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.score-610"><a href="#SliceFinder.score-610"><span class="linenos">610</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">((</span><span class="n">slice_errors</span><span class="o">/</span><span class="n">slice_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgError</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">total_samples</span><span class="o">/</span><span class="n">slice_sizes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.score-611"><a href="#SliceFinder.score-611"><span class="linenos">611</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">nan</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Apply the SliceLines scoring function. If division by zero occurs, return <code>-inf</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>sliceSizes</strong>:<br />
Vector of sizes for each slice.</p></li>
<li><p><strong>sliceErrors</strong>:<br />
Vector of errors for each slice.</p></li>
<li><p><strong>nrows</strong>:<br />
Number of samples in the entire dataset.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>The computed scores for each slice, with `-inf` for cases where division by zero occurs.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.upperbound_score" class="classattr">
                                        <input id="SliceFinder.upperbound_score-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">upperbound_score</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ss</span>, </span><span class="param"><span class="n">se</span>, </span><span class="param"><span class="n">sm</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.upperbound_score-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.upperbound_score"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.upperbound_score-615"><a href="#SliceFinder.upperbound_score-615"><span class="linenos">615</span></a>    <span class="k">def</span> <span class="nf">upperbound_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">sm</span><span class="p">):</span>
</span><span id="SliceFinder.upperbound_score-616"><a href="#SliceFinder.upperbound_score-616"><span class="linenos">616</span></a>
</span><span id="SliceFinder.upperbound_score-617"><a href="#SliceFinder.upperbound_score-617"><span class="linenos">617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.upperbound_score-618"><a href="#SliceFinder.upperbound_score-618"><span class="linenos">618</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.upperbound_score-619"><a href="#SliceFinder.upperbound_score-619"><span class="linenos">619</span></a><span class="sd">            Compute an upper bound for the SliceLines scoring function.</span>
</span><span id="SliceFinder.upperbound_score-620"><a href="#SliceFinder.upperbound_score-620"><span class="linenos">620</span></a><span class="sd">        </span>
</span><span id="SliceFinder.upperbound_score-621"><a href="#SliceFinder.upperbound_score-621"><span class="linenos">621</span></a><span class="sd">        :param ss: </span>
</span><span id="SliceFinder.upperbound_score-622"><a href="#SliceFinder.upperbound_score-622"><span class="linenos">622</span></a><span class="sd">            Vector containing the size of each slice.</span>
</span><span id="SliceFinder.upperbound_score-623"><a href="#SliceFinder.upperbound_score-623"><span class="linenos">623</span></a><span class="sd">        </span>
</span><span id="SliceFinder.upperbound_score-624"><a href="#SliceFinder.upperbound_score-624"><span class="linenos">624</span></a><span class="sd">        :param se: </span>
</span><span id="SliceFinder.upperbound_score-625"><a href="#SliceFinder.upperbound_score-625"><span class="linenos">625</span></a><span class="sd">            Vector containing the error for each slice.</span>
</span><span id="SliceFinder.upperbound_score-626"><a href="#SliceFinder.upperbound_score-626"><span class="linenos">626</span></a><span class="sd">        </span>
</span><span id="SliceFinder.upperbound_score-627"><a href="#SliceFinder.upperbound_score-627"><span class="linenos">627</span></a><span class="sd">        :param sm: </span>
</span><span id="SliceFinder.upperbound_score-628"><a href="#SliceFinder.upperbound_score-628"><span class="linenos">628</span></a><span class="sd">            Vector containing the maximum error for each slice.</span>
</span><span id="SliceFinder.upperbound_score-629"><a href="#SliceFinder.upperbound_score-629"><span class="linenos">629</span></a><span class="sd">        </span>
</span><span id="SliceFinder.upperbound_score-630"><a href="#SliceFinder.upperbound_score-630"><span class="linenos">630</span></a>
</span><span id="SliceFinder.upperbound_score-631"><a href="#SliceFinder.upperbound_score-631"><span class="linenos">631</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.upperbound_score-632"><a href="#SliceFinder.upperbound_score-632"><span class="linenos">632</span></a><span class="sd">            The computed upper bound for the SliceLines scoring function.</span>
</span><span id="SliceFinder.upperbound_score-633"><a href="#SliceFinder.upperbound_score-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.upperbound_score-634"><a href="#SliceFinder.upperbound_score-634"><span class="linenos">634</span></a>        <span class="c1"># probe interesting points of sc in the interval [minSup, ss],</span>
</span><span id="SliceFinder.upperbound_score-635"><a href="#SliceFinder.upperbound_score-635"><span class="linenos">635</span></a>        <span class="c1"># and compute the maximum to serve as the upper bound </span>
</span><span id="SliceFinder.upperbound_score-636"><a href="#SliceFinder.upperbound_score-636"><span class="linenos">636</span></a>        
</span><span id="SliceFinder.upperbound_score-637"><a href="#SliceFinder.upperbound_score-637"><span class="linenos">637</span></a>        <span class="c1">#s is the critical points we have to check</span>
</span><span id="SliceFinder.upperbound_score-638"><a href="#SliceFinder.upperbound_score-638"><span class="linenos">638</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">ss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">se</span><span class="o">/</span><span class="n">sm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">),</span> <span class="n">ss</span><span class="p">))</span>
</span><span id="SliceFinder.upperbound_score-639"><a href="#SliceFinder.upperbound_score-639"><span class="linenos">639</span></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>
</span><span id="SliceFinder.upperbound_score-640"><a href="#SliceFinder.upperbound_score-640"><span class="linenos">640</span></a>        <span class="n">smex</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">sm</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">sm</span><span class="p">))</span>
</span><span id="SliceFinder.upperbound_score-641"><a href="#SliceFinder.upperbound_score-641"><span class="linenos">641</span></a>        <span class="n">seex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">se</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">se</span><span class="p">))</span>
</span><span id="SliceFinder.upperbound_score-642"><a href="#SliceFinder.upperbound_score-642"><span class="linenos">642</span></a>        <span class="n">pmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">smex</span><span class="p">,</span> <span class="n">seex</span><span class="p">)</span>
</span><span id="SliceFinder.upperbound_score-643"><a href="#SliceFinder.upperbound_score-643"><span class="linenos">643</span></a>
</span><span id="SliceFinder.upperbound_score-644"><a href="#SliceFinder.upperbound_score-644"><span class="linenos">644</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">((</span><span class="n">pmin</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_error</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">s</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SliceFinder.upperbound_score-645"><a href="#SliceFinder.upperbound_score-645"><span class="linenos">645</span></a>        <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">nan</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="SliceFinder.upperbound_score-646"><a href="#SliceFinder.upperbound_score-646"><span class="linenos">646</span></a>        
</span><span id="SliceFinder.upperbound_score-647"><a href="#SliceFinder.upperbound_score-647"><span class="linenos">647</span></a>        
</span><span id="SliceFinder.upperbound_score-648"><a href="#SliceFinder.upperbound_score-648"><span class="linenos">648</span></a>        <span class="k">return</span> <span class="n">sc</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Compute an upper bound for the SliceLines scoring function.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>ss</strong>:<br />
Vector containing the size of each slice.</p></li>
<li><p><strong>se</strong>:<br />
Vector containing the error for each slice.</p></li>
<li><p><strong>sm</strong>:<br />
Vector containing the maximum error for each slice.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>The computed upper bound for the SliceLines scoring function.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.maintainTopK" class="classattr">
                                        <input id="SliceFinder.maintainTopK-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">maintainTopK</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">S</span>, </span><span class="param"><span class="n">R</span>, </span><span class="param"><span class="n">TK</span>, </span><span class="param"><span class="n">TKC</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.maintainTopK-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.maintainTopK"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.maintainTopK-651"><a href="#SliceFinder.maintainTopK-651"><span class="linenos">651</span></a>    <span class="k">def</span> <span class="nf">maintainTopK</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span><span class="p">):</span>
</span><span id="SliceFinder.maintainTopK-652"><a href="#SliceFinder.maintainTopK-652"><span class="linenos">652</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.maintainTopK-653"><a href="#SliceFinder.maintainTopK-653"><span class="linenos">653</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.maintainTopK-654"><a href="#SliceFinder.maintainTopK-654"><span class="linenos">654</span></a><span class="sd">            Update the top-k slices and their statistics given the new slices `S` and statistics `R`.</span>
</span><span id="SliceFinder.maintainTopK-655"><a href="#SliceFinder.maintainTopK-655"><span class="linenos">655</span></a><span class="sd">        </span>
</span><span id="SliceFinder.maintainTopK-656"><a href="#SliceFinder.maintainTopK-656"><span class="linenos">656</span></a><span class="sd">        :param S: </span>
</span><span id="SliceFinder.maintainTopK-657"><a href="#SliceFinder.maintainTopK-657"><span class="linenos">657</span></a><span class="sd">            New slices to be considered for updating the top-k.</span>
</span><span id="SliceFinder.maintainTopK-658"><a href="#SliceFinder.maintainTopK-658"><span class="linenos">658</span></a><span class="sd">        </span>
</span><span id="SliceFinder.maintainTopK-659"><a href="#SliceFinder.maintainTopK-659"><span class="linenos">659</span></a><span class="sd">        :param R: </span>
</span><span id="SliceFinder.maintainTopK-660"><a href="#SliceFinder.maintainTopK-660"><span class="linenos">660</span></a><span class="sd">            New statistics corresponding to the new slices `S`.</span>
</span><span id="SliceFinder.maintainTopK-661"><a href="#SliceFinder.maintainTopK-661"><span class="linenos">661</span></a><span class="sd">        </span>
</span><span id="SliceFinder.maintainTopK-662"><a href="#SliceFinder.maintainTopK-662"><span class="linenos">662</span></a><span class="sd">        :param TK: </span>
</span><span id="SliceFinder.maintainTopK-663"><a href="#SliceFinder.maintainTopK-663"><span class="linenos">663</span></a><span class="sd">            Current top-k slices that will be updated.</span>
</span><span id="SliceFinder.maintainTopK-664"><a href="#SliceFinder.maintainTopK-664"><span class="linenos">664</span></a><span class="sd">        </span>
</span><span id="SliceFinder.maintainTopK-665"><a href="#SliceFinder.maintainTopK-665"><span class="linenos">665</span></a><span class="sd">        :param TKC: </span>
</span><span id="SliceFinder.maintainTopK-666"><a href="#SliceFinder.maintainTopK-666"><span class="linenos">666</span></a><span class="sd">            Current top-k statistics that will be updated.</span>
</span><span id="SliceFinder.maintainTopK-667"><a href="#SliceFinder.maintainTopK-667"><span class="linenos">667</span></a><span class="sd">        </span>
</span><span id="SliceFinder.maintainTopK-668"><a href="#SliceFinder.maintainTopK-668"><span class="linenos">668</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.maintainTopK-669"><a href="#SliceFinder.maintainTopK-669"><span class="linenos">669</span></a><span class="sd">            - `TK`: Updated top-k slices.</span>
</span><span id="SliceFinder.maintainTopK-670"><a href="#SliceFinder.maintainTopK-670"><span class="linenos">670</span></a><span class="sd">            - `TKC`: Updated top-k statistics.</span>
</span><span id="SliceFinder.maintainTopK-671"><a href="#SliceFinder.maintainTopK-671"><span class="linenos">671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.maintainTopK-672"><a href="#SliceFinder.maintainTopK-672"><span class="linenos">672</span></a>        
</span><span id="SliceFinder.maintainTopK-673"><a href="#SliceFinder.maintainTopK-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Maintain topk:&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.maintainTopK-674"><a href="#SliceFinder.maintainTopK-674"><span class="linenos">674</span></a>        <span class="n">top_k_indicies</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SliceFinder.maintainTopK-675"><a href="#SliceFinder.maintainTopK-675"><span class="linenos">675</span></a>        
</span><span id="SliceFinder.maintainTopK-676"><a href="#SliceFinder.maintainTopK-676"><span class="linenos">676</span></a>
</span><span id="SliceFinder.maintainTopK-677"><a href="#SliceFinder.maintainTopK-677"><span class="linenos">677</span></a>        <span class="c1">#prune on size and score</span>
</span><span id="SliceFinder.maintainTopK-678"><a href="#SliceFinder.maintainTopK-678"><span class="linenos">678</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">R</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="SliceFinder.maintainTopK-679"><a href="#SliceFinder.maintainTopK-679"><span class="linenos">679</span></a>        
</span><span id="SliceFinder.maintainTopK-680"><a href="#SliceFinder.maintainTopK-680"><span class="linenos">680</span></a>        <span class="c1">#if there are still valid slices left</span>
</span><span id="SliceFinder.maintainTopK-681"><a href="#SliceFinder.maintainTopK-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder.maintainTopK-682"><a href="#SliceFinder.maintainTopK-682"><span class="linenos">682</span></a>            <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder.maintainTopK-683"><a href="#SliceFinder.maintainTopK-683"><span class="linenos">683</span></a>            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</span><span id="SliceFinder.maintainTopK-684"><a href="#SliceFinder.maintainTopK-684"><span class="linenos">684</span></a>            
</span><span id="SliceFinder.maintainTopK-685"><a href="#SliceFinder.maintainTopK-685"><span class="linenos">685</span></a>            <span class="c1">#???</span>
</span><span id="SliceFinder.maintainTopK-686"><a href="#SliceFinder.maintainTopK-686"><span class="linenos">686</span></a>            <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">TK</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SliceFinder.maintainTopK-687"><a href="#SliceFinder.maintainTopK-687"><span class="linenos">687</span></a>                <span class="n">S</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span> 
</span><span id="SliceFinder.maintainTopK-688"><a href="#SliceFinder.maintainTopK-688"><span class="linenos">688</span></a>                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span>
</span><span id="SliceFinder.maintainTopK-689"><a href="#SliceFinder.maintainTopK-689"><span class="linenos">689</span></a>                
</span><span id="SliceFinder.maintainTopK-690"><a href="#SliceFinder.maintainTopK-690"><span class="linenos">690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; S </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-691"><a href="#SliceFinder.maintainTopK-691"><span class="linenos">691</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot; R </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-692"><a href="#SliceFinder.maintainTopK-692"><span class="linenos">692</span></a>
</span><span id="SliceFinder.maintainTopK-693"><a href="#SliceFinder.maintainTopK-693"><span class="linenos">693</span></a>            
</span><span id="SliceFinder.maintainTopK-694"><a href="#SliceFinder.maintainTopK-694"><span class="linenos">694</span></a>            <span class="n">slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TK</span><span class="p">,</span> <span class="n">S</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-695"><a href="#SliceFinder.maintainTopK-695"><span class="linenos">695</span></a>            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">TKC</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-696"><a href="#SliceFinder.maintainTopK-696"><span class="linenos">696</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;slices </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">slices</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-697"><a href="#SliceFinder.maintainTopK-697"><span class="linenos">697</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;scores </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-698"><a href="#SliceFinder.maintainTopK-698"><span class="linenos">698</span></a>            
</span><span id="SliceFinder.maintainTopK-699"><a href="#SliceFinder.maintainTopK-699"><span class="linenos">699</span></a>            
</span><span id="SliceFinder.maintainTopK-700"><a href="#SliceFinder.maintainTopK-700"><span class="linenos">700</span></a>            <span class="c1">#find new top-k slice indicies</span>
</span><span id="SliceFinder.maintainTopK-701"><a href="#SliceFinder.maintainTopK-701"><span class="linenos">701</span></a>            <span class="n">sorted_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="SliceFinder.maintainTopK-702"><a href="#SliceFinder.maintainTopK-702"><span class="linenos">702</span></a>            <span class="n">top_idxs</span> <span class="o">=</span> <span class="n">sorted_idxs</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_idxs</span><span class="p">))]</span>
</span><span id="SliceFinder.maintainTopK-703"><a href="#SliceFinder.maintainTopK-703"><span class="linenos">703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;sorted idxs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sorted_idxs</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-704"><a href="#SliceFinder.maintainTopK-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;topk idxs&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_idxs</span><span class="p">))</span>
</span><span id="SliceFinder.maintainTopK-705"><a href="#SliceFinder.maintainTopK-705"><span class="linenos">705</span></a>            
</span><span id="SliceFinder.maintainTopK-706"><a href="#SliceFinder.maintainTopK-706"><span class="linenos">706</span></a>            <span class="c1">#update top slices and top statistics with new topk values</span>
</span><span id="SliceFinder.maintainTopK-707"><a href="#SliceFinder.maintainTopK-707"><span class="linenos">707</span></a>            <span class="n">TK</span> <span class="o">=</span> <span class="n">slices</span><span class="p">[</span><span class="n">top_idxs</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="SliceFinder.maintainTopK-708"><a href="#SliceFinder.maintainTopK-708"><span class="linenos">708</span></a>            <span class="n">TKC</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">top_idxs</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="SliceFinder.maintainTopK-709"><a href="#SliceFinder.maintainTopK-709"><span class="linenos">709</span></a>            
</span><span id="SliceFinder.maintainTopK-710"><a href="#SliceFinder.maintainTopK-710"><span class="linenos">710</span></a>
</span><span id="SliceFinder.maintainTopK-711"><a href="#SliceFinder.maintainTopK-711"><span class="linenos">711</span></a>        <span class="k">return</span> <span class="n">TK</span><span class="p">,</span> <span class="n">TKC</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Update the top-k slices and their statistics given the new slices <code>S</code> and statistics <code>R</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>S</strong>:<br />
New slices to be considered for updating the top-k.</p></li>
<li><p><strong>R</strong>:<br />
New statistics corresponding to the new slices <code>S</code>.</p></li>
<li><p><strong>TK</strong>:<br />
Current top-k slices that will be updated.</p></li>
<li><p><strong>TKC</strong>:<br />
Current top-k statistics that will be updated.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>- `TK`: Updated top-k slices.
- `TKC`: Updated top-k statistics.
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="SliceFinder.pretty_print_results" class="classattr">
                                        <input id="SliceFinder.pretty_print_results-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">pretty_print_results</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">result</span>, </span><span class="param"><span class="n">featureNames</span>, </span><span class="param"><span class="n">domainValues</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SliceFinder.pretty_print_results-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SliceFinder.pretty_print_results"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SliceFinder.pretty_print_results-716"><a href="#SliceFinder.pretty_print_results-716"><span class="linenos">716</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SliceFinder.pretty_print_results-717"><a href="#SliceFinder.pretty_print_results-717"><span class="linenos">717</span></a>    <span class="k">def</span> <span class="nf">pretty_print_results</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">featureNames</span><span class="p">,</span> <span class="n">domainValues</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SliceFinder.pretty_print_results-718"><a href="#SliceFinder.pretty_print_results-718"><span class="linenos">718</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SliceFinder.pretty_print_results-719"><a href="#SliceFinder.pretty_print_results-719"><span class="linenos">719</span></a><span class="sd">        Summary:</span>
</span><span id="SliceFinder.pretty_print_results-720"><a href="#SliceFinder.pretty_print_results-720"><span class="linenos">720</span></a><span class="sd">            Print the top-k selected slices and their statistics. </span>
</span><span id="SliceFinder.pretty_print_results-721"><a href="#SliceFinder.pretty_print_results-721"><span class="linenos">721</span></a><span class="sd">            Fill in the numeric column names and domain values with their actual values.</span>
</span><span id="SliceFinder.pretty_print_results-722"><a href="#SliceFinder.pretty_print_results-722"><span class="linenos">722</span></a><span class="sd">        </span>
</span><span id="SliceFinder.pretty_print_results-723"><a href="#SliceFinder.pretty_print_results-723"><span class="linenos">723</span></a><span class="sd">        :param result: </span>
</span><span id="SliceFinder.pretty_print_results-724"><a href="#SliceFinder.pretty_print_results-724"><span class="linenos">724</span></a><span class="sd">            A dictionary containing:</span>
</span><span id="SliceFinder.pretty_print_results-725"><a href="#SliceFinder.pretty_print_results-725"><span class="linenos">725</span></a><span class="sd">            - `&quot;TK&quot;`: Top-k slices.</span>
</span><span id="SliceFinder.pretty_print_results-726"><a href="#SliceFinder.pretty_print_results-726"><span class="linenos">726</span></a><span class="sd">            - `&quot;TKC&quot;`: Top-k statistics.</span>
</span><span id="SliceFinder.pretty_print_results-727"><a href="#SliceFinder.pretty_print_results-727"><span class="linenos">727</span></a><span class="sd">        </span>
</span><span id="SliceFinder.pretty_print_results-728"><a href="#SliceFinder.pretty_print_results-728"><span class="linenos">728</span></a><span class="sd">        :param featureNames: </span>
</span><span id="SliceFinder.pretty_print_results-729"><a href="#SliceFinder.pretty_print_results-729"><span class="linenos">729</span></a><span class="sd">            A list of names for each feature, 1-indexed. </span>
</span><span id="SliceFinder.pretty_print_results-730"><a href="#SliceFinder.pretty_print_results-730"><span class="linenos">730</span></a><span class="sd">            `featureNames[0]` should be an empty string.</span>
</span><span id="SliceFinder.pretty_print_results-731"><a href="#SliceFinder.pretty_print_results-731"><span class="linenos">731</span></a><span class="sd">        </span>
</span><span id="SliceFinder.pretty_print_results-732"><a href="#SliceFinder.pretty_print_results-732"><span class="linenos">732</span></a><span class="sd">        :param domainValues: </span>
</span><span id="SliceFinder.pretty_print_results-733"><a href="#SliceFinder.pretty_print_results-733"><span class="linenos">733</span></a><span class="sd">            A matrix where `domainValues[i][k]` is the name of the feature `i` taking on the `k`th domain value.</span>
</span><span id="SliceFinder.pretty_print_results-734"><a href="#SliceFinder.pretty_print_results-734"><span class="linenos">734</span></a><span class="sd">        </span>
</span><span id="SliceFinder.pretty_print_results-735"><a href="#SliceFinder.pretty_print_results-735"><span class="linenos">735</span></a><span class="sd">        :return: </span>
</span><span id="SliceFinder.pretty_print_results-736"><a href="#SliceFinder.pretty_print_results-736"><span class="linenos">736</span></a><span class="sd">            None. Prints the output to the screen.</span>
</span><span id="SliceFinder.pretty_print_results-737"><a href="#SliceFinder.pretty_print_results-737"><span class="linenos">737</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SliceFinder.pretty_print_results-738"><a href="#SliceFinder.pretty_print_results-738"><span class="linenos">738</span></a>        <span class="n">TK</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;TK&quot;</span><span class="p">]</span>
</span><span id="SliceFinder.pretty_print_results-739"><a href="#SliceFinder.pretty_print_results-739"><span class="linenos">739</span></a>        <span class="n">TKC</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;TKC&quot;</span><span class="p">]</span>
</span><span id="SliceFinder.pretty_print_results-740"><a href="#SliceFinder.pretty_print_results-740"><span class="linenos">740</span></a>        
</span><span id="SliceFinder.pretty_print_results-741"><a href="#SliceFinder.pretty_print_results-741"><span class="linenos">741</span></a>        <span class="c1">#print(&quot;TK&quot;)</span>
</span><span id="SliceFinder.pretty_print_results-742"><a href="#SliceFinder.pretty_print_results-742"><span class="linenos">742</span></a>        <span class="c1">#print(TK)</span>
</span><span id="SliceFinder.pretty_print_results-743"><a href="#SliceFinder.pretty_print_results-743"><span class="linenos">743</span></a>        
</span><span id="SliceFinder.pretty_print_results-744"><a href="#SliceFinder.pretty_print_results-744"><span class="linenos">744</span></a>        <span class="c1">#print(&quot;TKC&quot;)</span>
</span><span id="SliceFinder.pretty_print_results-745"><a href="#SliceFinder.pretty_print_results-745"><span class="linenos">745</span></a>        <span class="c1">#print(TKC)</span>
</span><span id="SliceFinder.pretty_print_results-746"><a href="#SliceFinder.pretty_print_results-746"><span class="linenos">746</span></a>        
</span><span id="SliceFinder.pretty_print_results-747"><a href="#SliceFinder.pretty_print_results-747"><span class="linenos">747</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SliceFinder.pretty_print_results-748"><a href="#SliceFinder.pretty_print_results-748"><span class="linenos">748</span></a>        
</span><span id="SliceFinder.pretty_print_results-749"><a href="#SliceFinder.pretty_print_results-749"><span class="linenos">749</span></a>        
</span><span id="SliceFinder.pretty_print_results-750"><a href="#SliceFinder.pretty_print_results-750"><span class="linenos">750</span></a>        <span class="k">for</span> <span class="nb">slice</span> <span class="ow">in</span> <span class="n">TK</span><span class="p">:</span>
</span><span id="SliceFinder.pretty_print_results-751"><a href="#SliceFinder.pretty_print_results-751"><span class="linenos">751</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slice &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span><span id="SliceFinder.pretty_print_results-752"><a href="#SliceFinder.pretty_print_results-752"><span class="linenos">752</span></a>            
</span><span id="SliceFinder.pretty_print_results-753"><a href="#SliceFinder.pretty_print_results-753"><span class="linenos">753</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.pretty_print_results-754"><a href="#SliceFinder.pretty_print_results-754"><span class="linenos">754</span></a>            <span class="c1">#print features</span>
</span><span id="SliceFinder.pretty_print_results-755"><a href="#SliceFinder.pretty_print_results-755"><span class="linenos">755</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">slice</span><span class="p">)):</span>
</span><span id="SliceFinder.pretty_print_results-756"><a href="#SliceFinder.pretty_print_results-756"><span class="linenos">756</span></a>                <span class="k">if</span> <span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SliceFinder.pretty_print_results-757"><a href="#SliceFinder.pretty_print_results-757"><span class="linenos">757</span></a>                    
</span><span id="SliceFinder.pretty_print_results-758"><a href="#SliceFinder.pretty_print_results-758"><span class="linenos">758</span></a>                    <span class="k">if</span> <span class="n">domainValues</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SliceFinder.pretty_print_results-759"><a href="#SliceFinder.pretty_print_results-759"><span class="linenos">759</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureNames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
</span><span id="SliceFinder.pretty_print_results-760"><a href="#SliceFinder.pretty_print_results-760"><span class="linenos">760</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="SliceFinder.pretty_print_results-761"><a href="#SliceFinder.pretty_print_results-761"><span class="linenos">761</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">featureNames</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">domainValues</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="nb">slice</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
</span><span id="SliceFinder.pretty_print_results-762"><a href="#SliceFinder.pretty_print_results-762"><span class="linenos">762</span></a>                        
</span><span id="SliceFinder.pretty_print_results-763"><a href="#SliceFinder.pretty_print_results-763"><span class="linenos">763</span></a>                    
</span><span id="SliceFinder.pretty_print_results-764"><a href="#SliceFinder.pretty_print_results-764"><span class="linenos">764</span></a>            <span class="c1">#print scores</span>
</span><span id="SliceFinder.pretty_print_results-765"><a href="#SliceFinder.pretty_print_results-765"><span class="linenos">765</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------&quot;</span><span class="p">)</span>
</span><span id="SliceFinder.pretty_print_results-766"><a href="#SliceFinder.pretty_print_results-766"><span class="linenos">766</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   score: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="SliceFinder.pretty_print_results-767"><a href="#SliceFinder.pretty_print_results-767"><span class="linenos">767</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   avg. error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="SliceFinder.pretty_print_results-768"><a href="#SliceFinder.pretty_print_results-768"><span class="linenos">768</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   max error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="SliceFinder.pretty_print_results-769"><a href="#SliceFinder.pretty_print_results-769"><span class="linenos">769</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TKC</span><span class="p">[</span><span class="n">count</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
</span><span id="SliceFinder.pretty_print_results-770"><a href="#SliceFinder.pretty_print_results-770"><span class="linenos">770</span></a>            
</span><span id="SliceFinder.pretty_print_results-771"><a href="#SliceFinder.pretty_print_results-771"><span class="linenos">771</span></a>            
</span><span id="SliceFinder.pretty_print_results-772"><a href="#SliceFinder.pretty_print_results-772"><span class="linenos">772</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SliceFinder.pretty_print_results-773"><a href="#SliceFinder.pretty_print_results-773"><span class="linenos">773</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Print the top-k selected slices and their statistics. 
    Fill in the numeric column names and domain values with their actual values.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>result</strong>:<br />
A dictionary containing:</p>

<ul>
<li><code>"TK"</code>: Top-k slices.</li>
<li><code>"TKC"</code>: Top-k statistics.</li>
</ul></li>
<li><p><strong>featureNames</strong>:<br />
A list of names for each feature, 1-indexed. 
<code>featureNames[0]</code> should be an empty string.</p></li>
<li><p><strong>domainValues</strong>:<br />
A matrix where <code>domainValues[i][k]</code> is the name of the feature <code>i</code> taking on the <code><a href="#SliceFinder.k">k</a></code>th domain value.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
<pre><code>None. Prints the output to the screen.
</code></pre>
</blockquote>
</div>


                            </div>
                </section>
                <section id="testBed">
                            <input id="testBed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">testBed</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="testBed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#testBed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="testBed-780"><a href="#testBed-780"><span class="linenos">780</span></a><span class="k">def</span> <span class="nf">testBed</span><span class="p">():</span>
</span><span id="testBed-781"><a href="#testBed-781"><span class="linenos">781</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="testBed-782"><a href="#testBed-782"><span class="linenos">782</span></a>
</span><span id="testBed-783"><a href="#testBed-783"><span class="linenos">783</span></a><span class="sd">        Summary:</span>
</span><span id="testBed-784"><a href="#testBed-784"><span class="linenos">784</span></a><span class="sd">            Run sliceline on a toy example and print the results</span>
</span><span id="testBed-785"><a href="#testBed-785"><span class="linenos">785</span></a>
</span><span id="testBed-786"><a href="#testBed-786"><span class="linenos">786</span></a>
</span><span id="testBed-787"><a href="#testBed-787"><span class="linenos">787</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="testBed-788"><a href="#testBed-788"><span class="linenos">788</span></a>    
</span><span id="testBed-789"><a href="#testBed-789"><span class="linenos">789</span></a>    <span class="c1">#dummy data has 3 samples of 4 features where sample i has all features set to value i</span>
</span><span id="testBed-790"><a href="#testBed-790"><span class="linenos">790</span></a>    <span class="c1">#errors are 1,2,3</span>
</span><span id="testBed-791"><a href="#testBed-791"><span class="linenos">791</span></a>    
</span><span id="testBed-792"><a href="#testBed-792"><span class="linenos">792</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;test.log&quot;</span><span class="p">)</span>
</span><span id="testBed-793"><a href="#testBed-793"><span class="linenos">793</span></a>    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="testBed-794"><a href="#testBed-794"><span class="linenos">794</span></a>    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="testBed-795"><a href="#testBed-795"><span class="linenos">795</span></a>    <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_rows</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</span><span id="testBed-796"><a href="#testBed-796"><span class="linenos">796</span></a>    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="testBed-797"><a href="#testBed-797"><span class="linenos">797</span></a>    
</span><span id="testBed-798"><a href="#testBed-798"><span class="linenos">798</span></a>    <span class="n">sf</span> <span class="o">=</span> <span class="n">SliceFinder</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="testBed-799"><a href="#testBed-799"><span class="linenos">799</span></a>    <span class="n">sf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="testBed-800"><a href="#testBed-800"><span class="linenos">800</span></a>    
</span><span id="testBed-801"><a href="#testBed-801"><span class="linenos">801</span></a>    <span class="n">SliceFinder</span><span class="o">.</span><span class="n">pretty_print_results</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;feature 1&quot;</span><span class="p">,</span> <span class="s2">&quot;feature 2&quot;</span><span class="p">,</span> <span class="s2">&quot;feature 3&quot;</span><span class="p">,</span> <span class="s2">&quot;feature 4&quot;</span><span class="p">])</span>
</span><span id="testBed-802"><a href="#testBed-802"><span class="linenos">802</span></a>    <span class="c1">#print(&quot;foo result&quot;)</span>
</span><span id="testBed-803"><a href="#testBed-803"><span class="linenos">803</span></a>    <span class="c1">#print(foo.result)</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Run sliceline on a toy example and print the results</p>
</div>


                </section>
                <section id="testAdult">
                            <input id="testAdult-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">testAdult</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="testAdult-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#testAdult"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="testAdult-807"><a href="#testAdult-807"><span class="linenos">807</span></a><span class="k">def</span> <span class="nf">testAdult</span><span class="p">():</span>
</span><span id="testAdult-808"><a href="#testAdult-808"><span class="linenos">808</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="testAdult-809"><a href="#testAdult-809"><span class="linenos">809</span></a><span class="sd">        Summary:</span>
</span><span id="testAdult-810"><a href="#testAdult-810"><span class="linenos">810</span></a><span class="sd">            Run sliceLine on adult dataset with dummy errors</span>
</span><span id="testAdult-811"><a href="#testAdult-811"><span class="linenos">811</span></a>
</span><span id="testAdult-812"><a href="#testAdult-812"><span class="linenos">812</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="testAdult-813"><a href="#testAdult-813"><span class="linenos">813</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;test.log&quot;</span><span class="p">)</span>
</span><span id="testAdult-814"><a href="#testAdult-814"><span class="linenos">814</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="testAdult-815"><a href="#testAdult-815"><span class="linenos">815</span></a>    <span class="n">X_train</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">unpickleDataset</span><span class="p">(</span><span class="s2">&quot;./Data/Adult/train.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;./Data/Adult/test.pkl&quot;</span><span class="p">)</span>
</span><span id="testAdult-816"><a href="#testAdult-816"><span class="linenos">816</span></a>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="testAdult-817"><a href="#testAdult-817"><span class="linenos">817</span></a>    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="testAdult-818"><a href="#testAdult-818"><span class="linenos">818</span></a>    
</span><span id="testAdult-819"><a href="#testAdult-819"><span class="linenos">819</span></a>    <span class="n">errors_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</span><span id="testAdult-820"><a href="#testAdult-820"><span class="linenos">820</span></a>    <span class="n">errors_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./Data/Adult/dummyErrors.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="testAdult-821"><a href="#testAdult-821"><span class="linenos">821</span></a>    
</span><span id="testAdult-822"><a href="#testAdult-822"><span class="linenos">822</span></a>    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="testAdult-823"><a href="#testAdult-823"><span class="linenos">823</span></a>    <span class="n">sf</span> <span class="o">=</span> <span class="n">SliceFinder</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="testAdult-824"><a href="#testAdult-824"><span class="linenos">824</span></a>    <span class="n">sf</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="testAdult-825"><a href="#testAdult-825"><span class="linenos">825</span></a>    <span class="n">SliceFinder</span><span class="o">.</span><span class="n">pretty_print_results</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;feature&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">86</span><span class="p">)])</span>
</span></pre></div>


            <div class="docstring"><p>Summary:
    Run sliceLine on adult dataset with dummy errors</p>
</div>


                </section>
    </main>
</body>
</html>